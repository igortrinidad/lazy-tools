import{r as ref,o as onMounted,a as openBlock,c as createElementBlock,b as createBaseVNode,t as toDisplayString,d as computed,F as Fragment,e as renderList,u as unref,f as createStaticVNode,g as createTextVNode,h as createVNode}from"./app.0b5a2e5e.js";class Text{constructor(){}lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,n,r){let s=[];return this.decompose(0,e,s,2),r.length&&r.decompose(0,r.length,s,3),this.decompose(n,this.length,s,1),TextNode.from(s,this.length-(n-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,n=this.length){let r=[];return this.decompose(e,n,r,0),TextNode.from(r,n-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let n=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),s=new RawTextCursor(this),l=new RawTextCursor(e);for(let a=n,h=n;;){if(s.next(a),l.next(a),a=0,s.lineBreak!=l.lineBreak||s.done!=l.done||s.value!=l.value)return!1;if(h+=s.value.length,s.done||h>=r)return!0}}iter(e=1){return new RawTextCursor(this,e)}iterRange(e,n=this.length){return new PartialTextCursor(this,e,n)}iterLines(e,n){let r;if(e==null)r=this.iter();else{n==null&&(n=this.lines+1);let s=this.line(e).from;r=this.iterRange(s,Math.max(s,n==this.lines+1?this.length:n<=1?0:this.line(n-1).to))}return new LineCursor(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Text.empty:e.length<=32?new TextLeaf(e):TextNode.from(TextLeaf.split(e,[]))}}class TextLeaf extends Text{constructor(e,n=textLength(e)){super(),this.text=e,this.length=n}get lines(){return this.text.length}get children(){return null}lineInner(e,n,r,s){for(let l=0;;l++){let a=this.text[l],h=s+a.length;if((n?r:h)>=e)return new Line(s,h,r,a);s=h+1,r++}}decompose(e,n,r,s){let l=e<=0&&n>=this.length?this:new TextLeaf(sliceText(this.text,e,n),Math.min(n,this.length)-Math.max(0,e));if(s&1){let a=r.pop(),h=appendText(l.text,a.text.slice(),0,l.length);if(h.length<=32)r.push(new TextLeaf(h,a.length+l.length));else{let c=h.length>>1;r.push(new TextLeaf(h.slice(0,c)),new TextLeaf(h.slice(c)))}}else r.push(l)}replace(e,n,r){if(!(r instanceof TextLeaf))return super.replace(e,n,r);let s=appendText(this.text,appendText(r.text,sliceText(this.text,0,e)),n),l=this.length+r.length-(n-e);return s.length<=32?new TextLeaf(s,l):TextNode.from(TextLeaf.split(s,[]),l)}sliceString(e,n=this.length,r=`
`){let s="";for(let l=0,a=0;l<=n&&a<this.text.length;a++){let h=this.text[a],c=l+h.length;l>e&&a&&(s+=r),e<c&&n>l&&(s+=h.slice(Math.max(0,e-l),n-l)),l=c+1}return s}flatten(e){for(let n of this.text)e.push(n)}scanIdentical(){return 0}static split(e,n){let r=[],s=-1;for(let l of e)r.push(l),s+=l.length+1,r.length==32&&(n.push(new TextLeaf(r,s)),r=[],s=-1);return s>-1&&n.push(new TextLeaf(r,s)),n}}class TextNode extends Text{constructor(e,n){super(),this.children=e,this.length=n,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,n,r,s){for(let l=0;;l++){let a=this.children[l],h=s+a.length,c=r+a.lines-1;if((n?c:h)>=e)return a.lineInner(e,n,r,s);s=h+1,r=c+1}}decompose(e,n,r,s){for(let l=0,a=0;a<=n&&l<this.children.length;l++){let h=this.children[l],c=a+h.length;if(e<=c&&n>=a){let u=s&((a<=e?1:0)|(c>=n?2:0));a>=e&&c<=n&&!u?r.push(h):h.decompose(e-a,n-a,r,u)}a=c+1}}replace(e,n,r){if(r.lines<this.lines)for(let s=0,l=0;s<this.children.length;s++){let a=this.children[s],h=l+a.length;if(e>=l&&n<=h){let c=a.replace(e-l,n-l,r),u=this.lines-a.lines+c.lines;if(c.lines<u>>5-1&&c.lines>u>>5+1){let f=this.children.slice();return f[s]=c,new TextNode(f,this.length-(n-e)+r.length)}return super.replace(l,h,c)}l=h+1}return super.replace(e,n,r)}sliceString(e,n=this.length,r=`
`){let s="";for(let l=0,a=0;l<this.children.length&&a<=n;l++){let h=this.children[l],c=a+h.length;a>e&&l&&(s+=r),e<c&&n>a&&(s+=h.sliceString(e-a,n-a,r)),a=c+1}return s}flatten(e){for(let n of this.children)n.flatten(e)}scanIdentical(e,n){if(!(e instanceof TextNode))return 0;let r=0,[s,l,a,h]=n>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=n,l+=n){if(s==a||l==h)return r;let c=this.children[s],u=e.children[l];if(c!=u)return r+c.scanIdentical(u,n);r+=c.length+1}}static from(e,n=e.reduce((r,s)=>r+s.length+1,-1)){let r=0;for(let p of e)r+=p.lines;if(r<32){let p=[];for(let m of e)m.flatten(p);return new TextLeaf(p,n)}let s=Math.max(32,r>>5),l=s<<1,a=s>>1,h=[],c=0,u=-1,f=[];function d(p){let m;if(p.lines>l&&p instanceof TextNode)for(let w of p.children)d(w);else p.lines>a&&(c>a||!c)?(g(),h.push(p)):p instanceof TextLeaf&&c&&(m=f[f.length-1])instanceof TextLeaf&&p.lines+m.lines<=32?(c+=p.lines,u+=p.length+1,f[f.length-1]=new TextLeaf(m.text.concat(p.text),m.length+1+p.length)):(c+p.lines>s&&g(),c+=p.lines,u+=p.length+1,f.push(p))}function g(){c!=0&&(h.push(f.length==1?f[0]:TextNode.from(f,u)),u=-1,c=f.length=0)}for(let p of e)d(p);return g(),h.length==1?h[0]:new TextNode(h,n)}}Text.empty=new TextLeaf([""],0);function textLength(o){let e=-1;for(let n of o)e+=n.length+1;return e}function appendText(o,e,n=0,r=1e9){for(let s=0,l=0,a=!0;l<o.length&&s<=r;l++){let h=o[l],c=s+h.length;c>=n&&(c>r&&(h=h.slice(0,r-s)),s<n&&(h=h.slice(n-s)),a?(e[e.length-1]+=h,a=!1):e.push(h)),s=c+1}return e}function sliceText(o,e,n){return appendText(o,[""],e,n)}class RawTextCursor{constructor(e,n=1){this.dir=n,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[n>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}nextInner(e,n){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,s=this.nodes[r],l=this.offsets[r],a=l>>1,h=s instanceof TextLeaf?s.text.length:s.children.length;if(a==(n>0?h:0)){if(r==0)return this.done=!0,this.value="",this;n>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((l&1)==(n>0?0:1)){if(this.offsets[r]+=n,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof TextLeaf){let c=s.text[a+(n<0?-1:0)];if(this.offsets[r]+=n,c.length>Math.max(0,e))return this.value=e==0?c:n>0?c.slice(e):c.slice(0,c.length-e),this;e-=c.length}else{let c=s.children[a+(n<0?-1:0)];e>c.length?(e-=c.length,this.offsets[r]+=n):(n<0&&this.offsets[r]--,this.nodes.push(c),this.offsets.push(n>0?1:(c instanceof TextLeaf?c.text.length:c.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class PartialTextCursor{constructor(e,n,r){this.value="",this.done=!1,this.cursor=new RawTextCursor(e,n>r?-1:1),this.pos=n>r?e.length:0,this.from=Math.min(n,r),this.to=Math.max(n,r)}nextInner(e,n){if(n<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,n<0?this.pos-this.to:this.from-this.pos);let r=n<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*n,this.value=s.length<=r?s:n<0?s.slice(s.length-r):s.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class LineCursor{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:n,lineBreak:r,value:s}=this.inner.next(e);return n?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Text.prototype[Symbol.iterator]=function(){return this.iter()},RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this});class Line{constructor(e,n,r,s){this.from=e,this.to=n,this.number=r,this.text=s}get length(){return this.to-this.from}}let extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(o=>o?parseInt(o,36):1);for(let o=1;o<extend.length;o++)extend[o]+=extend[o-1];function isExtendingChar(o){for(let e=1;e<extend.length;e+=2)if(extend[e]>o)return extend[e-1]<=o;return!1}function isRegionalIndicator(o){return o>=127462&&o<=127487}const ZWJ=8205;function findClusterBreak(o,e,n=!0,r=!0){return(n?nextClusterBreak:prevClusterBreak)(o,e,r)}function nextClusterBreak(o,e,n){if(e==o.length)return e;e&&surrogateLow(o.charCodeAt(e))&&surrogateHigh(o.charCodeAt(e-1))&&e--;let r=codePointAt(o,e);for(e+=codePointSize(r);e<o.length;){let s=codePointAt(o,e);if(r==ZWJ||s==ZWJ||n&&isExtendingChar(s))e+=codePointSize(s),r=s;else if(isRegionalIndicator(s)){let l=0,a=e-2;for(;a>=0&&isRegionalIndicator(codePointAt(o,a));)l++,a-=2;if(l%2==0)break;e+=2}else break}return e}function prevClusterBreak(o,e,n){for(;e>0;){let r=nextClusterBreak(o,e-2,n);if(r<e)return r;e--}return 0}function surrogateLow(o){return o>=56320&&o<57344}function surrogateHigh(o){return o>=55296&&o<56320}function codePointAt(o,e){let n=o.charCodeAt(e);if(!surrogateHigh(n)||e+1==o.length)return n;let r=o.charCodeAt(e+1);return surrogateLow(r)?(n-55296<<10)+(r-56320)+65536:n}function codePointSize(o){return o<65536?1:2}const DefaultSplit=/\r\n?|\n/;var MapMode=function(o){return o[o.Simple=0]="Simple",o[o.TrackDel=1]="TrackDel",o[o.TrackBefore=2]="TrackBefore",o[o.TrackAfter=3]="TrackAfter",o}(MapMode||(MapMode={}));class ChangeDesc{constructor(e){this.sections=e}get length(){let e=0;for(let n=0;n<this.sections.length;n+=2)e+=this.sections[n];return e}get newLength(){let e=0;for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n+1];e+=r<0?this.sections[n]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let n=0,r=0,s=0;n<this.sections.length;){let l=this.sections[n++],a=this.sections[n++];a<0?(e(r,s,l),s+=l):s+=a,r+=l}}iterChangedRanges(e,n=!1){iterChanges(this,e,n)}get invertedDesc(){let e=[];for(let n=0;n<this.sections.length;){let r=this.sections[n++],s=this.sections[n++];s<0?e.push(r,s):e.push(s,r)}return new ChangeDesc(e)}composeDesc(e){return this.empty?e:e.empty?this:composeSets(this,e)}mapDesc(e,n=!1){return e.empty?this:mapSet(this,e,n)}mapPos(e,n=-1,r=MapMode.Simple){let s=0,l=0;for(let a=0;a<this.sections.length;){let h=this.sections[a++],c=this.sections[a++],u=s+h;if(c<0){if(u>e)return l+(e-s);l+=h}else{if(r!=MapMode.Simple&&u>=e&&(r==MapMode.TrackDel&&s<e&&u>e||r==MapMode.TrackBefore&&s<e||r==MapMode.TrackAfter&&u>e))return null;if(u>e||u==e&&n<0&&!h)return e==s||n<0?l:l+c;l+=c}s=u}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return l}touchesRange(e,n=e){for(let r=0,s=0;r<this.sections.length&&s<=n;){let l=this.sections[r++],a=this.sections[r++],h=s+l;if(a>=0&&s<=n&&h>=e)return s<e&&h>n?"cover":!0;s=h}return!1}toString(){let e="";for(let n=0;n<this.sections.length;){let r=this.sections[n++],s=this.sections[n++];e+=(e?" ":"")+r+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(n=>typeof n!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(e)}static create(e){return new ChangeDesc(e)}}class ChangeSet extends ChangeDesc{constructor(e,n){super(e),this.inserted=n}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return iterChanges(this,(n,r,s,l,a)=>e=e.replace(s,s+(r-n),a),!1),e}mapDesc(e,n=!1){return mapSet(this,e,n,!0)}invert(e){let n=this.sections.slice(),r=[];for(let s=0,l=0;s<n.length;s+=2){let a=n[s],h=n[s+1];if(h>=0){n[s]=h,n[s+1]=a;let c=s>>1;for(;r.length<c;)r.push(Text.empty);r.push(a?e.slice(l,l+a):Text.empty)}l+=a}return new ChangeSet(n,r)}compose(e){return this.empty?e:e.empty?this:composeSets(this,e,!0)}map(e,n=!1){return e.empty?this:mapSet(this,e,n,!0)}iterChanges(e,n=!1){iterChanges(this,e,n)}get desc(){return ChangeDesc.create(this.sections)}filter(e){let n=[],r=[],s=[],l=new SectionIter(this);e:for(let a=0,h=0;;){let c=a==e.length?1e9:e[a++];for(;h<c||h==c&&l.len==0;){if(l.done)break e;let f=Math.min(l.len,c-h);addSection(s,f,-1);let d=l.ins==-1?-1:l.off==0?l.ins:0;addSection(n,f,d),d>0&&addInsert(r,n,l.text),l.forward(f),h+=f}let u=e[a++];for(;h<u;){if(l.done)break e;let f=Math.min(l.len,u-h);addSection(n,f,-1),addSection(s,f,l.ins==-1?-1:l.off==0?l.ins:0),l.forward(f),h+=f}}return{changes:new ChangeSet(n,r),filtered:ChangeDesc.create(s)}}toJSON(){let e=[];for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n],s=this.sections[n+1];s<0?e.push(r):s==0?e.push([r]):e.push([r].concat(this.inserted[n>>1].toJSON()))}return e}static of(e,n,r){let s=[],l=[],a=0,h=null;function c(f=!1){if(!f&&!s.length)return;a<n&&addSection(s,n-a,-1);let d=new ChangeSet(s,l);h=h?h.compose(d.map(h)):d,s=[],l=[],a=0}function u(f){if(Array.isArray(f))for(let d of f)u(d);else if(f instanceof ChangeSet){if(f.length!=n)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${n})`);c(),h=h?h.compose(f.map(h)):f}else{let{from:d,to:g=d,insert:p}=f;if(d>g||d<0||g>n)throw new RangeError(`Invalid change range ${d} to ${g} (in doc of length ${n})`);let m=p?typeof p=="string"?Text.of(p.split(r||DefaultSplit)):p:Text.empty,w=m.length;if(d==g&&w==0)return;d<a&&c(),d>a&&addSection(s,d-a,-1),addSection(s,g-d,w),addInsert(l,s,m),a=g}}return u(e),c(!h),h}static empty(e){return new ChangeSet(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let n=[],r=[];for(let s=0;s<e.length;s++){let l=e[s];if(typeof l=="number")n.push(l,-1);else{if(!Array.isArray(l)||typeof l[0]!="number"||l.some((a,h)=>h&&typeof a!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(l.length==1)n.push(l[0],0);else{for(;r.length<s;)r.push(Text.empty);r[s]=Text.of(l.slice(1)),n.push(l[0],r[s].length)}}}return new ChangeSet(n,r)}static createSet(e,n){return new ChangeSet(e,n)}}function addSection(o,e,n,r=!1){if(e==0&&n<=0)return;let s=o.length-2;s>=0&&n<=0&&n==o[s+1]?o[s]+=e:e==0&&o[s]==0?o[s+1]+=n:r?(o[s]+=e,o[s+1]+=n):o.push(e,n)}function addInsert(o,e,n){if(n.length==0)return;let r=e.length-2>>1;if(r<o.length)o[o.length-1]=o[o.length-1].append(n);else{for(;o.length<r;)o.push(Text.empty);o.push(n)}}function iterChanges(o,e,n){let r=o.inserted;for(let s=0,l=0,a=0;a<o.sections.length;){let h=o.sections[a++],c=o.sections[a++];if(c<0)s+=h,l+=h;else{let u=s,f=l,d=Text.empty;for(;u+=h,f+=c,c&&r&&(d=d.append(r[a-2>>1])),!(n||a==o.sections.length||o.sections[a+1]<0);)h=o.sections[a++],c=o.sections[a++];e(s,u,l,f,d),s=u,l=f}}}function mapSet(o,e,n,r=!1){let s=[],l=r?[]:null,a=new SectionIter(o),h=new SectionIter(e);for(let c=-1;;)if(a.ins==-1&&h.ins==-1){let u=Math.min(a.len,h.len);addSection(s,u,-1),a.forward(u),h.forward(u)}else if(h.ins>=0&&(a.ins<0||c==a.i||a.off==0&&(h.len<a.len||h.len==a.len&&!n))){let u=h.len;for(addSection(s,h.ins,-1);u;){let f=Math.min(a.len,u);a.ins>=0&&c<a.i&&a.len<=f&&(addSection(s,0,a.ins),l&&addInsert(l,s,a.text),c=a.i),a.forward(f),u-=f}h.next()}else if(a.ins>=0){let u=0,f=a.len;for(;f;)if(h.ins==-1){let d=Math.min(f,h.len);u+=d,f-=d,h.forward(d)}else if(h.ins==0&&h.len<f)f-=h.len,h.next();else break;addSection(s,u,c<a.i?a.ins:0),l&&c<a.i&&addInsert(l,s,a.text),c=a.i,a.forward(a.len-f)}else{if(a.done&&h.done)return l?ChangeSet.createSet(s,l):ChangeDesc.create(s);throw new Error("Mismatched change set lengths")}}function composeSets(o,e,n=!1){let r=[],s=n?[]:null,l=new SectionIter(o),a=new SectionIter(e);for(let h=!1;;){if(l.done&&a.done)return s?ChangeSet.createSet(r,s):ChangeDesc.create(r);if(l.ins==0)addSection(r,l.len,0,h),l.next();else if(a.len==0&&!a.done)addSection(r,0,a.ins,h),s&&addInsert(s,r,a.text),a.next();else{if(l.done||a.done)throw new Error("Mismatched change set lengths");{let c=Math.min(l.len2,a.len),u=r.length;if(l.ins==-1){let f=a.ins==-1?-1:a.off?0:a.ins;addSection(r,c,f,h),s&&f&&addInsert(s,r,a.text)}else a.ins==-1?(addSection(r,l.off?0:l.len,c,h),s&&addInsert(s,r,l.textBit(c))):(addSection(r,l.off?0:l.len,a.off?0:a.ins,h),s&&!a.off&&addInsert(s,r,a.text));h=(l.ins>c||a.ins>=0&&a.len>c)&&(h||r.length>u),l.forward2(c),a.forward(c)}}}}class SectionIter{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,n=this.i-2>>1;return n>=e.length?Text.empty:e[n]}textBit(e){let{inserted:n}=this.set,r=this.i-2>>1;return r>=n.length&&!e?Text.empty:n[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class SelectionRange{constructor(e,n,r){this.from=e,this.to=n,this.flags=r}get anchor(){return this.flags&16?this.to:this.from}get head(){return this.flags&16?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&4?-1:this.flags&8?1:0}get bidiLevel(){let e=this.flags&3;return e==3?null:e}get goalColumn(){let e=this.flags>>5;return e==33554431?void 0:e}map(e,n=-1){let r,s;return this.empty?r=s=e.mapPos(this.from,n):(r=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),r==this.from&&s==this.to?this:new SelectionRange(r,s,this.flags)}extend(e,n=e){if(e<=this.anchor&&n>=this.anchor)return EditorSelection.range(e,n);let r=Math.abs(e-this.anchor)>Math.abs(n-this.anchor)?e:n;return EditorSelection.range(this.anchor,r)}eq(e){return this.anchor==e.anchor&&this.head==e.head}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)}static create(e,n,r){return new SelectionRange(e,n,r)}}class EditorSelection{constructor(e,n){this.ranges=e,this.mainIndex=n}map(e,n=-1){return e.empty?this:EditorSelection.create(this.ranges.map(r=>r.map(e,n)),this.mainIndex)}eq(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let n=0;n<this.ranges.length;n++)if(!this.ranges[n].eq(e.ranges[n]))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main],0)}addRange(e,n=!0){return EditorSelection.create([e].concat(this.ranges),n?0:this.mainIndex+1)}replaceRange(e,n=this.mainIndex){let r=this.ranges.slice();return r[n]=e,EditorSelection.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(e.ranges.map(n=>SelectionRange.fromJSON(n)),e.main)}static single(e,n=e){return new EditorSelection([EditorSelection.range(e,n)],0)}static create(e,n=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,s=0;s<e.length;s++){let l=e[s];if(l.empty?l.from<=r:l.from<r)return EditorSelection.normalized(e.slice(),n);r=l.to}return new EditorSelection(e,n)}static cursor(e,n=0,r,s){return SelectionRange.create(e,e,(n==0?0:n<0?4:8)|(r==null?3:Math.min(2,r))|(s!=null?s:33554431)<<5)}static range(e,n,r){let s=(r!=null?r:33554431)<<5;return n<e?SelectionRange.create(n,e,16|s|8):SelectionRange.create(e,n,s|(n>e?4:0))}static normalized(e,n=0){let r=e[n];e.sort((s,l)=>s.from-l.from),n=e.indexOf(r);for(let s=1;s<e.length;s++){let l=e[s],a=e[s-1];if(l.empty?l.from<=a.to:l.from<a.to){let h=a.from,c=Math.max(l.to,a.to);s<=n&&n--,e.splice(--s,2,l.anchor>l.head?EditorSelection.range(c,h):EditorSelection.range(h,c))}}return new EditorSelection(e,n)}}function checkSelection(o,e){for(let n of o.ranges)if(n.to>e)throw new RangeError("Selection points outside of document")}let nextID=0;class Facet{constructor(e,n,r,s,l){this.combine=e,this.compareInput=n,this.compare=r,this.isStatic=s,this.id=nextID++,this.default=e([]),this.extensions=typeof l=="function"?l(this):l}static define(e={}){return new Facet(e.combine||(n=>n),e.compareInput||((n,r)=>n===r),e.compare||(e.combine?(n,r)=>n===r:sameArray$1),!!e.static,e.enables)}of(e){return new FacetProvider([],this,0,e)}compute(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,n)}computeN(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,n)}from(e,n){return n||(n=r=>r),this.compute([e],r=>n(r.field(e)))}}function sameArray$1(o,e){return o==e||o.length==e.length&&o.every((n,r)=>n===e[r])}class FacetProvider{constructor(e,n,r,s){this.dependencies=e,this.facet=n,this.type=r,this.value=s,this.id=nextID++}dynamicSlot(e){var n;let r=this.value,s=this.facet.compareInput,l=this.id,a=e[l]>>1,h=this.type==2,c=!1,u=!1,f=[];for(let d of this.dependencies)d=="doc"?c=!0:d=="selection"?u=!0:(((n=e[d.id])!==null&&n!==void 0?n:1)&1)==0&&f.push(e[d.id]);return{create(d){return d.values[a]=r(d),1},update(d,g){if(c&&g.docChanged||u&&(g.docChanged||g.selection)||ensureAll(d,f)){let p=r(d);if(h?!compareArray(p,d.values[a],s):!s(p,d.values[a]))return d.values[a]=p,1}return 0},reconfigure:(d,g)=>{let p,m=g.config.address[l];if(m!=null){let w=getAddr(g,m);if(this.dependencies.every(y=>y instanceof Facet?g.facet(y)===d.facet(y):y instanceof StateField?g.field(y,!1)==d.field(y,!1):!0)||(h?compareArray(p=r(d),w,s):s(p=r(d),w)))return d.values[a]=w,0}else p=r(d);return d.values[a]=p,1}}}}function compareArray(o,e,n){if(o.length!=e.length)return!1;for(let r=0;r<o.length;r++)if(!n(o[r],e[r]))return!1;return!0}function ensureAll(o,e){let n=!1;for(let r of e)ensureAddr(o,r)&1&&(n=!0);return n}function dynamicFacetSlot(o,e,n){let r=n.map(c=>o[c.id]),s=n.map(c=>c.type),l=r.filter(c=>!(c&1)),a=o[e.id]>>1;function h(c){let u=[];for(let f=0;f<r.length;f++){let d=getAddr(c,r[f]);if(s[f]==2)for(let g of d)u.push(g);else u.push(d)}return e.combine(u)}return{create(c){for(let u of r)ensureAddr(c,u);return c.values[a]=h(c),1},update(c,u){if(!ensureAll(c,l))return 0;let f=h(c);return e.compare(f,c.values[a])?0:(c.values[a]=f,1)},reconfigure(c,u){let f=ensureAll(c,r),d=u.config.facets[e.id],g=u.facet(e);if(d&&!f&&sameArray$1(n,d))return c.values[a]=g,0;let p=h(c);return e.compare(p,g)?(c.values[a]=g,0):(c.values[a]=p,1)}}}const initField=Facet.define({static:!0});class StateField{constructor(e,n,r,s,l){this.id=e,this.createF=n,this.updateF=r,this.compareF=s,this.spec=l,this.provides=void 0}static define(e){let n=new StateField(nextID++,e.create,e.update,e.compare||((r,s)=>r===s),e);return e.provide&&(n.provides=e.provide(n)),n}create(e){let n=e.facet(initField).find(r=>r.field==this);return((n==null?void 0:n.create)||this.createF)(e)}slot(e){let n=e[this.id]>>1;return{create:r=>(r.values[n]=this.create(r),1),update:(r,s)=>{let l=r.values[n],a=this.updateF(l,s);return this.compareF(l,a)?0:(r.values[n]=a,1)},reconfigure:(r,s)=>s.config.address[this.id]!=null?(r.values[n]=s.field(this),0):(r.values[n]=this.create(r),1)}}init(e){return[this,initField.of({field:this,create:e})]}get extension(){return this}}const Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(o){return e=>new PrecExtension(e,o)}const Prec={highest:prec(Prec_.highest),high:prec(Prec_.high),default:prec(Prec_.default),low:prec(Prec_.low),lowest:prec(Prec_.lowest)};class PrecExtension{constructor(e,n){this.inner=e,this.prec=n}}class Compartment{of(e){return new CompartmentInstance(this,e)}reconfigure(e){return Compartment.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class CompartmentInstance{constructor(e,n){this.compartment=e,this.inner=n}}class Configuration{constructor(e,n,r,s,l,a){for(this.base=e,this.compartments=n,this.dynamicSlots=r,this.address=s,this.staticValues=l,this.facets=a,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let n=this.address[e.id];return n==null?e.default:this.staticValues[n>>1]}static resolve(e,n,r){let s=[],l=Object.create(null),a=new Map;for(let g of flatten(e,n,a))g instanceof StateField?s.push(g):(l[g.facet.id]||(l[g.facet.id]=[])).push(g);let h=Object.create(null),c=[],u=[];for(let g of s)h[g.id]=u.length<<1,u.push(p=>g.slot(p));let f=r==null?void 0:r.config.facets;for(let g in l){let p=l[g],m=p[0].facet,w=f&&f[g]||[];if(p.every(y=>y.type==0))if(h[m.id]=c.length<<1|1,sameArray$1(w,p))c.push(r.facet(m));else{let y=m.combine(p.map(S=>S.value));c.push(r&&m.compare(y,r.facet(m))?r.facet(m):y)}else{for(let y of p)y.type==0?(h[y.id]=c.length<<1|1,c.push(y.value)):(h[y.id]=u.length<<1,u.push(S=>y.dynamicSlot(S)));h[m.id]=u.length<<1,u.push(y=>dynamicFacetSlot(y,m,p))}}let d=u.map(g=>g(h));return new Configuration(e,a,d,h,c,l)}}function flatten(o,e,n){let r=[[],[],[],[],[]],s=new Map;function l(a,h){let c=s.get(a);if(c!=null){if(c<=h)return;let u=r[c].indexOf(a);u>-1&&r[c].splice(u,1),a instanceof CompartmentInstance&&n.delete(a.compartment)}if(s.set(a,h),Array.isArray(a))for(let u of a)l(u,h);else if(a instanceof CompartmentInstance){if(n.has(a.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(a.compartment)||a.inner;n.set(a.compartment,u),l(u,h)}else if(a instanceof PrecExtension)l(a.inner,a.prec);else if(a instanceof StateField)r[h].push(a),a.provides&&l(a.provides,h);else if(a instanceof FacetProvider)r[h].push(a),a.facet.extensions&&l(a.facet.extensions,Prec_.default);else{let u=a.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${a}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);l(u,h)}}return l(o,Prec_.default),r.reduce((a,h)=>a.concat(h))}function ensureAddr(o,e){if(e&1)return 2;let n=e>>1,r=o.status[n];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;o.status[n]=4;let s=o.computeSlot(o,o.config.dynamicSlots[n]);return o.status[n]=2|s}function getAddr(o,e){return e&1?o.config.staticValues[e>>1]:o.values[e>>1]}const languageData=Facet.define(),allowMultipleSelections=Facet.define({combine:o=>o.some(e=>e),static:!0}),lineSeparator=Facet.define({combine:o=>o.length?o[0]:void 0,static:!0}),changeFilter=Facet.define(),transactionFilter=Facet.define(),transactionExtender=Facet.define(),readOnly=Facet.define({combine:o=>o.length?o[0]:!1});class Annotation{constructor(e,n){this.type=e,this.value=n}static define(){return new AnnotationType}}class AnnotationType{of(e){return new Annotation(this,e)}}class StateEffectType{constructor(e){this.map=e}of(e){return new StateEffect(this,e)}}class StateEffect{constructor(e,n){this.type=e,this.value=n}map(e){let n=this.type.map(this.value,e);return n===void 0?void 0:n==this.value?this:new StateEffect(this.type,n)}is(e){return this.type==e}static define(e={}){return new StateEffectType(e.map||(n=>n))}static mapEffects(e,n){if(!e.length)return e;let r=[];for(let s of e){let l=s.map(n);l&&r.push(l)}return r}}StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();class Transaction{constructor(e,n,r,s,l,a){this.startState=e,this.changes=n,this.selection=r,this.effects=s,this.annotations=l,this.scrollIntoView=a,this._doc=null,this._state=null,r&&checkSelection(r,n.newLength),l.some(h=>h.type==Transaction.time)||(this.annotations=l.concat(Transaction.time.of(Date.now())))}static create(e,n,r,s,l,a){return new Transaction(e,n,r,s,l,a)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let n of this.annotations)if(n.type==e)return n.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let n=this.annotation(Transaction.userEvent);return!!(n&&(n==e||n.length>e.length&&n.slice(0,e.length)==e&&n[e.length]=="."))}}Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(o,e){let n=[];for(let r=0,s=0;;){let l,a;if(r<o.length&&(s==e.length||e[s]>=o[r]))l=o[r++],a=o[r++];else if(s<e.length)l=e[s++],a=e[s++];else return n;!n.length||n[n.length-1]<l?n.push(l,a):n[n.length-1]<a&&(n[n.length-1]=a)}}function mergeTransaction(o,e,n){var r;let s,l,a;return n?(s=e.changes,l=ChangeSet.empty(e.changes.length),a=o.changes.compose(e.changes)):(s=e.changes.map(o.changes),l=o.changes.mapDesc(e.changes,!0),a=o.changes.compose(s)),{changes:a,selection:e.selection?e.selection.map(l):(r=o.selection)===null||r===void 0?void 0:r.map(s),effects:StateEffect.mapEffects(o.effects,s).concat(StateEffect.mapEffects(e.effects,l)),annotations:o.annotations.length?o.annotations.concat(e.annotations):e.annotations,scrollIntoView:o.scrollIntoView||e.scrollIntoView}}function resolveTransactionInner(o,e,n){let r=e.selection,s=asArray$1(e.annotations);return e.userEvent&&(s=s.concat(Transaction.userEvent.of(e.userEvent))),{changes:e.changes instanceof ChangeSet?e.changes:ChangeSet.of(e.changes||[],n,o.facet(lineSeparator)),selection:r&&(r instanceof EditorSelection?r:EditorSelection.single(r.anchor,r.head)),effects:asArray$1(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function resolveTransaction(o,e,n){let r=resolveTransactionInner(o,e.length?e[0]:{},o.doc.length);e.length&&e[0].filter===!1&&(n=!1);for(let l=1;l<e.length;l++){e[l].filter===!1&&(n=!1);let a=!!e[l].sequential;r=mergeTransaction(r,resolveTransactionInner(o,e[l],a?r.changes.newLength:o.doc.length),a)}let s=Transaction.create(o,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return extendTransaction(n?filterTransaction(s):s)}function filterTransaction(o){let e=o.startState,n=!0;for(let s of e.facet(changeFilter)){let l=s(o);if(l===!1){n=!1;break}Array.isArray(l)&&(n=n===!0?l:joinRanges(n,l))}if(n!==!0){let s,l;if(n===!1)l=o.changes.invertedDesc,s=ChangeSet.empty(e.doc.length);else{let a=o.changes.filter(n);s=a.changes,l=a.filtered.mapDesc(a.changes).invertedDesc}o=Transaction.create(e,s,o.selection&&o.selection.map(l),StateEffect.mapEffects(o.effects,l),o.annotations,o.scrollIntoView)}let r=e.facet(transactionFilter);for(let s=r.length-1;s>=0;s--){let l=r[s](o);l instanceof Transaction?o=l:Array.isArray(l)&&l.length==1&&l[0]instanceof Transaction?o=l[0]:o=resolveTransaction(e,asArray$1(l),!1)}return o}function extendTransaction(o){let e=o.startState,n=e.facet(transactionExtender),r=o;for(let s=n.length-1;s>=0;s--){let l=n[s](o);l&&Object.keys(l).length&&(r=mergeTransaction(r,resolveTransactionInner(e,l,o.changes.newLength),!0))}return r==o?o:Transaction.create(e,o.changes,o.selection,r.effects,r.annotations,r.scrollIntoView)}const none=[];function asArray$1(o){return o==null?none:Array.isArray(o)?o:[o]}var CharCategory=function(o){return o[o.Word=0]="Word",o[o.Space=1]="Space",o[o.Other=2]="Other",o}(CharCategory||(CharCategory={}));const nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hasWordChar(o){if(wordChar)return wordChar.test(o);for(let e=0;e<o.length;e++){let n=o[e];if(/\w/.test(n)||n>"\x80"&&(n.toUpperCase()!=n.toLowerCase()||nonASCIISingleCaseWordChar.test(n)))return!0}return!1}function makeCategorizer(o){return e=>{if(!/\S/.test(e))return CharCategory.Space;if(hasWordChar(e))return CharCategory.Word;for(let n=0;n<o.length;n++)if(e.indexOf(o[n])>-1)return CharCategory.Word;return CharCategory.Other}}class EditorState{constructor(e,n,r,s,l,a){this.config=e,this.doc=n,this.selection=r,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=l,a&&(a._state=this);for(let h=0;h<this.config.dynamicSlots.length;h++)ensureAddr(this,h<<1);this.computeSlot=null}field(e,n=!0){let r=this.config.address[e.id];if(r==null){if(n)throw new RangeError("Field is not present in this state");return}return ensureAddr(this,r),getAddr(this,r)}update(...e){return resolveTransaction(this,e,!0)}applyTransaction(e){let n=this.config,{base:r,compartments:s}=n;for(let a of e.effects)a.is(Compartment.reconfigure)?(n&&(s=new Map,n.compartments.forEach((h,c)=>s.set(c,h)),n=null),s.set(a.value.compartment,a.value.extension)):a.is(StateEffect.reconfigure)?(n=null,r=a.value):a.is(StateEffect.appendConfig)&&(n=null,r=asArray$1(r).concat(a.value));let l;n?l=e.startState.values.slice():(n=Configuration.resolve(r,s,this),l=new EditorState(n,this.doc,this.selection,n.dynamicSlots.map(()=>null),(h,c)=>c.reconfigure(h,this),null).values),new EditorState(n,e.newDoc,e.newSelection,l,(a,h)=>h.update(a,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:e},range:EditorSelection.cursor(n.from+e.length)}))}changeByRange(e){let n=this.selection,r=e(n.ranges[0]),s=this.changes(r.changes),l=[r.range],a=asArray$1(r.effects);for(let h=1;h<n.ranges.length;h++){let c=e(n.ranges[h]),u=this.changes(c.changes),f=u.map(s);for(let g=0;g<h;g++)l[g]=l[g].map(f);let d=s.mapDesc(u,!0);l.push(c.range.map(d)),s=s.compose(f),a=StateEffect.mapEffects(a,f).concat(StateEffect.mapEffects(asArray$1(c.effects),d))}return{changes:s,selection:EditorSelection.create(l,n.mainIndex),effects:a}}changes(e=[]){return e instanceof ChangeSet?e:ChangeSet.of(e,this.doc.length,this.facet(EditorState.lineSeparator))}toText(e){return Text.of(e.split(this.facet(EditorState.lineSeparator)||DefaultSplit))}sliceDoc(e=0,n=this.doc.length){return this.doc.sliceString(e,n,this.lineBreak)}facet(e){let n=this.config.address[e.id];return n==null?e.default:(ensureAddr(this,n),getAddr(this,n))}toJSON(e){let n={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let s=e[r];s instanceof StateField&&this.config.address[s.id]!=null&&(n[r]=s.spec.toJSON(this.field(e[r]),this))}return n}static fromJSON(e,n={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(r){for(let l in r)if(Object.prototype.hasOwnProperty.call(e,l)){let a=r[l],h=e[l];s.push(a.init(c=>a.spec.fromJSON(h,c)))}}return EditorState.create({doc:e.doc,selection:EditorSelection.fromJSON(e.selection),extensions:n.extensions?s.concat([n.extensions]):s})}static create(e={}){let n=Configuration.resolve(e.extensions||[],new Map),r=e.doc instanceof Text?e.doc:Text.of((e.doc||"").split(n.staticFacet(EditorState.lineSeparator)||DefaultSplit)),s=e.selection?e.selection instanceof EditorSelection?e.selection:EditorSelection.single(e.selection.anchor,e.selection.head):EditorSelection.single(0);return checkSelection(s,r.length),n.staticFacet(allowMultipleSelections)||(s=s.asSingle()),new EditorState(n,r,s,n.dynamicSlots.map(()=>null),(l,a)=>a.create(l),null)}get tabSize(){return this.facet(EditorState.tabSize)}get lineBreak(){return this.facet(EditorState.lineSeparator)||`
`}get readOnly(){return this.facet(readOnly)}phrase(e,...n){for(let r of this.facet(EditorState.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return n.length&&(e=e.replace(/\$(\$|\d*)/g,(r,s)=>{if(s=="$")return"$";let l=+(s||1);return!l||l>n.length?r:n[l-1]})),e}languageDataAt(e,n,r=-1){let s=[];for(let l of this.facet(languageData))for(let a of l(this,n,r))Object.prototype.hasOwnProperty.call(a,e)&&s.push(a[e]);return s}charCategorizer(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:n,from:r,length:s}=this.doc.lineAt(e),l=this.charCategorizer(e),a=e-r,h=e-r;for(;a>0;){let c=findClusterBreak(n,a,!1);if(l(n.slice(c,a))!=CharCategory.Word)break;a=c}for(;h<s;){let c=findClusterBreak(n,h);if(l(n.slice(h,c))!=CharCategory.Word)break;h=c}return a==h?null:EditorSelection.range(a+r,h+r)}}EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:o=>o.length?o[0]:4});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define({compare(o,e){let n=Object.keys(o),r=Object.keys(e);return n.length==r.length&&n.every(s=>o[s]==e[s])}});EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(o,e,n={}){let r={};for(let s of o)for(let l of Object.keys(s)){let a=s[l],h=r[l];if(h===void 0)r[l]=a;else if(!(h===a||a===void 0))if(Object.hasOwnProperty.call(n,l))r[l]=n[l](h,a);else throw new Error("Config merge conflict for field "+l)}for(let s in e)r[s]===void 0&&(r[s]=e[s]);return r}class RangeValue{eq(e){return this==e}range(e,n=e){return Range$1.create(e,n,this)}}RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=!1;RangeValue.prototype.mapMode=MapMode.TrackDel;class Range$1{constructor(e,n,r){this.from=e,this.to=n,this.value=r}static create(e,n,r){return new Range$1(e,n,r)}}function cmpRange(o,e){return o.from-e.from||o.value.startSide-e.value.startSide}class Chunk{constructor(e,n,r,s){this.from=e,this.to=n,this.value=r,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,n,r,s=0){let l=r?this.to:this.from;for(let a=s,h=l.length;;){if(a==h)return a;let c=a+h>>1,u=l[c]-e||(r?this.value[c].endSide:this.value[c].startSide)-n;if(c==a)return u>=0?a:h;u>=0?h=c:a=c+1}}between(e,n,r,s){for(let l=this.findIndex(n,-1e9,!0),a=this.findIndex(r,1e9,!1,l);l<a;l++)if(s(this.from[l]+e,this.to[l]+e,this.value[l])===!1)return!1}map(e,n){let r=[],s=[],l=[],a=-1,h=-1;for(let c=0;c<this.value.length;c++){let u=this.value[c],f=this.from[c]+e,d=this.to[c]+e,g,p;if(f==d){let m=n.mapPos(f,u.startSide,u.mapMode);if(m==null||(g=p=m,u.startSide!=u.endSide&&(p=n.mapPos(f,u.endSide),p<g)))continue}else if(g=n.mapPos(f,u.startSide),p=n.mapPos(d,u.endSide),g>p||g==p&&u.startSide>0&&u.endSide<=0)continue;(p-g||u.endSide-u.startSide)<0||(a<0&&(a=g),u.point&&(h=Math.max(h,p-g)),r.push(u),s.push(g-a),l.push(p-a))}return{mapped:r.length?new Chunk(s,l,r,h):null,pos:a}}}class RangeSet{constructor(e,n,r,s){this.chunkPos=e,this.chunk=n,this.nextLayer=r,this.maxPoint=s}static create(e,n,r,s){return new RangeSet(e,n,r,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let n of this.chunk)e+=n.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:n=[],sort:r=!1,filterFrom:s=0,filterTo:l=this.length}=e,a=e.filter;if(n.length==0&&!a)return this;if(r&&(n=n.slice().sort(cmpRange)),this.isEmpty)return n.length?RangeSet.of(n):this;let h=new LayerCursor(this,null,-1).goto(0),c=0,u=[],f=new RangeSetBuilder;for(;h.value||c<n.length;)if(c<n.length&&(h.from-n[c].from||h.startSide-n[c].value.startSide)>=0){let d=n[c++];f.addInner(d.from,d.to,d.value)||u.push(d)}else h.rangeIndex==1&&h.chunkIndex<this.chunk.length&&(c==n.length||this.chunkEnd(h.chunkIndex)<n[c].from)&&(!a||s>this.chunkEnd(h.chunkIndex)||l<this.chunkPos[h.chunkIndex])&&f.addChunk(this.chunkPos[h.chunkIndex],this.chunk[h.chunkIndex])?h.nextChunk():((!a||s>h.to||l<h.from||a(h.from,h.to,h.value))&&(f.addInner(h.from,h.to,h.value)||u.push(Range$1.create(h.from,h.to,h.value))),h.next());return f.finishInner(this.nextLayer.isEmpty&&!u.length?RangeSet.empty:this.nextLayer.update({add:u,filter:a,filterFrom:s,filterTo:l}))}map(e){if(e.empty||this.isEmpty)return this;let n=[],r=[],s=-1;for(let a=0;a<this.chunk.length;a++){let h=this.chunkPos[a],c=this.chunk[a],u=e.touchesRange(h,h+c.length);if(u===!1)s=Math.max(s,c.maxPoint),n.push(c),r.push(e.mapPos(h));else if(u===!0){let{mapped:f,pos:d}=c.map(h,e);f&&(s=Math.max(s,f.maxPoint),n.push(f),r.push(d))}}let l=this.nextLayer.map(e);return n.length==0?l:new RangeSet(r,n,l||RangeSet.empty,s)}between(e,n,r){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let l=this.chunkPos[s],a=this.chunk[s];if(n>=l&&e<=l+a.length&&a.between(l,e-l,n-l,r)===!1)return}this.nextLayer.between(e,n,r)}}iter(e=0){return HeapCursor.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,n=0){return HeapCursor.from(e).goto(n)}static compare(e,n,r,s,l=-1){let a=e.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=l),h=n.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=l),c=findSharedChunks(a,h,r),u=new SpanCursor(a,c,l),f=new SpanCursor(h,c,l);r.iterGaps((d,g,p)=>compare(u,d,f,g,p,s)),r.empty&&r.length==0&&compare(u,0,f,0,0,s)}static eq(e,n,r=0,s){s==null&&(s=1e9-1);let l=e.filter(f=>!f.isEmpty&&n.indexOf(f)<0),a=n.filter(f=>!f.isEmpty&&e.indexOf(f)<0);if(l.length!=a.length)return!1;if(!l.length)return!0;let h=findSharedChunks(l,a),c=new SpanCursor(l,h,0).goto(r),u=new SpanCursor(a,h,0).goto(r);for(;;){if(c.to!=u.to||!sameValues(c.active,u.active)||c.point&&(!u.point||!c.point.eq(u.point)))return!1;if(c.to>s)return!0;c.next(),u.next()}}static spans(e,n,r,s,l=-1){let a=new SpanCursor(e,null,l).goto(n),h=n,c=a.openStart;for(;;){let u=Math.min(a.to,r);if(a.point?(s.point(h,u,a.point,a.activeForPoint(a.to),c,a.pointRank),c=a.openEnd(u)+(a.to>u?1:0)):u>h&&(s.span(h,u,a.active,c),c=a.openEnd(u)),a.to>r)break;h=a.to,a.next()}return c}static of(e,n=!1){let r=new RangeSetBuilder;for(let s of e instanceof Range$1?[e]:n?lazySort(e):e)r.add(s.from,s.to,s.value);return r.finish()}}RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(o){if(o.length>1)for(let e=o[0],n=1;n<o.length;n++){let r=o[n];if(cmpRange(e,r)>0)return o.slice().sort(cmpRange);e=r}return o}RangeSet.empty.nextLayer=RangeSet.empty;class RangeSetBuilder{constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}finishChunk(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}add(e,n,r){this.addInner(e,n,r)||(this.nextLayer||(this.nextLayer=new RangeSetBuilder)).add(e,n,r)}addInner(e,n,r){let s=e-this.lastTo||r.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(n-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=n,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,n-e)),!0)}addChunk(e,n){if((e-this.lastTo||n.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,n.maxPoint),this.chunks.push(n),this.chunkPos.push(e);let r=n.value.length-1;return this.last=n.value[r],this.lastFrom=n.from[r]+e,this.lastTo=n.to[r]+e,!0}finish(){return this.finishInner(RangeSet.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let n=RangeSet.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,n}}function findSharedChunks(o,e,n){let r=new Map;for(let l of o)for(let a=0;a<l.chunk.length;a++)l.chunk[a].maxPoint<=0&&r.set(l.chunk[a],l.chunkPos[a]);let s=new Set;for(let l of e)for(let a=0;a<l.chunk.length;a++){let h=r.get(l.chunk[a]);h!=null&&(n?n.mapPos(h):h)==l.chunkPos[a]&&!(n!=null&&n.touchesRange(h,h+l.chunk[a].length))&&s.add(l.chunk[a])}return s}class LayerCursor{constructor(e,n,r,s=0){this.layer=e,this.skip=n,this.minPoint=r,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,n=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,n,!1),this}gotoInner(e,n,r){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],n,!0);(!r||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,n){(this.to-e||this.endSide-n)<0&&this.gotoInner(e,n,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],n=this.layer.chunk[this.chunkIndex],r=e+n.from[this.rangeIndex];if(this.from=r,this.to=e+n.to[this.rangeIndex],this.value=n.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class HeapCursor{constructor(e){this.heap=e}static from(e,n=null,r=-1){let s=[];for(let l=0;l<e.length;l++)for(let a=e[l];!a.isEmpty;a=a.nextLayer)a.maxPoint>=r&&s.push(new LayerCursor(a,n,r,l));return s.length==1?s[0]:new HeapCursor(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,n=-1e9){for(let r of this.heap)r.goto(e,n);for(let r=this.heap.length>>1;r>=0;r--)heapBubble(this.heap,r);return this.next(),this}forward(e,n){for(let r of this.heap)r.forward(e,n);for(let r=this.heap.length>>1;r>=0;r--)heapBubble(this.heap,r);(this.to-e||this.value.endSide-n)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),heapBubble(this.heap,0)}}}function heapBubble(o,e){for(let n=o[e];;){let r=(e<<1)+1;if(r>=o.length)break;let s=o[r];if(r+1<o.length&&s.compare(o[r+1])>=0&&(s=o[r+1],r++),n.compare(s)<0)break;o[r]=n,o[e]=s,e=r}}class SpanCursor{constructor(e,n,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=HeapCursor.from(e,n,r)}goto(e,n=-1e9){return this.cursor.goto(e,n),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=n,this.openStart=-1,this.next(),this}forward(e,n){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-n)<0;)this.removeActive(this.minActive);this.cursor.forward(e,n)}removeActive(e){remove(this.active,e),remove(this.activeTo,e),remove(this.activeRank,e),this.minActive=findMinIndex(this.active,this.activeTo)}addActive(e){let n=0,{value:r,to:s,rank:l}=this.cursor;for(;n<this.activeRank.length&&this.activeRank[n]<=l;)n++;insert(this.active,n,r),insert(this.activeTo,n,s),insert(this.activeRank,n,l),e&&insert(e,n,this.cursor.from),this.minActive=findMinIndex(this.active,this.activeTo)}next(){let e=this.to,n=this.point;this.point=null;let r=this.openStart<0?[]:null,s=0;for(;;){let l=this.minActive;if(l>-1&&(this.activeTo[l]-this.cursor.from||this.active[l].endSide-this.cursor.startSide)<0){if(this.activeTo[l]>e){this.to=this.activeTo[l],this.endSide=this.active[l].endSide;break}this.removeActive(l),r&&remove(r,l)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let a=this.cursor.value;if(!a.point)this.addActive(r),this.cursor.from<e&&this.cursor.to>e&&s++,this.cursor.next();else if(n&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=a,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=a.endSide,this.cursor.from<e&&(s=1),this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){let l=0;for(;l<r.length&&r[l]<e;)l++;this.openStart=l+s}}activeForPoint(e){if(!this.active.length)return this.active;let n=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&n.push(this.active[r]);return n.reverse()}openEnd(e){let n=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)n++;return n}}function compare(o,e,n,r,s,l){o.goto(e),n.goto(r);let a=r+s,h=r,c=r-e;for(;;){let u=o.to+c-n.to||o.endSide-n.endSide,f=u<0?o.to+c:n.to,d=Math.min(f,a);if(o.point||n.point?o.point&&n.point&&(o.point==n.point||o.point.eq(n.point))&&sameValues(o.activeForPoint(o.to+c),n.activeForPoint(n.to))||l.comparePoint(h,d,o.point,n.point):d>h&&!sameValues(o.active,n.active)&&l.compareRange(h,d,o.active,n.active),f>a)break;h=f,u<=0&&o.next(),u>=0&&n.next()}}function sameValues(o,e){if(o.length!=e.length)return!1;for(let n=0;n<o.length;n++)if(o[n]!=e[n]&&!o[n].eq(e[n]))return!1;return!0}function remove(o,e){for(let n=e,r=o.length-1;n<r;n++)o[n]=o[n+1];o.pop()}function insert(o,e,n){for(let r=o.length-1;r>=e;r--)o[r+1]=o[r];o[e]=n}function findMinIndex(o,e){let n=-1,r=1e9;for(let s=0;s<e.length;s++)(e[s]-r||o[s].endSide-o[n].endSide)<0&&(n=s,r=e[s]);return n}function countColumn(o,e,n=o.length){let r=0;for(let s=0;s<n;)o.charCodeAt(s)==9?(r+=e-r%e,s++):(r++,s=findClusterBreak(o,s));return r}function findColumn(o,e,n,r){for(let s=0,l=0;;){if(l>=e)return s;if(s==o.length)break;l+=o.charCodeAt(s)==9?n-l%n:1,s=findClusterBreak(o,s)}return r===!0?-1:o.length}const C="\u037C",COUNT=typeof Symbol>"u"?"__"+C:Symbol.for(C),SET=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),top=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class StyleModule{constructor(e,n){this.rules=[];let{finish:r}=n||{};function s(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function l(a,h,c,u){let f=[],d=/^@(\w+)\b/.exec(a[0]),g=d&&d[1]=="keyframes";if(d&&h==null)return c.push(a[0]+";");for(let p in h){let m=h[p];if(/&/.test(p))l(p.split(/,\s*/).map(w=>a.map(y=>w.replace(/&/,y))).reduce((w,y)=>w.concat(y)),m,c);else if(m&&typeof m=="object"){if(!d)throw new RangeError("The value of a property ("+p+") should be a primitive value.");l(s(p),m,f,g)}else m!=null&&f.push(p.replace(/_.*/,"").replace(/[A-Z]/g,w=>"-"+w.toLowerCase())+": "+m+";")}(f.length||g)&&c.push((r&&!d&&!u?a.map(r):a).join(", ")+" {"+f.join(" ")+"}")}for(let a in e)l(s(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=top[COUNT]||1;return top[COUNT]=e+1,C+e.toString(36)}static mount(e,n){(e[SET]||new StyleSet(e)).mount(Array.isArray(n)?n:[n])}}let adoptedSet=null;class StyleSet{constructor(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet<"u"){if(adoptedSet)return e.adoptedStyleSheets=[adoptedSet.sheet].concat(e.adoptedStyleSheets),e[SET]=adoptedSet;this.sheet=new CSSStyleSheet,e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets),adoptedSet=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");let n=e.head||e;n.insertBefore(this.styleTag,n.firstChild)}this.modules=[],e[SET]=this}mount(e){let n=this.sheet,r=0,s=0;for(let l=0;l<e.length;l++){let a=e[l],h=this.modules.indexOf(a);if(h<s&&h>-1&&(this.modules.splice(h,1),s--,h=-1),h==-1){if(this.modules.splice(s++,0,a),n)for(let c=0;c<a.rules.length;c++)n.insertRule(a.rules[c],r++)}else{for(;s<h;)r+=this.modules[s++].rules.length;r+=a.rules.length,s++}}if(!n){let l="";for(let a=0;a<this.modules.length;a++)l+=this.modules[a].getRules()+`
`;this.styleTag.textContent=l}}}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},chrome$1=typeof navigator<"u"&&/Chrome\/(\d+)/.exec(navigator.userAgent);typeof navigator<"u"&&/Gecko\/\d+/.test(navigator.userAgent);var mac=typeof navigator<"u"&&/Mac/.test(navigator.platform),ie$1=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),brokenModifierNames=mac||chrome$1&&+chrome$1[1]<57;for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(o){var e=brokenModifierNames&&(o.ctrlKey||o.altKey||o.metaKey)||ie$1&&o.shiftKey&&o.key&&o.key.length==1||o.key=="Unidentified",n=!e&&o.key||(o.shiftKey?shift:base)[o.keyCode]||o.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function getSelection(o){let e;return o.nodeType==11?e=o.getSelection?o:o.ownerDocument:e=o,e.getSelection()}function contains(o,e){return e?o==e||o.contains(e.nodeType!=1?e.parentNode:e):!1}function deepActiveElement(o){let e=o.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function hasSelection(o,e){if(!e.anchorNode)return!1;try{return contains(o,e.anchorNode)}catch{return!1}}function clientRectsFor(o){return o.nodeType==3?textRange(o,0,o.nodeValue.length).getClientRects():o.nodeType==1?o.getClientRects():[]}function isEquivalentPosition(o,e,n,r){return n?scanFor(o,e,n,r,-1)||scanFor(o,e,n,r,1):!1}function domIndex(o){for(var e=0;;e++)if(o=o.previousSibling,!o)return e}function scanFor(o,e,n,r,s){for(;;){if(o==n&&e==r)return!0;if(e==(s<0?0:maxOffset(o))){if(o.nodeName=="DIV")return!1;let l=o.parentNode;if(!l||l.nodeType!=1)return!1;e=domIndex(o)+(s<0?0:1),o=l}else if(o.nodeType==1){if(o=o.childNodes[e+(s<0?-1:0)],o.nodeType==1&&o.contentEditable=="false")return!1;e=s<0?maxOffset(o):0}else return!1}}function maxOffset(o){return o.nodeType==3?o.nodeValue.length:o.childNodes.length}const Rect0={left:0,right:0,top:0,bottom:0};function flattenRect(o,e){let n=e?o.left:o.right;return{left:n,right:n,top:o.top,bottom:o.bottom}}function windowRect(o){return{left:0,right:o.innerWidth,top:0,bottom:o.innerHeight}}function scrollRectIntoView(o,e,n,r,s,l,a,h){let c=o.ownerDocument,u=c.defaultView||window;for(let f=o;f;)if(f.nodeType==1){let d,g=f==c.body;if(g)d=windowRect(u);else{if(f.scrollHeight<=f.clientHeight&&f.scrollWidth<=f.clientWidth){f=f.assignedSlot||f.parentNode;continue}let w=f.getBoundingClientRect();d={left:w.left,right:w.left+f.clientWidth,top:w.top,bottom:w.top+f.clientHeight}}let p=0,m=0;if(s=="nearest")e.top<d.top?(m=-(d.top-e.top+a),n>0&&e.bottom>d.bottom+m&&(m=e.bottom-d.bottom+m+a)):e.bottom>d.bottom&&(m=e.bottom-d.bottom+a,n<0&&e.top-m<d.top&&(m=-(d.top+m-e.top+a)));else{let w=e.bottom-e.top,y=d.bottom-d.top;m=(s=="center"&&w<=y?e.top+w/2-y/2:s=="start"||s=="center"&&n<0?e.top-a:e.bottom-y+a)-d.top}if(r=="nearest"?e.left<d.left?(p=-(d.left-e.left+l),n>0&&e.right>d.right+p&&(p=e.right-d.right+p+l)):e.right>d.right&&(p=e.right-d.right+l,n<0&&e.left<d.left+p&&(p=-(d.left+p-e.left+l))):p=(r=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:r=="start"==h?e.left-l:e.right-(d.right-d.left)+l)-d.left,p||m)if(g)u.scrollBy(p,m);else{let w=0,y=0;if(m){let S=f.scrollTop;f.scrollTop+=m,y=f.scrollTop-S}if(p){let S=f.scrollLeft;f.scrollLeft+=p,w=f.scrollLeft-S}e={left:e.left-w,top:e.top-y,right:e.right-w,bottom:e.bottom-y},w&&Math.abs(w-p)<1&&(r="nearest"),y&&Math.abs(y-m)<1&&(s="nearest")}if(g)break;f=f.assignedSlot||f.parentNode}else if(f.nodeType==11)f=f.host;else break}class DOMSelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)}set(e,n,r,s){this.anchorNode=e,this.anchorOffset=n,this.focusNode=r,this.focusOffset=s}}let preventScrollSupported=null;function focusPreventScroll(o){if(o.setActive)return o.setActive();if(preventScrollSupported)return o.focus(preventScrollSupported);let e=[];for(let n=o;n&&(e.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(o.focus(preventScrollSupported==null?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),!preventScrollSupported){preventScrollSupported=!1;for(let n=0;n<e.length;){let r=e[n++],s=e[n++],l=e[n++];r.scrollTop!=s&&(r.scrollTop=s),r.scrollLeft!=l&&(r.scrollLeft=l)}}}let scratchRange;function textRange(o,e,n=e){let r=scratchRange||(scratchRange=document.createRange());return r.setEnd(o,n),r.setStart(o,e),r}function dispatchKey(o,e,n){let r={key:e,code:e,keyCode:n,which:n,cancelable:!0},s=new KeyboardEvent("keydown",r);s.synthetic=!0,o.dispatchEvent(s);let l=new KeyboardEvent("keyup",r);return l.synthetic=!0,o.dispatchEvent(l),s.defaultPrevented||l.defaultPrevented}function getRoot(o){for(;o;){if(o&&(o.nodeType==9||o.nodeType==11&&o.host))return o;o=o.assignedSlot||o.parentNode}return null}function clearAttributes(o){for(;o.attributes.length;)o.removeAttributeNode(o.attributes[0])}function atElementStart(o,e){let n=e.focusNode,r=e.focusOffset;if(!n||e.anchorNode!=n||e.anchorOffset!=r)return!1;for(;;)if(r){if(n.nodeType!=1)return!1;let s=n.childNodes[r-1];s.contentEditable=="false"?r--:(n=s,r=maxOffset(n))}else{if(n==o)return!0;r=domIndex(n),n=n.parentNode}}class DOMPos{constructor(e,n,r=!0){this.node=e,this.offset=n,this.precise=r}static before(e,n){return new DOMPos(e.parentNode,domIndex(e),n)}static after(e,n){return new DOMPos(e.parentNode,domIndex(e)+1,n)}}const noChildren=[];class ContentView{constructor(){this.parent=null,this.dom=null,this.dirty=2}get editorView(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let n=this.posAtStart;for(let r of this.children){if(r==e)return n;n+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}coordsAt(e,n){return null}sync(e){if(this.dirty&2){let n=this.dom,r=null,s;for(let l of this.children){if(l.dirty){if(!l.dom&&(s=r?r.nextSibling:n.firstChild)){let a=ContentView.get(s);(!a||!a.parent&&a.canReuseDOM(l))&&l.reuseDOM(s)}l.sync(e),l.dirty=0}if(s=r?r.nextSibling:n.firstChild,e&&!e.written&&e.node==n&&s!=l.dom&&(e.written=!0),l.dom.parentNode==n)for(;s&&s!=l.dom;)s=rm$1(s);else n.insertBefore(l.dom,s);r=l.dom}for(s=r?r.nextSibling:n.firstChild,s&&e&&e.node==n&&(e.written=!0);s;)s=rm$1(s)}else if(this.dirty&1)for(let n of this.children)n.dirty&&(n.sync(e),n.dirty=0)}reuseDOM(e){}localPosFromDOM(e,n){let r;if(e==this.dom)r=this.dom.childNodes[n];else{let s=maxOffset(e)==0?0:n==0?-1:1;for(;;){let l=e.parentNode;if(l==this.dom)break;s==0&&l.firstChild!=l.lastChild&&(e==l.firstChild?s=-1:s=1),e=l}s<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!ContentView.get(r);)r=r.nextSibling;if(!r)return this.length;for(let s=0,l=0;;s++){let a=this.children[s];if(a.dom==r)return l;l+=a.length+a.breakAfter}}domBoundsAround(e,n,r=0){let s=-1,l=-1,a=-1,h=-1;for(let c=0,u=r,f=r;c<this.children.length;c++){let d=this.children[c],g=u+d.length;if(u<e&&g>n)return d.domBoundsAround(e,n,u);if(g>=e&&s==-1&&(s=c,l=u),u>n&&d.dom.parentNode==this.dom){a=c,h=f;break}f=g,u=g+d.breakAfter}return{from:l,to:h<0?r+this.length:h,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&a>=0?this.children[a].dom:null}}markDirty(e=!1){this.dirty|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let n=this.parent;n;n=n.parent){if(e&&(n.dirty|=2),n.dirty&1)return;n.dirty|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.dirty&&this.markParentsDirty(!0))}setDOM(e){this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this}get rootView(){for(let e=this;;){let n=e.parent;if(!n)return e;e=n}}replaceChildren(e,n,r=noChildren){this.markDirty();for(let s=e;s<n;s++){let l=this.children[s];l.parent==this&&l.destroy()}this.children.splice(e,n-e,...r);for(let s=0;s<r.length;s++)r[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new ChildCursor(this.children,e,this.children.length)}childPos(e,n=1){return this.childCursor().findPos(e,n)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}merge(e,n,r,s,l,a){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor}getSide(){return 0}destroy(){this.parent=null}}ContentView.prototype.breakAfter=0;function rm$1(o){let e=o.nextSibling;return o.parentNode.removeChild(o),e}class ChildCursor{constructor(e,n,r){this.children=e,this.pos=n,this.i=r,this.off=0}findPos(e,n=1){for(;;){if(e>this.pos||e==this.pos&&(n>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function replaceRange(o,e,n,r,s,l,a,h,c){let{children:u}=o,f=u.length?u[e]:null,d=l.length?l[l.length-1]:null,g=d?d.breakAfter:a;if(!(e==r&&f&&!a&&!g&&l.length<2&&f.merge(n,s,l.length?d:null,n==0,h,c))){if(r<u.length){let p=u[r];p&&s<p.length?(e==r&&(p=p.split(s),s=0),!g&&d&&p.merge(0,s,d,!0,0,c)?l[l.length-1]=p:(s&&p.merge(0,s,null,!1,0,c),l.push(p))):p!=null&&p.breakAfter&&(d?d.breakAfter=1:a=1),r++}for(f&&(f.breakAfter=a,n>0&&(!a&&l.length&&f.merge(n,f.length,l[0],!1,h,0)?f.breakAfter=l.shift().breakAfter:(n<f.length||f.children.length&&f.children[f.children.length-1].length==0)&&f.merge(n,f.length,null,!1,h,0),e++));e<r&&l.length;)if(u[r-1].become(l[l.length-1]))r--,l.pop(),c=l.length?0:h;else if(u[e].become(l[0]))e++,l.shift(),h=l.length?0:c;else break;!l.length&&e&&r<u.length&&!u[e-1].breakAfter&&u[r].merge(0,0,u[e-1],!1,h,c)&&e--,(e<r||l.length)&&o.replaceChildren(e,r,l)}}function mergeChildrenInto(o,e,n,r,s,l){let a=o.childCursor(),{i:h,off:c}=a.findPos(n,1),{i:u,off:f}=a.findPos(e,-1),d=e-n;for(let g of r)d+=g.length;o.length+=d,replaceRange(o,u,f,h,c,r,0,s,l)}let nav=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},doc=typeof document<"u"?document:{documentElement:{style:{}}};const ie_edge=/Edge\/(\d+)/.exec(nav.userAgent),ie_upto10=/MSIE \d/.test(nav.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent),ie=!!(ie_upto10||ie_11up||ie_edge),gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent),chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent),webkit="webkitFontSmoothing"in doc.documentElement.style,safari=!ie&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios,android:/Android\b/.test(nav.userAgent),webkit,safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const MaxJoinLen=256;class TextView extends ContentView{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,n,r){return r&&(!(r instanceof TextView)||this.length-(n-e)+r.length>MaxJoinLen)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(n),this.markDirty(),!0)}split(e){let n=new TextView(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),n}localPosFromDOM(e,n){return e==this.dom?n:n?this.text.length:0}domAtPos(e){return new DOMPos(this.dom,e)}domBoundsAround(e,n,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,n){return textCoords(this.dom,e,n)}}class MarkView extends ContentView{constructor(e,n=[],r=0){super(),this.mark=e,this.children=n,this.length=r;for(let s of n)s.setParent(this)}setAttrs(e){if(clearAttributes(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let n in this.mark.attrs)e.setAttribute(n,this.mark.attrs[n]);return e}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.dirty|=6)}sync(e){this.dom?this.dirty&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e)}merge(e,n,r,s,l,a){return r&&(!(r instanceof MarkView&&r.mark.eq(this.mark))||e&&l<=0||n<this.length&&a<=0)?!1:(mergeChildrenInto(this,e,n,r?r.children:[],l-1,a-1),this.markDirty(),!0)}split(e){let n=[],r=0,s=-1,l=0;for(let h of this.children){let c=r+h.length;c>e&&n.push(r<e?h.split(e-r):h),s<0&&r>=e&&(s=l),r=c,l++}let a=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new MarkView(this.mark,n,a)}domAtPos(e){return inlineDOMAtPos(this,e)}coordsAt(e,n){return coordsInChildren(this,e,n)}}function textCoords(o,e,n){let r=o.nodeValue.length;e>r&&(e=r);let s=e,l=e,a=0;e==0&&n<0||e==r&&n>=0?browser.chrome||browser.gecko||(e?(s--,a=1):l<r&&(l++,a=-1)):n<0?s--:l<r&&l++;let h=textRange(o,s,l).getClientRects();if(!h.length)return Rect0;let c=h[(a?a<0:n>=0)?0:h.length-1];return browser.safari&&!a&&c.width==0&&(c=Array.prototype.find.call(h,u=>u.width)||c),a?flattenRect(c,a<0):c||null}class WidgetView extends ContentView{constructor(e,n,r){super(),this.widget=e,this.length=n,this.side=r,this.prevWidget=null}static create(e,n,r){return new(e.customView||WidgetView)(e,n,r)}split(e){let n=WidgetView.create(this.widget,this.length-e,this.side);return this.length-=e,n}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}getSide(){return this.side}merge(e,n,r,s,l,a){return r&&(!(r instanceof WidgetView)||!this.widget.compare(r.widget)||e>0&&l<=0||n<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}become(e){return e.length==this.length&&e instanceof WidgetView&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.eq(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Text.empty;let e=this;for(;e.parent;)e=e.parent;let n=e.editorView,r=n&&n.state.doc,s=this.posAtStart;return r?r.slice(s,s+this.length):Text.empty}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,n){let r=this.dom.getClientRects(),s=null;if(!r.length)return Rect0;for(let l=e>0?r.length-1:0;s=r[l],!(e>0?l==0:l==r.length-1||s.top<s.bottom);l+=e>0?-1:1);return this.length?s:flattenRect(s,this.side>0)}get isEditable(){return!1}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class CompositionView extends WidgetView{domAtPos(e){let{topView:n,text:r}=this.widget;return n?scanCompositionTree(e,0,n,r,(s,l)=>s.domAtPos(l),s=>new DOMPos(r,Math.min(s,r.nodeValue.length))):new DOMPos(r,Math.min(e,r.nodeValue.length))}sync(){this.setDOM(this.widget.toDOM())}localPosFromDOM(e,n){let{topView:r,text:s}=this.widget;return r?posFromDOMInCompositionTree(e,n,r,s):Math.min(n,this.length)}ignoreMutation(){return!1}get overrideDOMText(){return null}coordsAt(e,n){let{topView:r,text:s}=this.widget;return r?scanCompositionTree(e,n,r,s,(l,a,h)=>l.coordsAt(a,h),(l,a)=>textCoords(s,l,a)):textCoords(s,e,n)}destroy(){var e;super.destroy(),(e=this.widget.topView)===null||e===void 0||e.destroy()}get isEditable(){return!0}canReuseDOM(){return!0}}function scanCompositionTree(o,e,n,r,s,l){if(n instanceof MarkView){for(let a=n.dom.firstChild;a;a=a.nextSibling){let h=ContentView.get(a);if(!h)return l(o,e);let c=contains(a,r),u=h.length+(c?r.nodeValue.length:0);if(o<u||o==u&&h.getSide()<=0)return c?scanCompositionTree(o,e,h,r,s,l):s(h,o,e);o-=u}return s(n,n.length,-1)}else return n.dom==r?l(o,e):s(n,o,e)}function posFromDOMInCompositionTree(o,e,n,r){if(n instanceof MarkView)for(let s of n.children){let l=0,a=contains(s.dom,r);if(contains(s.dom,o))return l+(a?posFromDOMInCompositionTree(o,e,s,r):s.localPosFromDOM(o,e));l+=a?r.nodeValue.length:s.length}else if(n.dom==r)return Math.min(e,r.nodeValue.length);return n.localPosFromDOM(o,e)}class WidgetBufferView extends ContentView{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof WidgetBufferView&&e.side==this.side}split(){return new WidgetBufferView(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return DOMPos.before(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){let n=this.dom.getBoundingClientRect(),r=inlineSiblingRect(this,this.side>0?-1:1);return r&&r.top<n.bottom&&r.bottom>n.top?{left:n.left,right:n.right,top:r.top,bottom:r.bottom}:n}get overrideDOMText(){return Text.empty}}TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineSiblingRect(o,e){let n=o.parent,r=n?n.children.indexOf(o):-1;for(;n&&r>=0;)if(e<0?r>0:r<n.children.length){let s=n.children[r+e];if(s instanceof TextView){let l=s.coordsAt(e<0?s.length:0,e);if(l)return l}r+=e}else if(n instanceof MarkView&&n.parent)r=n.parent.children.indexOf(n)+(e<0?0:1),n=n.parent;else{let s=n.dom.lastChild;if(s&&s.nodeName=="BR")return s.getClientRects()[0];break}}function inlineDOMAtPos(o,e){let n=o.dom,{children:r}=o,s=0;for(let l=0;s<r.length;s++){let a=r[s],h=l+a.length;if(!(h==l&&a.getSide()<=0)){if(e>l&&e<h&&a.dom.parentNode==n)return a.domAtPos(e-l);if(e<=l)break;l=h}}for(let l=s;l>0;l--){let a=r[l-1];if(a.dom.parentNode==n)return a.domAtPos(a.length)}for(let l=s;l<r.length;l++){let a=r[l];if(a.dom.parentNode==n)return a.domAtPos(0)}return new DOMPos(n,0)}function joinInlineInto(o,e,n){let r,{children:s}=o;n>0&&e instanceof MarkView&&s.length&&(r=s[s.length-1])instanceof MarkView&&r.mark.eq(e.mark)?joinInlineInto(r,e.children[0],n-1):(s.push(e),e.setParent(o)),o.length+=e.length}function coordsInChildren(o,e,n){let r=null,s=-1,l=null,a=-1;function h(u,f){for(let d=0,g=0;d<u.children.length&&g<=f;d++){let p=u.children[d],m=g+p.length;m>=f&&(p.children.length?h(p,f-g):!l&&(m>f||g==m&&p.getSide()>0)?(l=p,a=f-g):(g<f||g==m&&p.getSide()<0)&&(r=p,s=f-g)),g=m}}h(o,e);let c=(n<0?r:l)||r||l;return c?c.coordsAt(Math.max(0,c==r?s:a),n):fallbackRect(o)}function fallbackRect(o){let e=o.dom.lastChild;if(!e)return o.dom.getBoundingClientRect();let n=clientRectsFor(e);return n[n.length-1]||null}function combineAttrs(o,e){for(let n in o)n=="class"&&e.class?e.class+=" "+o.class:n=="style"&&e.style?e.style+=";"+o.style:e[n]=o[n];return e}function attrsEq(o,e){if(o==e)return!0;if(!o||!e)return!1;let n=Object.keys(o),r=Object.keys(e);if(n.length!=r.length)return!1;for(let s of n)if(r.indexOf(s)==-1||o[s]!==e[s])return!1;return!0}function updateAttrs(o,e,n){let r=null;if(e)for(let s in e)n&&s in n||o.removeAttribute(r=s);if(n)for(let s in n)e&&e[s]==n[s]||o.setAttribute(r=s,n[s]);return!!r}class WidgetType{eq(e){return!1}updateDOM(e){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}ignoreEvent(e){return!0}get customView(){return null}destroy(e){}}var BlockType=function(o){return o[o.Text=0]="Text",o[o.WidgetBefore=1]="WidgetBefore",o[o.WidgetAfter=2]="WidgetAfter",o[o.WidgetRange=3]="WidgetRange",o}(BlockType||(BlockType={}));class Decoration extends RangeValue{constructor(e,n,r,s){super(),this.startSide=e,this.endSide=n,this.widget=r,this.spec=s}get heightRelevant(){return!1}static mark(e){return new MarkDecoration(e)}static widget(e){let n=e.side||0,r=!!e.block;return n+=r?n>0?3e8:-4e8:n>0?1e8:-1e8,new PointDecoration(e,n,n,r,e.widget||null,!1)}static replace(e){let n=!!e.block,r,s;if(e.isBlockGap)r=-5e8,s=4e8;else{let{start:l,end:a}=getInclusive(e,n);r=(l?n?-3e8:-1:5e8)-1,s=(a?n?2e8:1:-6e8)+1}return new PointDecoration(e,r,s,n,e.widget||null,!0)}static line(e){return new LineDecoration(e)}static set(e,n=!1){return RangeSet.of(e,n)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Decoration.none=RangeSet.empty;class MarkDecoration extends Decoration{constructor(e){let{start:n,end:r}=getInclusive(e);super(n?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){return this==e||e instanceof MarkDecoration&&this.tagName==e.tagName&&this.class==e.class&&attrsEq(this.attrs,e.attrs)}range(e,n=e){if(e>=n)throw new RangeError("Mark decorations may not be empty");return super.range(e,n)}}MarkDecoration.prototype.point=!1;class LineDecoration extends Decoration{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof LineDecoration&&attrsEq(this.spec.attributes,e.spec.attributes)}range(e,n=e){if(n!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,n)}}LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=!0;class PointDecoration extends Decoration{constructor(e,n,r,s,l,a){super(n,r,l,e),this.block=s,this.isReplace=a,this.mapMode=s?n<=0?MapMode.TrackBefore:MapMode.TrackAfter:MapMode.TrackDel}get type(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5}eq(e){return e instanceof PointDecoration&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,n=e){if(this.isReplace&&(e>n||e==n&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,n)}}PointDecoration.prototype.point=!0;function getInclusive(o,e=!1){let{inclusiveStart:n,inclusiveEnd:r}=o;return n==null&&(n=o.inclusive),r==null&&(r=o.inclusive),{start:n!=null?n:e,end:r!=null?r:e}}function widgetsEq(o,e){return o==e||!!(o&&e&&o.compare(e))}function addRange(o,e,n,r=0){let s=n.length-1;s>=0&&n[s]+r>=o?n[s]=Math.max(n[s],e):n.push(o,e)}class LineView extends ContentView{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,n,r,s,l,a){if(r){if(!(r instanceof LineView))return!1;this.dom||r.transferDOM(this)}return s&&this.setDeco(r?r.attrs:null),mergeChildrenInto(this,e,n,r?r.children:[],l,a),!0}split(e){let n=new LineView;if(n.breakAfter=this.breakAfter,this.length==0)return n;let{i:r,off:s}=this.childPos(e);s&&(n.append(this.children[r].split(s),0),this.children[r].merge(s,this.children[r].length,null,!1,0,0),r++);for(let l=r;l<this.children.length;l++)n.append(this.children[l],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,n}transferDOM(e){!this.dom||(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){attrsEq(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,n){joinInlineInto(this,e,n)}addLineDeco(e){let n=e.spec.attributes,r=e.spec.class;n&&(this.attrs=combineAttrs(n,this.attrs||{})),r&&(this.attrs=combineAttrs({class:r},this.attrs||{}))}domAtPos(e){return inlineDOMAtPos(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.dirty|=6)}sync(e){var n;this.dom?this.dirty&4&&(clearAttributes(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(updateAttrs(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e);let r=this.dom.lastChild;for(;r&&ContentView.get(r)instanceof MarkView;)r=r.lastChild;if(!r||!this.length||r.nodeName!="BR"&&((n=ContentView.get(r))===null||n===void 0?void 0:n.isEditable)==!1&&(!browser.ios||!this.children.some(s=>s instanceof TextView))){let s=document.createElement("BR");s.cmIgnore=!0,this.dom.appendChild(s)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0;for(let n of this.children){if(!(n instanceof TextView)||/[^ -~]/.test(n.text))return null;let r=clientRectsFor(n.dom);if(r.length!=1)return null;e+=r[0].width}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}:null}coordsAt(e,n){return coordsInChildren(this,e,n)}become(e){return!1}get type(){return BlockType.Text}static find(e,n){for(let r=0,s=0;r<e.children.length;r++){let l=e.children[r],a=s+l.length;if(a>=n){if(l instanceof LineView)return l;if(a>n)break}s=a+l.breakAfter}return null}}class BlockWidgetView extends ContentView{constructor(e,n,r){super(),this.widget=e,this.length=n,this.type=r,this.breakAfter=0,this.prevWidget=null}merge(e,n,r,s,l,a){return r&&(!(r instanceof BlockWidgetView)||!this.widget.compare(r.widget)||e>0&&l<=0||n<this.length&&a<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}domAtPos(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)}split(e){let n=this.length-e;this.length=e;let r=new BlockWidgetView(this.widget,n,this.type);return r.breakAfter=this.breakAfter,r}get children(){return noChildren}sync(){(!this.dom||!this.widget.updateDOM(this.dom))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(this.editorView)),this.dom.contentEditable="false")}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty}domBoundsAround(){return null}become(e){return e instanceof BlockWidgetView&&e.type==this.type&&e.widget.constructor==this.widget.constructor?(e.widget.eq(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class ContentBuilder{constructor(e,n,r,s){this.doc=e,this.pos=n,this.end=r,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=n}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)}getLine(){return this.curLine||(this.content.push(this.curLine=new LineView),this.atCursorPos=!0),this.curLine}flushBuffer(e){this.pendingBuffer&&(this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer([]),this.curLine=null,this.content.push(e)}finish(e){e?this.pendingBuffer=0:this.flushBuffer([]),this.posCovered()||this.getLine()}buildText(e,n,r){for(;e>0;){if(this.textOff==this.text.length){let{value:l,lineBreak:a,done:h}=this.cursor.next(this.skip);if(this.skip=0,h)throw new Error("Ran out of text content when drawing inline views");if(a){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer([]),this.curLine=null,e--;continue}else this.text=l,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(n.slice(0,r)),this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+s)),n),r),this.atCursorPos=!0,this.textOff+=s,e-=s,r=0}}span(e,n,r,s){this.buildText(n-e,r,s),this.pos=n,this.openStart<0&&(this.openStart=s)}point(e,n,r,s,l,a){if(this.disallowBlockEffectsFor[a]&&r instanceof PointDecoration){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(n>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let h=n-e;if(r instanceof PointDecoration)if(r.block){let{type:c}=r;c==BlockType.WidgetAfter&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new BlockWidgetView(r.widget||new NullWidget("div"),h,c))}else{let c=WidgetView.create(r.widget||new NullWidget("span"),h,h?0:r.startSide),u=this.atCursorPos&&!c.isEditable&&l<=s.length&&(e<n||r.startSide>0),f=!c.isEditable&&(e<n||r.startSide<=0),d=this.getLine();this.pendingBuffer==2&&!u&&(this.pendingBuffer=0),this.flushBuffer(s),u&&(d.append(wrapMarks(new WidgetBufferView(1),s),l),l=s.length+Math.max(0,l-s.length)),d.append(wrapMarks(c,s),l),this.atCursorPos=f,this.pendingBuffer=f?e<n?1:2:0}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);h&&(this.textOff+h<=this.text.length?this.textOff+=h:(this.skip+=h-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=n),this.openStart<0&&(this.openStart=l)}static build(e,n,r,s,l){let a=new ContentBuilder(e,n,r,l);return a.openEnd=RangeSet.spans(s,n,r,a),a.openStart<0&&(a.openStart=a.openEnd),a.finish(a.openEnd),a}}function wrapMarks(o,e){for(let n of e)o=new MarkView(n,[o],o.length);return o}class NullWidget extends WidgetType{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}}const clickAddsSelectionRange=Facet.define(),dragMovesSelection$1=Facet.define(),mouseSelectionStyle=Facet.define(),exceptionSink=Facet.define(),updateListener=Facet.define(),inputHandler=Facet.define(),perLineTextDirection=Facet.define({combine:o=>o.some(e=>e)}),nativeSelectionHidden=Facet.define({combine:o=>o.some(e=>e)});class ScrollTarget{constructor(e,n="nearest",r="nearest",s=5,l=5){this.range=e,this.y=n,this.x=r,this.yMargin=s,this.xMargin=l}map(e){return e.empty?this:new ScrollTarget(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)}}const scrollIntoView=StateEffect.define({map:(o,e)=>o.map(e)});function logException(o,e,n){let r=o.facet(exceptionSink);r.length?r[0](e):window.onerror?window.onerror(String(e),n,void 0,void 0,e):n?console.error(n+":",e):console.error(e)}const editable=Facet.define({combine:o=>o.length?o[0]:!0});let nextPluginID=0;const viewPlugin=Facet.define();class ViewPlugin{constructor(e,n,r,s){this.id=e,this.create=n,this.domEventHandlers=r,this.extension=s(this)}static define(e,n){const{eventHandlers:r,provide:s,decorations:l}=n||{};return new ViewPlugin(nextPluginID++,e,r,a=>{let h=[viewPlugin.of(a)];return l&&h.push(decorations.of(c=>{let u=c.plugin(a);return u?l(u):Decoration.none})),s&&h.push(s(a)),h})}static fromClass(e,n){return ViewPlugin.define(r=>new e(r),n)}}class PluginInstance{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let n=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(n)}catch(r){if(logException(n.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(n){logException(e.state,n,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var n;if(!((n=this.value)===null||n===void 0)&&n.destroy)try{this.value.destroy()}catch(r){logException(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const editorAttributes=Facet.define(),contentAttributes=Facet.define(),decorations=Facet.define(),atomicRanges=Facet.define(),scrollMargins=Facet.define(),styleModule=Facet.define();class ChangedRange{constructor(e,n,r,s){this.fromA=e,this.toA=n,this.fromB=r,this.toB=s}join(e){return new ChangedRange(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let n=e.length,r=this;for(;n>0;n--){let s=e[n-1];if(!(s.fromA>r.toA)){if(s.toA<r.fromA)break;r=r.join(s),e.splice(n-1,1)}}return e.splice(n,0,r),e}static extendWithRanges(e,n){if(n.length==0)return e;let r=[];for(let s=0,l=0,a=0,h=0;;s++){let c=s==e.length?null:e[s],u=a-h,f=c?c.fromB:1e9;for(;l<n.length&&n[l]<f;){let d=n[l],g=n[l+1],p=Math.max(h,d),m=Math.min(f,g);if(p<=m&&new ChangedRange(p+u,m+u,p,m).addToSet(r),g>f)break;l+=2}if(!c)return r;new ChangedRange(c.fromA,c.toA,c.fromB,c.toB).addToSet(r),a=c.toA,h=c.toB}}}class ViewUpdate{constructor(e,n,r){this.view=e,this.state=n,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=ChangeSet.empty(this.startState.doc.length);for(let a of r)this.changes=this.changes.compose(a.changes);let s=[];this.changes.iterChangedRanges((a,h,c,u)=>s.push(new ChangedRange(a,h,c,u))),this.changedRanges=s;let l=e.hasFocus;l!=e.inputState.notifiedFocused&&(e.inputState.notifiedFocused=l,this.flags|=1)}static create(e,n,r){return new ViewUpdate(e,n,r)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}var Direction=function(o){return o[o.LTR=0]="LTR",o[o.RTL=1]="RTL",o}(Direction||(Direction={}));const LTR=Direction.LTR,RTL=Direction.RTL;function dec(o){let e=[];for(let n=0;n<o.length;n++)e.push(1<<+o[n]);return e}const LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Brackets=Object.create(null),BracketStack=[];for(let o of["()","[]","{}"]){let e=o.charCodeAt(0),n=o.charCodeAt(1);Brackets[e]=n,Brackets[n]=-e}function charType(o){return o<=247?LowTypes[o]:1424<=o&&o<=1524?2:1536<=o&&o<=1785?ArabicTypes[o-1536]:1774<=o&&o<=2220?4:8192<=o&&o<=8203?256:64336<=o&&o<=65023?4:o==8204?256:1}const BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class BidiSpan{constructor(e,n,r){this.from=e,this.to=n,this.level=r}get dir(){return this.level%2?RTL:LTR}side(e,n){return this.dir==n==e?this.to:this.from}static find(e,n,r,s){let l=-1;for(let a=0;a<e.length;a++){let h=e[a];if(h.from<=n&&h.to>=n){if(h.level==r)return a;(l<0||(s!=0?s<0?h.from<n:h.to>n:e[l].level>h.level))&&(l=a)}}if(l<0)throw new RangeError("Index out of range");return l}}const types=[];function computeOrder(o,e){let n=o.length,r=e==LTR?1:2,s=e==LTR?2:1;if(!o||r==1&&!BidiRE.test(o))return trivialOrder(n);for(let a=0,h=r,c=r;a<n;a++){let u=charType(o.charCodeAt(a));u==512?u=h:u==8&&c==4&&(u=16),types[a]=u==4?2:u,u&7&&(c=u),h=u}for(let a=0,h=r,c=r;a<n;a++){let u=types[a];if(u==128)a<n-1&&h==types[a+1]&&h&24?u=types[a]=h:types[a]=256;else if(u==64){let f=a+1;for(;f<n&&types[f]==64;)f++;let d=a&&h==8||f<n&&types[f]==8?c==1?1:8:256;for(let g=a;g<f;g++)types[g]=d;a=f-1}else u==8&&c==1&&(types[a]=1);h=u,u&7&&(c=u)}for(let a=0,h=0,c=0,u,f,d;a<n;a++)if(f=Brackets[u=o.charCodeAt(a)])if(f<0){for(let g=h-3;g>=0;g-=3)if(BracketStack[g+1]==-f){let p=BracketStack[g+2],m=p&2?r:p&4?p&1?s:r:0;m&&(types[a]=types[BracketStack[g]]=m),h=g;break}}else{if(BracketStack.length==189)break;BracketStack[h++]=a,BracketStack[h++]=u,BracketStack[h++]=c}else if((d=types[a])==2||d==1){let g=d==r;c=g?0:1;for(let p=h-3;p>=0;p-=3){let m=BracketStack[p+2];if(m&2)break;if(g)BracketStack[p+2]|=2;else{if(m&4)break;BracketStack[p+2]|=4}}}for(let a=0;a<n;a++)if(types[a]==256){let h=a+1;for(;h<n&&types[h]==256;)h++;let c=(a?types[a-1]:r)==1,u=(h<n?types[h]:r)==1,f=c==u?c?1:2:r;for(let d=a;d<h;d++)types[d]=f;a=h-1}let l=[];if(r==1)for(let a=0;a<n;){let h=a,c=types[a++]!=1;for(;a<n&&c==(types[a]!=1);)a++;if(c)for(let u=a;u>h;){let f=u,d=types[--u]!=2;for(;u>h&&d==(types[u-1]!=2);)u--;l.push(new BidiSpan(u,f,d?2:1))}else l.push(new BidiSpan(h,a,0))}else for(let a=0;a<n;){let h=a,c=types[a++]==2;for(;a<n&&c==(types[a]==2);)a++;l.push(new BidiSpan(h,a,c?1:2))}return l}function trivialOrder(o){return[new BidiSpan(0,o,0)]}let movedOver="";function moveVisually(o,e,n,r,s){var l;let a=r.head-o.from,h=-1;if(a==0){if(!s||!o.length)return null;e[0].level!=n&&(a=e[0].side(!1,n),h=0)}else if(a==o.length){if(s)return null;let g=e[e.length-1];g.level!=n&&(a=g.side(!0,n),h=e.length-1)}h<0&&(h=BidiSpan.find(e,a,(l=r.bidiLevel)!==null&&l!==void 0?l:-1,r.assoc));let c=e[h];a==c.side(s,n)&&(c=e[h+=s?1:-1],a=c.side(!s,n));let u=s==(c.dir==n),f=findClusterBreak(o.text,a,u);if(movedOver=o.text.slice(Math.min(a,f),Math.max(a,f)),f!=c.side(s,n))return EditorSelection.cursor(f+o.from,u?-1:1,c.level);let d=h==(s?e.length-1:0)?null:e[h+(s?1:-1)];return!d&&c.level!=n?EditorSelection.cursor(s?o.to:o.from,s?-1:1,n):d&&d.level<c.level?EditorSelection.cursor(d.side(!s,n)+o.from,s?1:-1,d.level):EditorSelection.cursor(f+o.from,s?-1:1,c.level)}const LineBreakPlaceholder="\uFFFF";class DOMReader{constructor(e,n){this.points=e,this.text="",this.lineSeparator=n.facet(EditorState.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=LineBreakPlaceholder}readRange(e,n){if(!e)return this;let r=e.parentNode;for(let s=e;;){this.findPointBefore(r,s),this.readNode(s);let l=s.nextSibling;if(l==n)break;let a=ContentView.get(s),h=ContentView.get(l);(a&&h?a.breakAfter:(a?a.breakAfter:isBlockElement(s))||isBlockElement(l)&&(s.nodeName!="BR"||s.cmIgnore))&&this.lineBreak(),s=l}return this.findPointBefore(r,n),this}readTextNode(e){let n=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,n.length));for(let r=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let l=-1,a=1,h;if(this.lineSeparator?(l=n.indexOf(this.lineSeparator,r),a=this.lineSeparator.length):(h=s.exec(n))&&(l=h.index,a=h[0].length),this.append(n.slice(r,l<0?n.length:l)),l<0)break;if(this.lineBreak(),a>1)for(let c of this.points)c.node==e&&c.pos>this.text.length&&(c.pos-=a-1);r=l+a}}readNode(e){if(e.cmIgnore)return;let n=ContentView.get(e),r=n&&n.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let s=r.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,n){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==n&&(r.pos=this.text.length)}findPointInside(e,n){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+Math.min(n,r.offset))}}function isBlockElement(o){return o.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(o.nodeName)}class DOMPoint{constructor(e,n){this.node=e,this.offset=n,this.pos=-1}}class DocView extends ContentView{constructor(e){super(),this.view=e,this.compositionDeco=Decoration.none,this.decorations=[],this.dynamicDecorationMap=[],this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new LineView],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new ChangedRange(0,0,0,e.state.doc.length)],0)}get editorView(){return this.view}get length(){return this.view.state.doc.length}update(e){let n=e.changedRanges;this.minWidth>0&&n.length&&(n.every(({fromA:a,toA:h})=>h<this.minWidthFrom||a>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.view.inputState.composing<0?this.compositionDeco=Decoration.none:(e.transactions.length||this.dirty)&&(this.compositionDeco=computeCompositionDeco(this.view,e.changes)),(browser.ie||browser.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let r=this.decorations,s=this.updateDeco(),l=findChangedDeco(r,s,e.changes);return n=ChangedRange.extendWithRanges(n,l),this.dirty==0&&n.length==0?!1:(this.updateInner(n,e.startState.doc.length),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,n){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,n);let{observer:r}=this.view;r.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let l=browser.chrome||browser.ios?{node:r.selectionRange.focusNode,written:!1}:void 0;this.sync(l),this.dirty=0,l&&(l.written||r.selectionRange.focusNode!=l.node)&&(this.forceSelection=!0),this.dom.style.height=""});let s=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let l of this.children)l instanceof BlockWidgetView&&l.widget instanceof BlockGapWidget&&s.push(l.dom);r.updateGaps(s)}updateChildren(e,n){let r=this.childCursor(n);for(let s=e.length-1;;s--){let l=s>=0?e[s]:null;if(!l)break;let{fromA:a,toA:h,fromB:c,toB:u}=l,{content:f,breakAtStart:d,openStart:g,openEnd:p}=ContentBuilder.build(this.view.state.doc,c,u,this.decorations,this.dynamicDecorationMap),{i:m,off:w}=r.findPos(h,1),{i:y,off:S}=r.findPos(a,-1);replaceRange(this,y,S,m,w,f,d,g,p)}}updateSelection(e=!1,n=!1){if((e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange(),!(n||this.mayControlSelection()))return;let r=this.forceSelection;this.forceSelection=!1;let s=this.view.state.selection.main,l=this.domAtPos(s.anchor),a=s.empty?l:this.domAtPos(s.head);if(browser.gecko&&s.empty&&betweenUneditable(l)){let c=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(c,l.node.childNodes[l.offset]||null)),l=a=new DOMPos(c,0),r=!0}let h=this.view.observer.selectionRange;(r||!h.focusNode||!isEquivalentPosition(l.node,l.offset,h.anchorNode,h.anchorOffset)||!isEquivalentPosition(a.node,a.offset,h.focusNode,h.focusOffset))&&(this.view.observer.ignore(()=>{browser.android&&browser.chrome&&this.dom.contains(h.focusNode)&&inUneditable(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let c=getSelection(this.view.root);if(c)if(s.empty){if(browser.gecko){let u=nextToUneditable(l.node,l.offset);if(u&&u!=3){let f=nearbyTextNode(l.node,l.offset,u==1?1:-1);f&&(l=new DOMPos(f,u==1?0:f.nodeValue.length))}}c.collapse(l.node,l.offset),s.bidiLevel!=null&&h.cursorBidiLevel!=null&&(h.cursorBidiLevel=s.bidiLevel)}else if(c.extend){c.collapse(l.node,l.offset);try{c.extend(a.node,a.offset)}catch{}}else{let u=document.createRange();s.anchor>s.head&&([l,a]=[a,l]),u.setEnd(a.node,a.offset),u.setStart(l.node,l.offset),c.removeAllRanges(),c.addRange(u)}}),this.view.observer.setSelectionRange(l,a)),this.impreciseAnchor=l.precise?null:new DOMPos(h.anchorNode,h.anchorOffset),this.impreciseHead=a.precise?null:new DOMPos(h.focusNode,h.focusOffset)}enforceCursorAssoc(){if(this.compositionDeco.size)return;let{view:e}=this,n=e.state.selection.main,r=getSelection(e.root),{anchorNode:s,anchorOffset:l}=e.observer.selectionRange;if(!r||!n.empty||!n.assoc||!r.modify)return;let a=LineView.find(this,n.head);if(!a)return;let h=a.posAtStart;if(n.head==h||n.head==h+a.length)return;let c=this.coordsAt(n.head,-1),u=this.coordsAt(n.head,1);if(!c||!u||c.bottom>u.top)return;let f=this.domAtPos(n.head+n.assoc);r.collapse(f.node,f.offset),r.modify("move",n.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=n.from&&r.collapse(s,l)}mayControlSelection(){let e=this.view.root.activeElement;return e==this.dom||hasSelection(this.dom,this.view.observer.selectionRange)&&!(e&&this.dom.contains(e))}nearest(e){for(let n=e;n;){let r=ContentView.get(n);if(r&&r.rootView==this)return r;n=n.parentNode}return null}posFromDOM(e,n){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,n)+r.posAtStart}domAtPos(e){let{i:n,off:r}=this.childCursor().findPos(e,-1);for(;n<this.children.length-1;){let s=this.children[n];if(r<s.length||s instanceof LineView)break;n++,r=0}return this.children[n].domAtPos(r)}coordsAt(e,n){for(let r=this.length,s=this.children.length-1;;s--){let l=this.children[s],a=r-l.breakAfter-l.length;if(e>a||e==a&&l.type!=BlockType.WidgetBefore&&l.type!=BlockType.WidgetAfter&&(!s||n==2||this.children[s-1].breakAfter||this.children[s-1].type==BlockType.WidgetBefore&&n>-2))return l.coordsAt(e-a,n);r=a}}measureVisibleLineHeights(e){let n=[],{from:r,to:s}=e,l=this.view.contentDOM.clientWidth,a=l>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,h=-1,c=this.view.textDirection==Direction.LTR;for(let u=0,f=0;f<this.children.length;f++){let d=this.children[f],g=u+d.length;if(g>s)break;if(u>=r){let p=d.dom.getBoundingClientRect();if(n.push(p.height),a){let m=d.dom.lastChild,w=m?clientRectsFor(m):[];if(w.length){let y=w[w.length-1],S=c?y.right-p.left:p.right-y.left;S>h&&(h=S,this.minWidth=l,this.minWidthFrom=u,this.minWidthTo=g)}}}u=g+d.breakAfter}return n}textDirectionAt(e){let{i:n}=this.childPos(e,1);return getComputedStyle(this.children[n].dom).direction=="rtl"?Direction.RTL:Direction.LTR}measureTextSize(){for(let s of this.children)if(s instanceof LineView){let l=s.measureTextSize();if(l)return l}let e=document.createElement("div"),n,r;return e.className="cm-line",e.style.width="99999px",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let s=clientRectsFor(e.firstChild)[0];n=e.getBoundingClientRect().height,r=s?s.width/27:7,e.remove()}),{lineHeight:n,charWidth:r}}childCursor(e=this.length){let n=this.children.length;return n&&(e-=this.children[--n].length),new ChildCursor(this.children,e,n)}computeBlockGapDeco(){let e=[],n=this.view.viewState;for(let r=0,s=0;;s++){let l=s==n.viewports.length?null:n.viewports[s],a=l?l.from-1:this.length;if(a>r){let h=n.lineBlockAt(a).bottom-n.lineBlockAt(r).top;e.push(Decoration.replace({widget:new BlockGapWidget(h),block:!0,inclusive:!0,isBlockGap:!0}).range(r,a))}if(!l)break;r=l.to+1}return Decoration.set(e)}updateDeco(){let e=this.view.state.facet(decorations).map((n,r)=>(this.dynamicDecorationMap[r]=typeof n=="function")?n(this.view):n);for(let n=e.length;n<e.length+3;n++)this.dynamicDecorationMap[n]=!1;return this.decorations=[...e,this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){let{range:n}=e,r=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1),s;if(!r)return;!n.empty&&(s=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(r={left:Math.min(r.left,s.left),top:Math.min(r.top,s.top),right:Math.max(r.right,s.right),bottom:Math.max(r.bottom,s.bottom)});let l=0,a=0,h=0,c=0;for(let f of this.view.state.facet(scrollMargins).map(d=>d(this.view)))if(f){let{left:d,right:g,top:p,bottom:m}=f;d!=null&&(l=Math.max(l,d)),g!=null&&(a=Math.max(a,g)),p!=null&&(h=Math.max(h,p)),m!=null&&(c=Math.max(c,m))}let u={left:r.left-l,top:r.top-h,right:r.right+a,bottom:r.bottom+c};scrollRectIntoView(this.view.scrollDOM,u,n.head<n.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Direction.LTR)}}function betweenUneditable(o){return o.node.nodeType==1&&o.node.firstChild&&(o.offset==0||o.node.childNodes[o.offset-1].contentEditable=="false")&&(o.offset==o.node.childNodes.length||o.node.childNodes[o.offset].contentEditable=="false")}class BlockGapWidget extends WidgetType{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}}function compositionSurroundingNode(o){let e=o.observer.selectionRange,n=e.focusNode&&nearbyTextNode(e.focusNode,e.focusOffset,0);if(!n)return null;let r=o.docView.nearest(n);if(!r)return null;if(r instanceof LineView){let s=n;for(;s.parentNode!=r.dom;)s=s.parentNode;let l=s.previousSibling;for(;l&&!ContentView.get(l);)l=l.previousSibling;let a=l?ContentView.get(l).posAtEnd:r.posAtStart;return{from:a,to:a,node:s,text:n}}else{for(;;){let{parent:l}=r;if(!l)return null;if(l instanceof LineView)break;r=l}let s=r.posAtStart;return{from:s,to:s+r.length,node:r.dom,text:n}}}function computeCompositionDeco(o,e){let n=compositionSurroundingNode(o);if(!n)return Decoration.none;let{from:r,to:s,node:l,text:a}=n,h=e.mapPos(r,1),c=Math.max(h,e.mapPos(s,-1)),{state:u}=o,f=l.nodeType==3?l.nodeValue:new DOMReader([],u).readRange(l.firstChild,null).text;if(c-h<f.length)if(u.doc.sliceString(h,Math.min(u.doc.length,h+f.length),LineBreakPlaceholder)==f)c=h+f.length;else if(u.doc.sliceString(Math.max(0,c-f.length),c,LineBreakPlaceholder)==f)h=c-f.length;else return Decoration.none;else if(u.doc.sliceString(h,c,LineBreakPlaceholder)!=f)return Decoration.none;let d=ContentView.get(l);return d instanceof CompositionView?d=d.widget.topView:d&&(d.parent=null),Decoration.set(Decoration.replace({widget:new CompositionWidget(l,a,d),inclusive:!0}).range(h,c))}class CompositionWidget extends WidgetType{constructor(e,n,r){super(),this.top=e,this.text=n,this.topView=r}eq(e){return this.top==e.top&&this.text==e.text}toDOM(){return this.top}ignoreEvent(){return!1}get customView(){return CompositionView}}function nearbyTextNode(o,e,n){for(;;){if(o.nodeType==3)return o;if(o.nodeType==1&&e>0&&n<=0)o=o.childNodes[e-1],e=maxOffset(o);else if(o.nodeType==1&&e<o.childNodes.length&&n>=0)o=o.childNodes[e],e=0;else return null}}function nextToUneditable(o,e){return o.nodeType!=1?0:(e&&o.childNodes[e-1].contentEditable=="false"?1:0)|(e<o.childNodes.length&&o.childNodes[e].contentEditable=="false"?2:0)}class DecorationComparator$1{constructor(){this.changes=[]}compareRange(e,n){addRange(e,n,this.changes)}comparePoint(e,n){addRange(e,n,this.changes)}}function findChangedDeco(o,e,n){let r=new DecorationComparator$1;return RangeSet.compare(o,e,n,r),r.changes}function inUneditable(o,e){for(let n=o;n&&n!=e;n=n.assignedSlot||n.parentNode)if(n.nodeType==1&&n.contentEditable=="false")return!0;return!1}function groupAt(o,e,n=1){let r=o.charCategorizer(e),s=o.doc.lineAt(e),l=e-s.from;if(s.length==0)return EditorSelection.cursor(e);l==0?n=1:l==s.length&&(n=-1);let a=l,h=l;n<0?a=findClusterBreak(s.text,l,!1):h=findClusterBreak(s.text,l);let c=r(s.text.slice(a,h));for(;a>0;){let u=findClusterBreak(s.text,a,!1);if(r(s.text.slice(u,a))!=c)break;a=u}for(;h<s.length;){let u=findClusterBreak(s.text,h);if(r(s.text.slice(h,u))!=c)break;h=u}return EditorSelection.range(a+s.from,h+s.from)}function getdx(o,e){return e.left>o?e.left-o:Math.max(0,o-e.right)}function getdy(o,e){return e.top>o?e.top-o:Math.max(0,o-e.bottom)}function yOverlap(o,e){return o.top<e.bottom-1&&o.bottom>e.top+1}function upTop(o,e){return e<o.top?{top:e,left:o.left,right:o.right,bottom:o.bottom}:o}function upBot(o,e){return e>o.bottom?{top:o.top,left:o.left,right:o.right,bottom:e}:o}function domPosAtCoords(o,e,n){let r,s,l,a,h=!1,c,u,f,d;for(let m=o.firstChild;m;m=m.nextSibling){let w=clientRectsFor(m);for(let y=0;y<w.length;y++){let S=w[y];s&&yOverlap(s,S)&&(S=upTop(upBot(S,s.bottom),s.top));let v=getdx(e,S),k=getdy(n,S);if(v==0&&k==0)return m.nodeType==3?domPosInText(m,e,n):domPosAtCoords(m,e,n);(!r||a>k||a==k&&l>v)&&(r=m,s=S,l=v,a=k,h=!v||(v>0?y<w.length-1:y>0)),v==0?n>S.bottom&&(!f||f.bottom<S.bottom)?(c=m,f=S):n<S.top&&(!d||d.top>S.top)&&(u=m,d=S):f&&yOverlap(f,S)?f=upBot(f,S.bottom):d&&yOverlap(d,S)&&(d=upTop(d,S.top))}}if(f&&f.bottom>=n?(r=c,s=f):d&&d.top<=n&&(r=u,s=d),!r)return{node:o,offset:0};let g=Math.max(s.left,Math.min(s.right,e));if(r.nodeType==3)return domPosInText(r,g,n);if(h&&r.contentEditable!="false")return domPosAtCoords(r,g,n);let p=Array.prototype.indexOf.call(o.childNodes,r)+(e>=(s.left+s.right)/2?1:0);return{node:o,offset:p}}function domPosInText(o,e,n){let r=o.nodeValue.length,s=-1,l=1e9,a=0;for(let h=0;h<r;h++){let c=textRange(o,h,h+1).getClientRects();for(let u=0;u<c.length;u++){let f=c[u];if(f.top==f.bottom)continue;a||(a=e-f.left);let d=(f.top>n?f.top-n:n-f.bottom)-1;if(f.left-1<=e&&f.right+1>=e&&d<l){let g=e>=(f.left+f.right)/2,p=g;if((browser.chrome||browser.gecko)&&textRange(o,h).getBoundingClientRect().left==f.right&&(p=!g),d<=0)return{node:o,offset:h+(p?1:0)};s=h+(p?1:0),l=d}}}return{node:o,offset:s>-1?s:a>0?o.nodeValue.length:0}}function posAtCoords(o,{x:e,y:n},r,s=-1){var l;let a=o.contentDOM.getBoundingClientRect(),h=a.top+o.viewState.paddingTop,c,{docHeight:u}=o.viewState,f=n-h;if(f<0)return 0;if(f>u)return o.state.doc.length;for(let S=o.defaultLineHeight/2,v=!1;c=o.elementAtHeight(f),c.type!=BlockType.Text;)for(;f=s>0?c.bottom+S:c.top-S,!(f>=0&&f<=u);){if(v)return r?null:0;v=!0,s=-s}n=h+f;let d=c.from;if(d<o.viewport.from)return o.viewport.from==0?0:r?null:posAtCoordsImprecise(o,a,c,e,n);if(d>o.viewport.to)return o.viewport.to==o.state.doc.length?o.state.doc.length:r?null:posAtCoordsImprecise(o,a,c,e,n);let g=o.dom.ownerDocument,p=o.root.elementFromPoint?o.root:g,m=p.elementFromPoint(e,n);m&&!o.contentDOM.contains(m)&&(m=null),m||(e=Math.max(a.left+1,Math.min(a.right-1,e)),m=p.elementFromPoint(e,n),m&&!o.contentDOM.contains(m)&&(m=null));let w,y=-1;if(m&&((l=o.docView.nearest(m))===null||l===void 0?void 0:l.isEditable)!=!1){if(g.caretPositionFromPoint){let S=g.caretPositionFromPoint(e,n);S&&({offsetNode:w,offset:y}=S)}else if(g.caretRangeFromPoint){let S=g.caretRangeFromPoint(e,n);S&&({startContainer:w,startOffset:y}=S,(!o.contentDOM.contains(w)||browser.safari&&isSuspiciousSafariCaretResult(w,y,e)||browser.chrome&&isSuspiciousChromeCaretResult(w,y,e))&&(w=void 0))}}if(!w||!o.docView.dom.contains(w)){let S=LineView.find(o.docView,d);if(!S)return f>c.top+c.height/2?c.to:c.from;({node:w,offset:y}=domPosAtCoords(S.dom,e,n))}return o.docView.posFromDOM(w,y)}function posAtCoordsImprecise(o,e,n,r,s){let l=Math.round((r-e.left)*o.defaultCharacterWidth);if(o.lineWrapping&&n.height>o.defaultLineHeight*1.5){let h=Math.floor((s-n.top)/o.defaultLineHeight);l+=h*o.viewState.heightOracle.lineLength}let a=o.state.sliceDoc(n.from,n.to);return n.from+findColumn(a,l,o.state.tabSize)}function isSuspiciousSafariCaretResult(o,e,n){let r;if(o.nodeType!=3||e!=(r=o.nodeValue.length))return!1;for(let s=o.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return textRange(o,r-1,r).getBoundingClientRect().left>n}function isSuspiciousChromeCaretResult(o,e,n){if(e!=0)return!1;for(let s=o;;){let l=s.parentNode;if(!l||l.nodeType!=1||l.firstChild!=s)return!1;if(l.classList.contains("cm-line"))break;s=l}let r=o.nodeType==1?o.getBoundingClientRect():textRange(o,0,Math.max(o.nodeValue.length,1)).getBoundingClientRect();return n-r.left>5}function moveToLineBoundary(o,e,n,r){let s=o.state.doc.lineAt(e.head),l=!r||!o.lineWrapping?null:o.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(l){let c=o.dom.getBoundingClientRect(),u=o.textDirectionAt(s.from),f=o.posAtCoords({x:n==(u==Direction.LTR)?c.right-1:c.left+1,y:(l.top+l.bottom)/2});if(f!=null)return EditorSelection.cursor(f,n?-1:1)}let a=LineView.find(o.docView,e.head),h=a?n?a.posAtEnd:a.posAtStart:n?s.to:s.from;return EditorSelection.cursor(h,n?-1:1)}function moveByChar(o,e,n,r){let s=o.state.doc.lineAt(e.head),l=o.bidiSpans(s),a=o.textDirectionAt(s.from);for(let h=e,c=null;;){let u=moveVisually(s,l,a,h,n),f=movedOver;if(!u){if(s.number==(n?o.state.doc.lines:1))return h;f=`
`,s=o.state.doc.line(s.number+(n?1:-1)),l=o.bidiSpans(s),u=EditorSelection.cursor(n?s.from:s.to)}if(c){if(!c(f))return h}else{if(!r)return u;c=r(f)}h=u}}function byGroup(o,e,n){let r=o.state.charCategorizer(e),s=r(n);return l=>{let a=r(l);return s==CharCategory.Space&&(s=a),s==a}}function moveVertically(o,e,n,r){let s=e.head,l=n?1:-1;if(s==(n?o.state.doc.length:0))return EditorSelection.cursor(s,e.assoc);let a=e.goalColumn,h,c=o.contentDOM.getBoundingClientRect(),u=o.coordsAtPos(s),f=o.documentTop;if(u)a==null&&(a=u.left-c.left),h=l<0?u.top:u.bottom;else{let p=o.viewState.lineBlockAt(s);a==null&&(a=Math.min(c.right-c.left,o.defaultCharacterWidth*(s-p.from))),h=(l<0?p.top:p.bottom)+f}let d=c.left+a,g=r!=null?r:o.defaultLineHeight>>1;for(let p=0;;p+=10){let m=h+(g+p)*l,w=posAtCoords(o,{x:d,y:m},!1,l);if(m<c.top||m>c.bottom||(l<0?w<s:w>s))return EditorSelection.cursor(w,e.assoc,void 0,a)}}function skipAtoms(o,e,n){let r=o.state.facet(atomicRanges).map(s=>s(o));for(;;){let s=!1;for(let l of r)l.between(n.from-1,n.from+1,(a,h,c)=>{n.from>a&&n.from<h&&(n=e.head>n.from?EditorSelection.cursor(a,1):EditorSelection.cursor(h,-1),s=!0)});if(!s)return n}}class InputState{constructor(e){this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.chromeScrollHack=-1,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.registeredEvents=[],this.customHandlers=[],this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.mouseSelection=null;for(let n in handlers){let r=handlers[n];e.contentDOM.addEventListener(n,s=>{!eventBelongsToEditor(e,s)||this.ignoreDuringComposition(s)||n=="keydown"&&this.keydown(e,s)||(this.mustFlushObserver(s)&&e.observer.forceFlush(),this.runCustomHandlers(n,e,s)?s.preventDefault():r(e,s))},handlerOptions[n]),this.registeredEvents.push(n)}browser.chrome&&browser.chrome_version==102&&e.scrollDOM.addEventListener("wheel",()=>{this.chromeScrollHack<0?e.contentDOM.style.pointerEvents="none":window.clearTimeout(this.chromeScrollHack),this.chromeScrollHack=setTimeout(()=>{this.chromeScrollHack=-1,e.contentDOM.style.pointerEvents=""},100)},{passive:!0}),this.notifiedFocused=e.hasFocus,browser.safari&&e.contentDOM.addEventListener("input",()=>null)}setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}ensureHandlers(e,n){var r;let s;this.customHandlers=[];for(let l of n)if(s=(r=l.update(e).spec)===null||r===void 0?void 0:r.domEventHandlers){this.customHandlers.push({plugin:l.value,handlers:s});for(let a in s)this.registeredEvents.indexOf(a)<0&&a!="scroll"&&(this.registeredEvents.push(a),e.contentDOM.addEventListener(a,h=>{!eventBelongsToEditor(e,h)||this.runCustomHandlers(a,e,h)&&h.preventDefault()}))}}runCustomHandlers(e,n,r){for(let s of this.customHandlers){let l=s.handlers[e];if(l)try{if(l.call(s.plugin,r,n)||r.defaultPrevented)return!0}catch(a){logException(n.state,a)}}return!1}runScrollHandlers(e,n){this.lastScrollTop=e.scrollDOM.scrollTop,this.lastScrollLeft=e.scrollDOM.scrollLeft;for(let r of this.customHandlers){let s=r.handlers.scroll;if(s)try{s.call(r.plugin,n,e)}catch(l){logException(e.state,l)}}}keydown(e,n){if(this.lastKeyCode=n.keyCode,this.lastKeyTime=Date.now(),n.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(browser.android&&browser.chrome&&!n.synthetic&&(n.keyCode==13||n.keyCode==8))return e.observer.delayAndroidKey(n.key,n.keyCode),!0;let r;return browser.ios&&!n.synthetic&&!n.altKey&&!n.metaKey&&((r=PendingKeys.find(s=>s.keyCode==n.keyCode))&&!n.ctrlKey||EmacsyPendingKeys.indexOf(n.key)>-1&&n.ctrlKey&&!n.shiftKey)?(this.pendingIOSKey=r||n,setTimeout(()=>this.flushIOSKey(e),250),!0):!1}flushIOSKey(e){let n=this.pendingIOSKey;return n?(this.pendingIOSKey=void 0,dispatchKey(e.contentDOM,n.key,n.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:browser.safari&&!browser.ios&&Date.now()-this.compositionEndedAt<100?(this.compositionEndedAt=0,!0):!1:!1}mustFlushObserver(e){return e.type=="keydown"&&e.keyCode!=229}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}const PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],EmacsyPendingKeys="dthko",modifierCodes=[16,17,18,20,91,92,224,225];class MouseSelection{constructor(e,n,r,s){this.view=e,this.style=r,this.mustSelect=s,this.lastEvent=n;let l=e.contentDOM.ownerDocument;l.addEventListener("mousemove",this.move=this.move.bind(this)),l.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,n),this.dragMove=dragMovesSelection(e,n),this.dragging=isInPrimarySelection(e,n)&&getClickType(n)==1?null:!1,this.dragging===!1&&(n.preventDefault(),this.select(n))}move(e){if(e.buttons==0)return this.destroy();this.dragging===!1&&this.select(this.lastEvent=e)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=null}select(e){let n=this.style.get(e,this.extend,this.multiple);(this.mustSelect||!n.eq(this.view.state.selection)||n.main.assoc!=this.view.state.selection.main.assoc)&&this.view.dispatch({selection:n,userEvent:"select.pointer",scrollIntoView:!0}),this.mustSelect=!1}update(e){e.docChanged&&this.dragging&&(this.dragging=this.dragging.map(e.changes)),this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function addsSelectionRange(o,e){let n=o.state.facet(clickAddsSelectionRange);return n.length?n[0](e):browser.mac?e.metaKey:e.ctrlKey}function dragMovesSelection(o,e){let n=o.state.facet(dragMovesSelection$1);return n.length?n[0](e):browser.mac?!e.altKey:!e.ctrlKey}function isInPrimarySelection(o,e){let{main:n}=o.state.selection;if(n.empty)return!1;let r=getSelection(o.root);if(!r||r.rangeCount==0)return!0;let s=r.getRangeAt(0).getClientRects();for(let l=0;l<s.length;l++){let a=s[l];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return!0}return!1}function eventBelongsToEditor(o,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target,r;n!=o.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(r=ContentView.get(n))&&r.ignoreEvent(e))return!1;return!0}const handlers=Object.create(null),handlerOptions=Object.create(null),brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(o){let e=o.dom.parentNode;if(!e)return;let n=e.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{o.focus(),n.remove(),doPaste(o,n.value)},50)}function doPaste(o,e){let{state:n}=o,r,s=1,l=n.toText(e),a=l.lines==n.selection.ranges.length;if(lastLinewiseCopy!=null&&n.selection.ranges.every(c=>c.empty)&&lastLinewiseCopy==l.toString()){let c=-1;r=n.changeByRange(u=>{let f=n.doc.lineAt(u.from);if(f.from==c)return{range:u};c=f.from;let d=n.toText((a?l.line(s++).text:e)+n.lineBreak);return{changes:{from:f.from,insert:d},range:EditorSelection.cursor(u.from+d.length)}})}else a?r=n.changeByRange(c=>{let u=l.line(s++);return{changes:{from:c.from,to:c.to,insert:u.text},range:EditorSelection.cursor(c.from+u.length)}}):r=n.replaceSelection(l);o.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}handlers.keydown=(o,e)=>{o.inputState.setSelectionOrigin("select"),e.keyCode==27?o.inputState.lastEscPress=Date.now():modifierCodes.indexOf(e.keyCode)<0&&(o.inputState.lastEscPress=0)};handlers.touchstart=(o,e)=>{o.inputState.lastTouchTime=Date.now(),o.inputState.setSelectionOrigin("select.pointer")};handlers.touchmove=o=>{o.inputState.setSelectionOrigin("select.pointer")};handlerOptions.touchstart=handlerOptions.touchmove={passive:!0};handlers.mousedown=(o,e)=>{if(o.observer.flush(),o.inputState.lastTouchTime>Date.now()-2e3)return;let n=null;for(let r of o.state.facet(mouseSelectionStyle))if(n=r(o,e),n)break;if(!n&&e.button==0&&(n=basicMouseSelection(o,e)),n){let r=o.root.activeElement!=o.contentDOM;r&&o.observer.ignore(()=>focusPreventScroll(o.contentDOM)),o.inputState.startMouseSelection(new MouseSelection(o,e,n,r))}};function rangeForClick(o,e,n,r){if(r==1)return EditorSelection.cursor(e,n);if(r==2)return groupAt(o.state,e,n);{let s=LineView.find(o.docView,e),l=o.state.doc.lineAt(s?s.posAtEnd:e),a=s?s.posAtStart:l.from,h=s?s.posAtEnd:l.to;return h<o.state.doc.length&&h==l.to&&h++,EditorSelection.range(a,h)}}let insideY=(o,e)=>o>=e.top&&o<=e.bottom,inside=(o,e,n)=>insideY(e,n)&&o>=n.left&&o<=n.right;function findPositionSide(o,e,n,r){let s=LineView.find(o.docView,e);if(!s)return 1;let l=e-s.posAtStart;if(l==0)return 1;if(l==s.length)return-1;let a=s.coordsAt(l,-1);if(a&&inside(n,r,a))return-1;let h=s.coordsAt(l,1);return h&&inside(n,r,h)?1:a&&insideY(r,a)?-1:1}function queryPos(o,e){let n=o.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:n,bias:findPositionSide(o,n,e.clientX,e.clientY)}}const BadMouseDetail=browser.ie&&browser.ie_version<=11;let lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(o){if(!BadMouseDetail)return o.detail;let e=lastMouseDown,n=lastMouseDownTime;return lastMouseDown=o,lastMouseDownTime=Date.now(),lastMouseDownCount=!e||n>Date.now()-400&&Math.abs(e.clientX-o.clientX)<2&&Math.abs(e.clientY-o.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(o,e){let n=queryPos(o,e),r=getClickType(e),s=o.state.selection,l=n,a=e;return{update(h){h.docChanged&&(n.pos=h.changes.mapPos(n.pos),s=s.map(h.changes),a=null)},get(h,c,u){let f;a&&h.clientX==a.clientX&&h.clientY==a.clientY?f=l:(f=l=queryPos(o,h),a=h);let d=rangeForClick(o,f.pos,f.bias,r);if(n.pos!=f.pos&&!c){let g=rangeForClick(o,n.pos,n.bias,r),p=Math.min(g.from,d.from),m=Math.max(g.to,d.to);d=p<d.from?EditorSelection.range(p,m):EditorSelection.range(m,p)}return c?s.replaceRange(s.main.extend(d.from,d.to)):u&&s.ranges.length>1&&s.ranges.some(g=>g.eq(d))?removeRange(s,d):u?s.addRange(d):EditorSelection.create([d])}}}function removeRange(o,e){for(let n=0;;n++)if(o.ranges[n].eq(e))return EditorSelection.create(o.ranges.slice(0,n).concat(o.ranges.slice(n+1)),o.mainIndex==n?0:o.mainIndex-(o.mainIndex>n?1:0))}handlers.dragstart=(o,e)=>{let{selection:{main:n}}=o.state,{mouseSelection:r}=o.inputState;r&&(r.dragging=n),e.dataTransfer&&(e.dataTransfer.setData("Text",o.state.sliceDoc(n.from,n.to)),e.dataTransfer.effectAllowed="copyMove")};function dropText(o,e,n,r){if(!n)return;let s=o.posAtCoords({x:e.clientX,y:e.clientY},!1);e.preventDefault();let{mouseSelection:l}=o.inputState,a=r&&l&&l.dragging&&l.dragMove?{from:l.dragging.from,to:l.dragging.to}:null,h={from:s,insert:n},c=o.state.changes(a?[a,h]:h);o.focus(),o.dispatch({changes:c,selection:{anchor:c.mapPos(s,-1),head:c.mapPos(s,1)},userEvent:a?"move.drop":"input.drop"})}handlers.drop=(o,e)=>{if(!e.dataTransfer)return;if(o.state.readOnly)return e.preventDefault();let n=e.dataTransfer.files;if(n&&n.length){e.preventDefault();let r=Array(n.length),s=0,l=()=>{++s==n.length&&dropText(o,e,r.filter(a=>a!=null).join(o.state.lineBreak),!1)};for(let a=0;a<n.length;a++){let h=new FileReader;h.onerror=l,h.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(h.result)||(r[a]=h.result),l()},h.readAsText(n[a])}}else dropText(o,e,e.dataTransfer.getData("Text"),!0)};handlers.paste=(o,e)=>{if(o.state.readOnly)return e.preventDefault();o.observer.flush();let n=brokenClipboardAPI?null:e.clipboardData;n?(doPaste(o,n.getData("text/plain")),e.preventDefault()):capturePaste(o)};function captureCopy(o,e){let n=o.dom.parentNode;if(!n)return;let r=n.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),o.focus()},50)}function copiedRange(o){let e=[],n=[],r=!1;for(let s of o.selection.ranges)s.empty||(e.push(o.sliceDoc(s.from,s.to)),n.push(s));if(!e.length){let s=-1;for(let{from:l}of o.selection.ranges){let a=o.doc.lineAt(l);a.number>s&&(e.push(a.text),n.push({from:a.from,to:Math.min(o.doc.length,a.to+1)})),s=a.number}r=!0}return{text:e.join(o.lineBreak),ranges:n,linewise:r}}let lastLinewiseCopy=null;handlers.copy=handlers.cut=(o,e)=>{let{text:n,ranges:r,linewise:s}=copiedRange(o.state);if(!n&&!s)return;lastLinewiseCopy=s?n:null;let l=brokenClipboardAPI?null:e.clipboardData;l?(e.preventDefault(),l.clearData(),l.setData("text/plain",n)):captureCopy(o,n),e.type=="cut"&&!o.state.readOnly&&o.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"})};function updateForFocusChange(o){setTimeout(()=>{o.hasFocus!=o.inputState.notifiedFocused&&o.update([])},10)}handlers.focus=o=>{o.inputState.lastFocusTime=Date.now(),!o.scrollDOM.scrollTop&&(o.inputState.lastScrollTop||o.inputState.lastScrollLeft)&&(o.scrollDOM.scrollTop=o.inputState.lastScrollTop,o.scrollDOM.scrollLeft=o.inputState.lastScrollLeft),updateForFocusChange(o)};handlers.blur=o=>{o.observer.clearSelectionRange(),updateForFocusChange(o)};handlers.compositionstart=handlers.compositionupdate=o=>{o.inputState.compositionFirstChange==null&&(o.inputState.compositionFirstChange=!0),o.inputState.composing<0&&(o.inputState.composing=0)};handlers.compositionend=o=>{o.inputState.composing=-1,o.inputState.compositionEndedAt=Date.now(),o.inputState.compositionFirstChange=null,browser.chrome&&browser.android&&o.observer.flushSoon(),setTimeout(()=>{o.inputState.composing<0&&o.docView.compositionDeco.size&&o.update([])},50)};handlers.contextmenu=o=>{o.inputState.lastContextMenu=Date.now()};handlers.beforeinput=(o,e)=>{var n;let r;if(browser.chrome&&browser.android&&(r=PendingKeys.find(s=>s.inputType==e.inputType))&&(o.observer.delayAndroidKey(r.key,r.keyCode),r.key=="Backspace"||r.key=="Delete")){let s=((n=window.visualViewport)===null||n===void 0?void 0:n.height)||0;setTimeout(()=>{var l;(((l=window.visualViewport)===null||l===void 0?void 0:l.height)||0)>s+10&&o.hasFocus&&(o.contentDOM.blur(),o.focus())},100)}};const wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];class HeightOracle{constructor(e){this.lineWrapping=e,this.doc=Text.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.lineLength=30,this.heightChanged=!1}heightForGap(e,n){let r=this.doc.lineAt(n).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.ceil((n-e-r*this.lineLength*.5)/this.lineLength)),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let n=!1;for(let r=0;r<e.length;r++){let s=e[r];s<0?r++:this.heightSamples[Math.floor(s*10)]||(n=!0,this.heightSamples[Math.floor(s*10)]=!0)}return n}refresh(e,n,r,s,l){let a=wrappingWhiteSpace.indexOf(e)>-1,h=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=n,this.charWidth=r,this.lineLength=s,h){this.heightSamples={};for(let c=0;c<l.length;c++){let u=l[c];u<0?c++:this.heightSamples[Math.floor(u*10)]=!0}}return h}}class MeasuredHeights{constructor(e,n){this.from=e,this.heights=n,this.index=0}get more(){return this.index<this.heights.length}}class BlockInfo{constructor(e,n,r,s,l){this.from=e,this.length=n,this.top=r,this.height=s,this.type=l}get to(){return this.from+this.length}get bottom(){return this.top+this.height}join(e){let n=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new BlockInfo(this.from,this.length+e.length,this.top,this.height+e.height,n)}}var QueryType=function(o){return o[o.ByPos=0]="ByPos",o[o.ByHeight=1]="ByHeight",o[o.ByPosNoHeight=2]="ByPosNoHeight",o}(QueryType||(QueryType={}));const Epsilon=.001;class HeightMap{constructor(e,n,r=2){this.length=e,this.height=n,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,n){this.height!=n&&(Math.abs(this.height-n)>Epsilon&&(e.heightChanged=!0),this.height=n)}replace(e,n,r){return HeightMap.of(r)}decomposeLeft(e,n){n.push(this)}decomposeRight(e,n){n.push(this)}applyChanges(e,n,r,s){let l=this;for(let a=s.length-1;a>=0;a--){let{fromA:h,toA:c,fromB:u,toB:f}=s[a],d=l.lineAt(h,QueryType.ByPosNoHeight,n,0,0),g=d.to>=c?d:l.lineAt(c,QueryType.ByPosNoHeight,n,0,0);for(f+=g.to-c,c=g.to;a>0&&d.from<=s[a-1].toA;)h=s[a-1].fromA,u=s[a-1].fromB,a--,h<d.from&&(d=l.lineAt(h,QueryType.ByPosNoHeight,n,0,0));u+=d.from-h,h=d.from;let p=NodeBuilder.build(r,e,u,f);l=l.replace(h,c,p)}return l.updateHeight(r,0)}static empty(){return new HeightMapText(0,0)}static of(e){if(e.length==1)return e[0];let n=0,r=e.length,s=0,l=0;for(;;)if(n==r)if(s>l*2){let h=e[n-1];h.break?e.splice(--n,1,h.left,null,h.right):e.splice(--n,1,h.left,h.right),r+=1+h.break,s-=h.size}else if(l>s*2){let h=e[r];h.break?e.splice(r,1,h.left,null,h.right):e.splice(r,1,h.left,h.right),r+=2+h.break,l-=h.size}else break;else if(s<l){let h=e[n++];h&&(s+=h.size)}else{let h=e[--r];h&&(l+=h.size)}let a=0;return e[n-1]==null?(a=1,n--):e[n]==null&&(a=1,r++),new HeightMapBranch(HeightMap.of(e.slice(0,n)),a,HeightMap.of(e.slice(r)))}}HeightMap.prototype.size=1;class HeightMapBlock extends HeightMap{constructor(e,n,r){super(e,n),this.type=r}blockAt(e,n,r,s){return new BlockInfo(s,this.length,r,this.height,this.type)}lineAt(e,n,r,s,l){return this.blockAt(0,r,s,l)}forEachLine(e,n,r,s,l,a){e<=l+this.length&&n>=l&&a(this.blockAt(0,r,s,l))}updateHeight(e,n=0,r=!1,s){return s&&s.from<=n&&s.more&&this.setHeight(e,s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class HeightMapText extends HeightMapBlock{constructor(e,n){super(e,n,BlockType.Text),this.collapsed=0,this.widgetHeight=0}replace(e,n,r){let s=r[0];return r.length==1&&(s instanceof HeightMapText||s instanceof HeightMapGap&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof HeightMapGap?s=new HeightMapText(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):HeightMap.of(r)}updateHeight(e,n=0,r=!1,s){return s&&s.from<=n&&s.more?this.setHeight(e,s.heights[s.index++]):(r||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class HeightMapGap extends HeightMap{constructor(e){super(e,0)}lines(e,n){let r=e.lineAt(n).number,s=e.lineAt(n+this.length).number;return{firstLine:r,lastLine:s,lineHeight:this.height/(s-r+1)}}blockAt(e,n,r,s){let{firstLine:l,lastLine:a,lineHeight:h}=this.lines(n,s),c=Math.max(0,Math.min(a-l,Math.floor((e-r)/h))),{from:u,length:f}=n.line(l+c);return new BlockInfo(u,f,r+h*c,h,BlockType.Text)}lineAt(e,n,r,s,l){if(n==QueryType.ByHeight)return this.blockAt(e,r,s,l);if(n==QueryType.ByPosNoHeight){let{from:d,to:g}=r.lineAt(e);return new BlockInfo(d,g-d,0,0,BlockType.Text)}let{firstLine:a,lineHeight:h}=this.lines(r,l),{from:c,length:u,number:f}=r.lineAt(e);return new BlockInfo(c,u,s+h*(f-a),h,BlockType.Text)}forEachLine(e,n,r,s,l,a){let{firstLine:h,lineHeight:c}=this.lines(r,l);for(let u=Math.max(e,l),f=Math.min(l+this.length,n);u<=f;){let d=r.lineAt(u);u==e&&(s+=c*(d.number-h)),a(new BlockInfo(d.from,d.length,s,c,BlockType.Text)),s+=c,u=d.to+1}}replace(e,n,r){let s=this.length-n;if(s>0){let l=r[r.length-1];l instanceof HeightMapGap?r[r.length-1]=new HeightMapGap(l.length+s):r.push(null,new HeightMapGap(s-1))}if(e>0){let l=r[0];l instanceof HeightMapGap?r[0]=new HeightMapGap(e+l.length):r.unshift(new HeightMapGap(e-1),null)}return HeightMap.of(r)}decomposeLeft(e,n){n.push(new HeightMapGap(e-1),null)}decomposeRight(e,n){n.push(null,new HeightMapGap(this.length-e-1))}updateHeight(e,n=0,r=!1,s){let l=n+this.length;if(s&&s.from<=n+this.length&&s.more){let a=[],h=Math.max(n,s.from),c=-1,u=e.heightChanged;for(s.from>n&&a.push(new HeightMapGap(s.from-n-1).updateHeight(e,n));h<=l&&s.more;){let d=e.doc.lineAt(h).length;a.length&&a.push(null);let g=s.heights[s.index++];c==-1?c=g:Math.abs(g-c)>=Epsilon&&(c=-2);let p=new HeightMapText(d,g);p.outdated=!1,a.push(p),h+=d+1}h<=l&&a.push(null,new HeightMapGap(l-h).updateHeight(e,h));let f=HeightMap.of(a);return e.heightChanged=u||c<0||Math.abs(f.height-this.height)>=Epsilon||Math.abs(c-this.lines(e.doc,n).lineHeight)>=Epsilon,f}else(r||this.outdated)&&(this.setHeight(e,e.heightForGap(n,n+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class HeightMapBranch extends HeightMap{constructor(e,n,r){super(e.length+n+r.length,e.height+r.height,n|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,n,r,s){let l=r+this.left.height;return e<l?this.left.blockAt(e,n,r,s):this.right.blockAt(e,n,l,s+this.left.length+this.break)}lineAt(e,n,r,s,l){let a=s+this.left.height,h=l+this.left.length+this.break,c=n==QueryType.ByHeight?e<a:e<h,u=c?this.left.lineAt(e,n,r,s,l):this.right.lineAt(e,n,r,a,h);if(this.break||(c?u.to<h:u.from>h))return u;let f=n==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;return c?u.join(this.right.lineAt(h,f,r,a,h)):this.left.lineAt(h,f,r,s,l).join(u)}forEachLine(e,n,r,s,l,a){let h=s+this.left.height,c=l+this.left.length+this.break;if(this.break)e<c&&this.left.forEachLine(e,n,r,s,l,a),n>=c&&this.right.forEachLine(e,n,r,h,c,a);else{let u=this.lineAt(c,QueryType.ByPos,r,s,l);e<u.from&&this.left.forEachLine(e,u.from-1,r,s,l,a),u.to>=e&&u.from<=n&&a(u),n>u.to&&this.right.forEachLine(u.to+1,n,r,h,c,a)}}replace(e,n,r){let s=this.left.length+this.break;if(n<s)return this.balanced(this.left.replace(e,n,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,n-s,r));let l=[];e>0&&this.decomposeLeft(e,l);let a=l.length;for(let h of r)l.push(h);if(e>0&&mergeGaps(l,a-1),n<this.length){let h=l.length;this.decomposeRight(n,l),mergeGaps(l,h)}return HeightMap.of(l)}decomposeLeft(e,n){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,n);n.push(this.left),this.break&&(r++,e>=r&&n.push(null)),e>r&&this.right.decomposeLeft(e-r,n)}decomposeRight(e,n){let r=this.left.length,s=r+this.break;if(e>=s)return this.right.decomposeRight(e-s,n);e<r&&this.left.decomposeRight(e,n),this.break&&e<s&&n.push(null),n.push(this.right)}balanced(e,n){return e.size>2*n.size||n.size>2*e.size?HeightMap.of(this.break?[e,null,n]:[e,n]):(this.left=e,this.right=n,this.height=e.height+n.height,this.outdated=e.outdated||n.outdated,this.size=e.size+n.size,this.length=e.length+this.break+n.length,this)}updateHeight(e,n=0,r=!1,s){let{left:l,right:a}=this,h=n+l.length+this.break,c=null;return s&&s.from<=n+l.length&&s.more?c=l=l.updateHeight(e,n,r,s):l.updateHeight(e,n,r),s&&s.from<=h+a.length&&s.more?c=a=a.updateHeight(e,h,r,s):a.updateHeight(e,h,r),c?this.balanced(l,a):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function mergeGaps(o,e){let n,r;o[e]==null&&(n=o[e-1])instanceof HeightMapGap&&(r=o[e+1])instanceof HeightMapGap&&o.splice(e-1,3,new HeightMapGap(n.length+1+r.length))}const relevantWidgetHeight=5;class NodeBuilder{constructor(e,n){this.pos=e,this.oracle=n,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,n){if(this.lineStart>-1){let r=Math.min(n,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof HeightMapText?s.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new HeightMapText(r-this.pos,-1)),this.writtenTo=r,n>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=n}point(e,n,r){if(e<n||r.heightRelevant){let s=r.widget?r.widget.estimatedHeight:0;s<0&&(s=this.oracle.lineHeight);let l=n-e;r.block?this.addBlock(new HeightMapBlock(l,s,r.type)):(l||s>=relevantWidgetHeight)&&this.addLineDeco(s,l)}else n>e&&this.span(e,n);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:n}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=n,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new HeightMapText(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,n){let r=new HeightMapGap(n-e);return this.oracle.doc.lineAt(e).to==n&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;let n=new HeightMapText(0,-1);return this.nodes.push(n),n}addBlock(e){this.enterLine(),e.type==BlockType.WidgetAfter&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,e.type!=BlockType.WidgetBefore&&(this.covering=e)}addLineDeco(e,n){let r=this.ensureLine();r.length+=n,r.collapsed+=n,r.widgetHeight=Math.max(r.widgetHeight,e),this.writtenTo=this.pos=this.pos+n}finish(e){let n=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(n instanceof HeightMapText)&&!this.isCovered?this.nodes.push(new HeightMapText(0,-1)):(this.writtenTo<this.pos||n==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let s of this.nodes)s instanceof HeightMapText&&s.updateHeight(this.oracle,r),r+=s?s.length:1;return this.nodes}static build(e,n,r,s){let l=new NodeBuilder(r,e);return RangeSet.spans(n,r,s,l,0),l.finish(r)}}function heightRelevantDecoChanges(o,e,n){let r=new DecorationComparator;return RangeSet.compare(o,e,n,r,0),r.changes}class DecorationComparator{constructor(){this.changes=[]}compareRange(){}comparePoint(e,n,r,s){(e<n||r&&r.heightRelevant||s&&s.heightRelevant)&&addRange(e,n,this.changes,5)}}function visiblePixelRange(o,e){let n=o.getBoundingClientRect(),r=o.ownerDocument,s=r.defaultView||window,l=Math.max(0,n.left),a=Math.min(s.innerWidth,n.right),h=Math.max(0,n.top),c=Math.min(s.innerHeight,n.bottom);for(let u=o.parentNode;u&&u!=r.body;)if(u.nodeType==1){let f=u,d=window.getComputedStyle(f);if((f.scrollHeight>f.clientHeight||f.scrollWidth>f.clientWidth)&&d.overflow!="visible"){let g=f.getBoundingClientRect();l=Math.max(l,g.left),a=Math.min(a,g.right),h=Math.max(h,g.top),c=u==o.parentNode?g.bottom:Math.min(c,g.bottom)}u=d.position=="absolute"||d.position=="fixed"?f.offsetParent:f.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:l-n.left,right:Math.max(l,a)-n.left,top:h-(n.top+e),bottom:Math.max(h,c)-(n.top+e)}}function fullPixelRange(o,e){let n=o.getBoundingClientRect();return{left:0,right:n.right-n.left,top:e,bottom:n.bottom-(n.top+e)}}class LineGap{constructor(e,n,r){this.from=e,this.to=n,this.size=r}static same(e,n){if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],l=n[r];if(s.from!=l.from||s.to!=l.to||s.size!=l.size)return!1}return!0}draw(e){return Decoration.replace({widget:new LineGapWidget(this.size,e)}).range(this.from,this.to)}}class LineGapWidget extends WidgetType{constructor(e,n){super(),this.size=e,this.vertical=n}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class ViewState{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scaler=IdScaler,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Direction.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let n=e.facet(contentAttributes).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new HeightOracle(n),this.stateDeco=e.facet(decorations).filter(r=>typeof r!="function"),this.heightMap=HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Decoration.set(this.lineGaps.map(r=>r.draw(!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:n}=this.state.selection;for(let r=0;r<=1;r++){let s=r?n.head:n.anchor;if(!e.some(({from:l,to:a})=>s>=l&&s<=a)){let{from:l,to:a}=this.lineBlockAt(s);e.push(new Viewport(l,a))}}this.viewports=e.sort((r,s)=>r.from-s.from),this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle.doc,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:scaleBlock(e,this.scaler))})}update(e,n=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(decorations).filter(u=>typeof u!="function");let s=e.changedRanges,l=ChangedRange.extendWithRanges(s,heightRelevantDecoChanges(r,this.stateDeco,e?e.changes:ChangeSet.empty(this.state.doc.length))),a=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),l),this.heightMap.height!=a&&(e.flags|=2);let h=l.length?this.mapViewport(this.viewport,e.changes):this.viewport;(n&&(n.range.head<h.from||n.range.head>h.to)||!this.viewportIsAppropriate(h))&&(h=this.getViewport(0,n));let c=!e.changes.empty||e.flags&2||h.from!=this.viewport.from||h.to!=this.viewport.to;this.viewport=h,this.updateForViewport(),c&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),n&&(this.scrollTarget=n),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(nativeSelectionHidden)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let n=e.contentDOM,r=window.getComputedStyle(n),s=this.heightOracle,l=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?Direction.RTL:Direction.LTR;let a=this.heightOracle.mustRefreshForWrapping(l),h=a||this.mustMeasureContent||this.contentDOMHeight!=n.clientHeight;this.contentDOMHeight=n.clientHeight,this.mustMeasureContent=!1;let c=0,u=0,f=parseInt(r.paddingTop)||0,d=parseInt(r.paddingBottom)||0;(this.paddingTop!=f||this.paddingBottom!=d)&&(this.paddingTop=f,this.paddingBottom=d,c|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(h=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=8);let g=(this.printing?fullPixelRange:visiblePixelRange)(n,this.paddingTop),p=g.top-this.pixelViewport.top,m=g.bottom-this.pixelViewport.bottom;this.pixelViewport=g;let w=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(w!=this.inView&&(this.inView=w,w&&(h=!0)),!this.inView&&!this.scrollTarget)return 0;let y=n.clientWidth;if((this.contentDOMWidth!=y||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=y,this.editorHeight=e.scrollDOM.clientHeight,c|=8),h){let v=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(v)&&(a=!0),a||s.lineWrapping&&Math.abs(y-this.contentDOMWidth)>s.charWidth){let{lineHeight:k,charWidth:A}=e.docView.measureTextSize();a=k>0&&s.refresh(l,k,A,y/A,v),a&&(e.docView.minWidth=0,c|=8)}p>0&&m>0?u=Math.max(p,m):p<0&&m<0&&(u=Math.min(p,m)),s.heightChanged=!1;for(let k of this.viewports){let A=k.from==this.viewport.from?v:e.docView.measureVisibleLineHeights(k);this.heightMap=(a?HeightMap.empty().applyChanges(this.stateDeco,Text.empty,this.heightOracle,[new ChangedRange(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,a,new MeasuredHeights(k.from,A))}s.heightChanged&&(c|=2)}let S=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return S&&(this.viewport=this.getViewport(u,this.scrollTarget)),this.updateForViewport(),(c&2||S)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>2e3<<1)&&this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,n){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,l=this.state.doc,{visibleTop:a,visibleBottom:h}=this,c=new Viewport(s.lineAt(a-r*1e3,QueryType.ByHeight,l,0,0).from,s.lineAt(h+(1-r)*1e3,QueryType.ByHeight,l,0,0).to);if(n){let{head:u}=n.range;if(u<c.from||u>c.to){let f=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),d=s.lineAt(u,QueryType.ByPos,l,0,0),g;n.y=="center"?g=(d.top+d.bottom)/2-f/2:n.y=="start"||n.y=="nearest"&&u<c.from?g=d.top:g=d.bottom-f,c=new Viewport(s.lineAt(g-1e3/2,QueryType.ByHeight,l,0,0).from,s.lineAt(g+f+1e3/2,QueryType.ByHeight,l,0,0).to)}}return c}mapViewport(e,n){let r=n.mapPos(e.from,-1),s=n.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(r,QueryType.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(s,QueryType.ByPos,this.state.doc,0,0).to)}viewportIsAppropriate({from:e,to:n},r=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,QueryType.ByPos,this.state.doc,0,0),{bottom:l}=this.heightMap.lineAt(n,QueryType.ByPos,this.state.doc,0,0),{visibleTop:a,visibleBottom:h}=this;return(e==0||s<=a-Math.max(10,Math.min(-r,250)))&&(n==this.state.doc.length||l>=h+Math.max(10,Math.min(r,250)))&&s>a-2*1e3&&l<h+2*1e3}mapLineGaps(e,n){if(!e.length||n.empty)return e;let r=[];for(let s of e)n.touchesRange(s.from,s.to)||r.push(new LineGap(n.mapPos(s.from),n.mapPos(s.to),s.size));return r}ensureLineGaps(e,n){let r=this.heightOracle.lineWrapping,s=r?1e4:2e3,l=s>>1,a=s<<1;if(this.defaultTextDirection!=Direction.LTR&&!r)return[];let h=[],c=(u,f,d,g)=>{if(f-u<l)return;let p=this.state.selection.main,m=[p.from];p.empty||m.push(p.to);for(let y of m)if(y>u&&y<f){c(u,y-10,d,g),c(y+10,f,d,g);return}let w=find(e,y=>y.from>=d.from&&y.to<=d.to&&Math.abs(y.from-u)<l&&Math.abs(y.to-f)<l&&!m.some(S=>y.from<S&&y.to>S));if(!w){if(f<d.to&&n&&r&&n.visibleRanges.some(y=>y.from<=f&&y.to>=f)){let y=n.moveToLineBoundary(EditorSelection.cursor(f),!1,!0).head;y>u&&(f=y)}w=new LineGap(u,f,this.gapSize(d,u,f,g))}h.push(w)};for(let u of this.viewportLines){if(u.length<a)continue;let f=lineStructure(u.from,u.to,this.stateDeco);if(f.total<a)continue;let d=this.scrollTarget?this.scrollTarget.range.head:null,g,p;if(r){let m=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,w,y;if(d!=null){let S=findFraction(f,d),v=((this.visibleBottom-this.visibleTop)/2+m)/u.height;w=S-v,y=S+v}else w=(this.visibleTop-u.top-m)/u.height,y=(this.visibleBottom-u.top+m)/u.height;g=findPosition(f,w),p=findPosition(f,y)}else{let m=f.total*this.heightOracle.charWidth,w=s*this.heightOracle.charWidth,y,S;if(d!=null){let v=findFraction(f,d),k=((this.pixelViewport.right-this.pixelViewport.left)/2+w)/m;y=v-k,S=v+k}else y=(this.pixelViewport.left-w)/m,S=(this.pixelViewport.right+w)/m;g=findPosition(f,y),p=findPosition(f,S)}g>u.from&&c(u.from,g,u,f),p<u.to&&c(p,u.to,u,f)}return h}gapSize(e,n,r,s){let l=findFraction(s,r)-findFraction(s,n);return this.heightOracle.lineWrapping?e.height*l:s.total*this.heightOracle.charWidth*l}updateLineGaps(e){LineGap.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Decoration.set(e.map(n=>n.draw(this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let n=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span(s,l){n.push({from:s,to:l})},point(){}},20);let r=n.length!=this.visibleRanges.length||this.visibleRanges.some((s,l)=>s.from!=n[l].from||s.to!=n[l].to);return this.visibleRanges=n,r?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(n=>n.from<=e&&n.to>=e)||scaleBlock(this.heightMap.lineAt(e,QueryType.ByPos,this.state.doc,0,0),this.scaler)}lineBlockAtHeight(e){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType.ByHeight,this.state.doc,0,0),this.scaler)}elementAtHeight(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Viewport{constructor(e,n){this.from=e,this.to=n}}function lineStructure(o,e,n){let r=[],s=o,l=0;return RangeSet.spans(n,o,e,{span(){},point(a,h){a>s&&(r.push({from:s,to:a}),l+=a-s),s=h}},20),s<e&&(r.push({from:s,to:e}),l+=e-s),{total:l,ranges:r}}function findPosition({total:o,ranges:e},n){if(n<=0)return e[0].from;if(n>=1)return e[e.length-1].to;let r=Math.floor(o*n);for(let s=0;;s++){let{from:l,to:a}=e[s],h=a-l;if(r<=h)return l+r;r-=h}}function findFraction(o,e){let n=0;for(let{from:r,to:s}of o.ranges){if(e<=s){n+=e-r;break}n+=s-r}return n/o.total}function find(o,e){for(let n of o)if(e(n))return n}const IdScaler={toDOM(o){return o},fromDOM(o){return o},scale:1};class BigScaler{constructor(e,n,r){let s=0,l=0,a=0;this.viewports=r.map(({from:h,to:c})=>{let u=n.lineAt(h,QueryType.ByPos,e,0,0).top,f=n.lineAt(c,QueryType.ByPos,e,0,0).bottom;return s+=f-u,{from:h,to:c,top:u,bottom:f,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(n.height-s);for(let h of this.viewports)h.domTop=a+(h.top-l)*this.scale,a=h.domBottom=h.domTop+(h.bottom-h.top),l=h.bottom}toDOM(e){for(let n=0,r=0,s=0;;n++){let l=n<this.viewports.length?this.viewports[n]:null;if(!l||e<l.top)return s+(e-r)*this.scale;if(e<=l.bottom)return l.domTop+(e-l.top);r=l.bottom,s=l.domBottom}}fromDOM(e){for(let n=0,r=0,s=0;;n++){let l=n<this.viewports.length?this.viewports[n]:null;if(!l||e<l.domTop)return r+(e-s)/this.scale;if(e<=l.domBottom)return l.top+(e-l.domTop);r=l.bottom,s=l.domBottom}}}function scaleBlock(o,e){if(e.scale==1)return o;let n=e.toDOM(o.top),r=e.toDOM(o.bottom);return new BlockInfo(o.from,o.length,n,r-n,Array.isArray(o.type)?o.type.map(s=>scaleBlock(s,e)):o.type)}const theme=Facet.define({combine:o=>o.join(" ")}),darkTheme=Facet.define({combine:o=>o.indexOf(!0)>-1}),baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName(),lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(o,e,n){return new StyleModule(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,s=>{if(s=="&")return o;if(!n||!n[s])throw new RangeError(`Unsupported selector: ${s}`);return n[s]}):o+" "+r}})}const baseTheme$1=buildTheme("."+baseThemeID,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);class DOMChange{constructor(e,n,r,s){this.typeOver=s,this.bounds=null,this.text="";let{impreciseHead:l,impreciseAnchor:a}=e.docView;if(e.state.readOnly&&n>-1)this.newSel=null;else if(n>-1&&(this.bounds=e.docView.domBoundsAround(n,r,0))){let h=l||a?[]:selectionPoints(e),c=new DOMReader(h,e.state);c.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=c.text,this.newSel=selectionFromPoints(h,this.bounds.from)}else{let h=e.observer.selectionRange,c=l&&l.node==h.focusNode&&l.offset==h.focusOffset||!contains(e.contentDOM,h.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(h.focusNode,h.focusOffset),u=a&&a.node==h.anchorNode&&a.offset==h.anchorOffset||!contains(e.contentDOM,h.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(h.anchorNode,h.anchorOffset);this.newSel=EditorSelection.single(u,c)}}}function applyDOMChange(o,e){let n,{newSel:r}=e,s=o.state.selection.main;if(e.bounds){let{from:l,to:a}=e.bounds,h=s.from,c=null;(o.inputState.lastKeyCode===8&&o.inputState.lastKeyTime>Date.now()-100||browser.android&&e.text.length<a-l)&&(h=s.to,c="end");let u=findDiff(o.state.doc.sliceString(l,a,LineBreakPlaceholder),e.text,h-l,c);u&&(browser.chrome&&o.inputState.lastKeyCode==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==LineBreakPlaceholder+LineBreakPlaceholder&&u.toB--,n={from:l+u.from,to:l+u.toA,insert:Text.of(e.text.slice(u.from,u.toB).split(LineBreakPlaceholder))})}else r&&(!o.hasFocus||!o.state.facet(editable)||r.main.eq(s))&&(r=null);if(!n&&!r)return!1;if(!n&&e.typeOver&&!s.empty&&r&&r.main.empty?n={from:s.from,to:s.to,insert:o.state.doc.slice(s.from,s.to)}:n&&n.from>=s.from&&n.to<=s.to&&(n.from!=s.from||n.to!=s.to)&&s.to-s.from-(n.to-n.from)<=4?n={from:s.from,to:s.to,insert:o.state.doc.slice(s.from,n.from).append(n.insert).append(o.state.doc.slice(n.to,s.to))}:(browser.mac||browser.android)&&n&&n.from==n.to&&n.from==s.head-1&&/^\. ?$/.test(n.insert.toString())?(r&&n.insert.length==2&&(r=EditorSelection.single(r.main.anchor-1,r.main.head-1)),n={from:s.from,to:s.to,insert:Text.of([" "])}):browser.chrome&&n&&n.from==n.to&&n.from==s.head&&n.insert.toString()==`
 `&&o.lineWrapping&&(r&&(r=EditorSelection.single(r.main.anchor-1,r.main.head-1)),n={from:s.from,to:s.to,insert:Text.of([" "])}),n){let l=o.state;if(browser.ios&&o.inputState.flushIOSKey(o)||browser.android&&(n.from==s.from&&n.to==s.to&&n.insert.length==1&&n.insert.lines==2&&dispatchKey(o.contentDOM,"Enter",13)||n.from==s.from-1&&n.to==s.to&&n.insert.length==0&&dispatchKey(o.contentDOM,"Backspace",8)||n.from==s.from&&n.to==s.to+1&&n.insert.length==0&&dispatchKey(o.contentDOM,"Delete",46)))return!0;let a=n.insert.toString();if(o.state.facet(inputHandler).some(u=>u(o,n.from,n.to,a)))return!0;o.inputState.composing>=0&&o.inputState.composing++;let h;if(n.from>=s.from&&n.to<=s.to&&n.to-n.from>=(s.to-s.from)/3&&(!r||r.main.empty&&r.main.from==n.from+n.insert.length)&&o.inputState.composing<0){let u=s.from<n.from?l.sliceDoc(s.from,n.from):"",f=s.to>n.to?l.sliceDoc(n.to,s.to):"";h=l.replaceSelection(o.state.toText(u+n.insert.sliceString(0,void 0,o.state.lineBreak)+f))}else{let u=l.changes(n),f=r&&!l.selection.main.eq(r.main)&&r.main.to<=u.newLength?r.main:void 0;if(l.selection.ranges.length>1&&o.inputState.composing>=0&&n.to<=s.to&&n.to>=s.to-10){let d=o.state.sliceDoc(n.from,n.to),g=compositionSurroundingNode(o)||o.state.doc.lineAt(s.head),p=s.to-n.to,m=s.to-s.from;h=l.changeByRange(w=>{if(w.from==s.from&&w.to==s.to)return{changes:u,range:f||w.map(u)};let y=w.to-p,S=y-d.length;if(w.to-w.from!=m||o.state.sliceDoc(S,y)!=d||g&&w.to>=g.from&&w.from<=g.to)return{range:w};let v=l.changes({from:S,to:y,insert:n.insert}),k=w.to-s.to;return{changes:v,range:f?EditorSelection.range(Math.max(0,f.anchor+k),Math.max(0,f.head+k)):w.map(v)}})}else h={changes:u,selection:f&&l.selection.replaceRange(f)}}let c="input.type";return o.composing&&(c+=".compose",o.inputState.compositionFirstChange&&(c+=".start",o.inputState.compositionFirstChange=!1)),o.dispatch(h,{scrollIntoView:!0,userEvent:c}),!0}else if(r&&!r.main.eq(s)){let l=!1,a="select";return o.inputState.lastSelectionTime>Date.now()-50&&(o.inputState.lastSelectionOrigin=="select"&&(l=!0),a=o.inputState.lastSelectionOrigin),o.dispatch({selection:r,scrollIntoView:l,userEvent:a}),!0}else return!1}function findDiff(o,e,n,r){let s=Math.min(o.length,e.length),l=0;for(;l<s&&o.charCodeAt(l)==e.charCodeAt(l);)l++;if(l==s&&o.length==e.length)return null;let a=o.length,h=e.length;for(;a>0&&h>0&&o.charCodeAt(a-1)==e.charCodeAt(h-1);)a--,h--;if(r=="end"){let c=Math.max(0,l-Math.min(a,h));n-=a+c-l}if(a<l&&o.length<e.length){let c=n<=l&&n>=a?l-n:0;l-=c,h=l+(h-a),a=l}else if(h<l){let c=n<=l&&n>=h?l-n:0;l-=c,a=l+(a-h),h=l}return{from:l,toA:a,toB:h}}function selectionPoints(o){let e=[];if(o.root.activeElement!=o.contentDOM)return e;let{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:l}=o.observer.selectionRange;return n&&(e.push(new DOMPoint(n,r)),(s!=n||l!=r)&&e.push(new DOMPoint(s,l))),e}function selectionFromPoints(o,e){if(o.length==0)return null;let n=o[0].pos,r=o.length==2?o[1].pos:n;return n>-1&&r>-1?EditorSelection.single(n+e,r+e):null}const observeOptions={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},useCharData=browser.ie&&browser.ie_version<=11;class DOMObserver{constructor(e){this.view=e,this.active=!1,this.selectionRange=new DOMSelectionState,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resize=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resize=new ResizeObserver(()=>{var n;((n=this.view.docView)===null||n===void 0?void 0:n.lastUpdate)<Date.now()-75&&this.onResize()}),this.resize.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runScrollHandlers(this.view,e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((n,r)=>n!=e[r]))){this.gapIntersection.disconnect();for(let n of e)this.gapIntersection.observe(n);this.gaps=e}}onSelectionChange(e){let n=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,s=this.selectionRange;if(r.state.facet(editable)?r.root.activeElement!=this.dom:!hasSelection(r.dom,s))return;let l=s.anchorNode&&r.docView.nearest(s.anchorNode);if(l&&l.ignoreEvent(e)){n||(this.selectionChanged=!1);return}(browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!r.state.selection.main.empty&&s.focusNode&&isEquivalentPosition(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,n=browser.safari&&e.root.nodeType==11&&deepActiveElement(this.dom.ownerDocument)==this.dom&&safariSelectionRangeHack(this.view)||getSelection(e.root);if(!n||this.selectionRange.eq(n))return!1;let r=hasSelection(this.dom,n);return r&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&atElementStart(this.dom,n)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(n),r&&(this.selectionChanged=!0),!0)}setSelectionRange(e,n){this.selectionRange.set(e.node,e.offset,n.node,n.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,n=null;for(let r=this.dom;r;)if(r.nodeType==1)!n&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:n||(n=this.scrollTargets.slice(0,e)),n&&n.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!n&&(n=this.scrollTargets.slice(0,e)),n){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=n)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,observeOptions),useCharData&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){!this.active||(this.active=!1,this.observer.disconnect(),useCharData&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,n){var r;if(!this.delayedAndroidKey){let s=()=>{let l=this.delayedAndroidKey;l&&(this.clearDelayedAndroidKey(),!this.flush()&&l.force&&dispatchKey(this.dom,l.key,l.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:n,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}processRecords(){let e=this.queue;for(let l of this.observer.takeRecords())e.push(l);e.length&&(this.queue=[]);let n=-1,r=-1,s=!1;for(let l of e){let a=this.readMutation(l);!a||(a.typeOver&&(s=!0),n==-1?{from:n,to:r}=a:(n=Math.min(a.from,n),r=Math.max(a.to,r)))}return{from:n,to:r,typeOver:s}}readChange(){let{from:e,to:n,typeOver:r}=this.processRecords(),s=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);return e<0&&!s?null:(e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1,new DOMChange(this.view,e,n,r))}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let n=this.readChange();if(!n)return!1;let r=this.view.state,s=applyDOMChange(this.view,n);return this.view.state==r&&this.view.update([]),s}readMutation(e){let n=this.view.docView.nearest(e.target);if(!n||n.ignoreMutation(e))return null;if(n.markDirty(e.type=="attributes"),e.type=="attributes"&&(n.dirty|=4),e.type=="childList"){let r=findChild(n,e.previousSibling||e.target.previousSibling,-1),s=findChild(n,e.nextSibling||e.target.nextSibling,1);return{from:r?n.posAfter(r):n.posAtStart,to:s?n.posBefore(s):n.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,n,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(n=this.gapIntersection)===null||n===void 0||n.disconnect(),(r=this.resize)===null||r===void 0||r.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function findChild(o,e,n){for(;e;){let r=ContentView.get(e);if(r&&r.parent==o)return r;let s=e.parentNode;e=s!=o.dom?s:n>0?e.nextSibling:e.previousSibling}return null}function safariSelectionRangeHack(o){let e=null;function n(c){c.preventDefault(),c.stopImmediatePropagation(),e=c.getTargetRanges()[0]}if(o.contentDOM.addEventListener("beforeinput",n,!0),o.dom.ownerDocument.execCommand("indent"),o.contentDOM.removeEventListener("beforeinput",n,!0),!e)return null;let r=e.startContainer,s=e.startOffset,l=e.endContainer,a=e.endOffset,h=o.docView.domAtPos(o.state.selection.main.anchor);return isEquivalentPosition(h.node,h.offset,l,a)&&([r,s,l,a]=[l,a,r,s]),{anchorNode:r,anchorOffset:s,focusNode:l,focusOffset:a}}class EditorView{constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.style.cssText="position: absolute; top: -10000px",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),this._dispatch=e.dispatch||(n=>this.update([n])),this.dispatch=this.dispatch.bind(this),this._root=e.root||getRoot(e.parent)||document,this.viewState=new ViewState(e.state||EditorState.create(e)),this.plugins=this.state.facet(viewPlugin).map(n=>new PluginInstance(n));for(let n of this.plugins)n.update(this);this.observer=new DOMObserver(this),this.inputState=new InputState(this),this.inputState.ensureHandlers(this,this.plugins),this.docView=new DocView(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),e.parent&&e.parent.appendChild(this.dom)}get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}dispatch(...e){this._dispatch(e.length==1&&e[0]instanceof Transaction?e[0]:this.state.update(...e))}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let n=!1,r=!1,s,l=this.state;for(let u of e){if(u.startState!=l)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");l=u.state}if(this.destroyed){this.viewState.state=l;return}let a=this.observer.delayedAndroidKey,h=null;if(a?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(l.doc)||!this.state.selection.eq(l.selection))&&(h=null)):this.observer.clear(),l.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(l);s=ViewUpdate.create(this,l,e);let c=this.viewState.scrollTarget;try{this.updateState=2;for(let u of e){if(c&&(c=c.map(u.changes)),u.scrollIntoView){let{main:f}=u.state.selection;c=new ScrollTarget(f.empty?f:EditorSelection.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of u.effects)f.is(scrollIntoView)&&(c=f.value)}this.viewState.update(s,c),this.bidiCache=CachedOrder.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),n=this.docView.update(s),this.state.facet(styleModule)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(n,e.some(u=>u.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(theme)!=s.state.facet(theme)&&(this.viewState.mustMeasureContent=!0),(n||r||c||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!s.empty)for(let u of this.state.facet(updateListener))u(s);h&&!applyDOMChange(this,h)&&a.force&&dispatchKey(this.contentDOM,a.key,a.keyCode)}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let n=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new ViewState(e),this.plugins=e.facet(viewPlugin).map(r=>new PluginInstance(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView=new DocView(this),this.inputState.ensureHandlers(this,this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}n&&this.focus(),this.requestMeasure()}updatePlugins(e){let n=e.startState.facet(viewPlugin),r=e.state.facet(viewPlugin);if(n!=r){let s=[];for(let l of r){let a=n.indexOf(l);if(a<0)s.push(new PluginInstance(l));else{let h=this.plugins[a];h.mustUpdate=e,s.push(h)}}for(let l of this.plugins)l.mustUpdate!=e&&l.destroy(this);this.plugins=s,this.pluginMap.clear(),this.inputState.ensureHandlers(this,this.plugins)}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this)}measure(e=!0){if(this.destroyed)return;this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.measureScheduled=0,e&&this.observer.forceFlush();let n=null,{scrollHeight:r,scrollTop:s,clientHeight:l}=this.scrollDOM,a=s>r-l-4?r:s;try{for(let h=0;;h++){this.updateState=1;let c=this.viewport,u=this.viewState.lineBlockAtHeight(a),f=this.viewState.measure(this);if(!f&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(h>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let d=[];f&4||([this.measureRequests,d]=[d,this.measureRequests]);let g=d.map(y=>{try{return y.read(this)}catch(S){return logException(this.state,S),BadMeasure}}),p=ViewUpdate.create(this,this.state,[]),m=!1,w=!1;p.flags|=f,n?n.flags|=f:n=p,this.updateState=2,p.empty||(this.updatePlugins(p),this.inputState.update(p),this.updateAttrs(),m=this.docView.update(p));for(let y=0;y<d.length;y++)if(g[y]!=BadMeasure)try{let S=d[y];S.write&&S.write(g[y],this)}catch(S){logException(this.state,S)}if(this.viewState.editorHeight)if(this.viewState.scrollTarget)this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,w=!0;else{let y=this.viewState.lineBlockAt(u.from).top-u.top;(y>1||y<-1)&&(this.scrollDOM.scrollTop+=y,w=!0)}if(m&&this.docView.updateSelection(!0),this.viewport.from==c.from&&this.viewport.to==c.to&&!w&&this.measureRequests.length==0)break}}finally{this.updateState=0,this.measureScheduled=-1}if(n&&!n.empty)for(let h of this.state.facet(updateListener))h(n)}get themeClasses(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)}updateAttrs(){let e=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),n={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(editable)?"true":"false",class:"cm-content",style:`${browser.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(n["aria-readonly"]="true"),attrsFromFacet(this,contentAttributes,n);let r=this.observer.ignore(()=>{let s=updateAttrs(this.contentDOM,this.contentAttrs,n),l=updateAttrs(this.dom,this.editorAttrs,e);return s||l});return this.editorAttrs=e,this.contentAttrs=n,r}showAnnouncements(e){let n=!0;for(let r of e)for(let s of r.effects)if(s.is(EditorView.announce)){n&&(this.announceDOM.textContent=""),n=!1;let l=this.announceDOM.appendChild(document.createElement("div"));l.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(styleModule),StyleModule.mount(this.root,this.styleModules.concat(baseTheme$1).reverse())}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(e.key!=null){for(let n=0;n<this.measureRequests.length;n++)if(this.measureRequests[n].key===e.key){this.measureRequests[n]=e;return}}this.measureRequests.push(e)}}plugin(e){let n=this.pluginMap.get(e);return(n===void 0||n&&n.spec!=e)&&this.pluginMap.set(e,n=this.plugins.find(r=>r.spec==e)||null),n&&n.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,n,r){return skipAtoms(this,e,moveByChar(this,e,n,r))}moveByGroup(e,n){return skipAtoms(this,e,moveByChar(this,e,n,r=>byGroup(this,e.head,r)))}moveToLineBoundary(e,n,r=!0){return moveToLineBoundary(this,e,n,r)}moveVertically(e,n,r){return skipAtoms(this,e,moveVertically(this,e,n,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,n=0){return this.docView.posFromDOM(e,n)}posAtCoords(e,n=!0){return this.readMeasured(),posAtCoords(this,e,n)}coordsAtPos(e,n=1){this.readMeasured();let r=this.docView.coordsAt(e,n);if(!r||r.left==r.right)return r;let s=this.state.doc.lineAt(e),l=this.bidiSpans(s),a=l[BidiSpan.find(l,e-s.from,-1,n)];return flattenRect(r,a.dir==Direction.LTR==n>0)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(perLineTextDirection)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);let n=this.textDirectionAt(e.from);for(let s of this.bidiCache)if(s.from==e.from&&s.dir==n)return s.order;let r=computeOrder(e.text,n);return this.bidiCache.push(new CachedOrder(e.from,e.to,n,r)),r}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{focusPreventScroll(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,n={}){return scrollIntoView.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,n.y,n.x,n.yMargin,n.xMargin))}static domEventHandlers(e){return ViewPlugin.define(()=>({}),{eventHandlers:e})}static theme(e,n){let r=StyleModule.newName(),s=[theme.of(r),styleModule.of(buildTheme(`.${r}`,e))];return n&&n.dark&&s.push(darkTheme.of(!0)),s}static baseTheme(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))}static findFromDOM(e){var n;let r=e.querySelector(".cm-content"),s=r&&ContentView.get(r)||ContentView.get(e);return((n=s==null?void 0:s.rootView)===null||n===void 0?void 0:n.view)||null}}EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler;EditorView.perLineTextDirection=perLineTextDirection;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.atomicRanges=atomicRanges;EditorView.scrollMargins=scrollMargins;EditorView.darkTheme=darkTheme;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();const MaxBidiLine=4096,BadMeasure={};class CachedOrder{constructor(e,n,r,s){this.from=e,this.to=n,this.dir=r,this.order=s}static update(e,n){if(n.empty)return e;let r=[],s=e.length?e[e.length-1].dir:Direction.LTR;for(let l=Math.max(0,e.length-10);l<e.length;l++){let a=e[l];a.dir==s&&!n.touchesRange(a.from,a.to)&&r.push(new CachedOrder(n.mapPos(a.from,1),n.mapPos(a.to,-1),a.dir,a.order))}return r}}function attrsFromFacet(o,e,n){for(let r=o.state.facet(e),s=r.length-1;s>=0;s--){let l=r[s],a=typeof l=="function"?l(o):l;a&&combineAttrs(a,n)}return n}const currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(o,e){const n=o.split(/-(?!$)/);let r=n[n.length-1];r=="Space"&&(r=" ");let s,l,a,h;for(let c=0;c<n.length-1;++c){const u=n[c];if(/^(cmd|meta|m)$/i.test(u))h=!0;else if(/^a(lt)?$/i.test(u))s=!0;else if(/^(c|ctrl|control)$/i.test(u))l=!0;else if(/^s(hift)?$/i.test(u))a=!0;else if(/^mod$/i.test(u))e=="mac"?h=!0:l=!0;else throw new Error("Unrecognized modifier name: "+u)}return s&&(r="Alt-"+r),l&&(r="Ctrl-"+r),h&&(r="Meta-"+r),a&&(r="Shift-"+r),r}function modifiers(o,e,n){return e.altKey&&(o="Alt-"+o),e.ctrlKey&&(o="Ctrl-"+o),e.metaKey&&(o="Meta-"+o),n!==!1&&e.shiftKey&&(o="Shift-"+o),o}const handleKeyEvents=Prec.default(EditorView.domEventHandlers({keydown(o,e){return runHandlers(getKeymap(e.state),o,e,"editor")}})),keymap=Facet.define({enables:handleKeyEvents}),Keymaps=new WeakMap;function getKeymap(o){let e=o.facet(keymap),n=Keymaps.get(e);return n||Keymaps.set(e,n=buildKeymap(e.reduce((r,s)=>r.concat(s),[]))),n}let storedPrefix=null;const PrefixTimeout=4e3;function buildKeymap(o,e=currentPlatform){let n=Object.create(null),r=Object.create(null),s=(a,h)=>{let c=r[a];if(c==null)r[a]=h;else if(c!=h)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},l=(a,h,c,u)=>{var f,d;let g=n[a]||(n[a]=Object.create(null)),p=h.split(/ (?!$)/).map(y=>normalizeKeyName(y,e));for(let y=1;y<p.length;y++){let S=p.slice(0,y).join(" ");s(S,!0),g[S]||(g[S]={preventDefault:!0,run:[v=>{let k=storedPrefix={view:v,prefix:S,scope:a};return setTimeout(()=>{storedPrefix==k&&(storedPrefix=null)},PrefixTimeout),!0}]})}let m=p.join(" ");s(m,!1);let w=g[m]||(g[m]={preventDefault:!1,run:((d=(f=g._any)===null||f===void 0?void 0:f.run)===null||d===void 0?void 0:d.slice())||[]});c&&w.run.push(c),u&&(w.preventDefault=!0)};for(let a of o){let h=a.scope?a.scope.split(" "):["editor"];if(a.any)for(let u of h){let f=n[u]||(n[u]=Object.create(null));f._any||(f._any={preventDefault:!1,run:[]});for(let d in f)f[d].run.push(a.any)}let c=a[e]||a.key;if(!!c)for(let u of h)l(u,c,a.run,a.preventDefault),a.shift&&l(u,"Shift-"+c,a.shift,a.preventDefault)}return n}function runHandlers(o,e,n,r){let s=keyName(e),l=codePointAt(s,0),a=codePointSize(l)==s.length&&s!=" ",h="",c=!1;storedPrefix&&storedPrefix.view==n&&storedPrefix.scope==r&&(h=storedPrefix.prefix+" ",(c=modifierCodes.indexOf(e.keyCode)<0)&&(storedPrefix=null));let u=new Set,f=m=>{if(m){for(let w of m.run)if(!u.has(w)&&(u.add(w),w(n,e)))return!0;m.preventDefault&&(c=!0)}return!1},d=o[r],g,p;if(d){if(f(d[h+modifiers(s,e,!a)]))return!0;if(a&&(e.altKey||e.metaKey||e.ctrlKey)&&(g=base[e.keyCode])&&g!=s){if(f(d[h+modifiers(g,e,!0)]))return!0;if(e.shiftKey&&(p=shift[e.keyCode])!=s&&p!=g&&f(d[h+modifiers(p,e,!1)]))return!0}else if(a&&e.shiftKey&&f(d[h+modifiers(s,e,!0)]))return!0;if(f(d._any))return!0}return c}const CanHidePrimary=!browser.ios,themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};CanHidePrimary&&(themeSpec[".cm-line"].caretColor="transparent !important");class GutterMarker extends RangeValue{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=!0;const gutterLineClass=Facet.define(),defaults={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>RangeSet.empty,lineMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},activeGutters=Facet.define();function gutter(o){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),o))]}const unfixGutters=Facet.define({combine:o=>o.some(e=>e)});function gutters(o){let e=[gutterView];return o&&o.fixed===!1&&e.push(unfixGutters.of(!0)),e}const gutterView=ViewPlugin.fromClass(class{constructor(o){this.view=o,this.prevViewport=o.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight+"px",this.gutters=o.state.facet(activeGutters).map(e=>new SingleGutterView(o,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!o.state.facet(unfixGutters),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),o.scrollDOM.insertBefore(this.dom,o.contentDOM)}update(o){if(this.updateGutters(o)){let e=this.prevViewport,n=o.view.viewport,r=Math.min(e.to,n.to)-Math.max(e.from,n.from);this.syncGutters(r<(n.to-n.from)*.8)}o.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(unfixGutters)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=o.view.viewport}syncGutters(o){let e=this.dom.nextSibling;o&&this.dom.remove();let n=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from),r=[],s=this.gutters.map(l=>new UpdateContext(l,this.view.viewport,-this.view.documentPadding.top));for(let l of this.view.viewportLineBlocks){let a;if(Array.isArray(l.type)){for(let h of l.type)if(h.type==BlockType.Text){a=h;break}}else a=l.type==BlockType.Text?l:void 0;if(!!a){r.length&&(r=[]),advanceCursor(n,r,l.from);for(let h of s)h.line(this.view,a,r)}}for(let l of s)l.finish();o&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(o){let e=o.startState.facet(activeGutters),n=o.state.facet(activeGutters),r=o.docChanged||o.heightChanged||o.viewportChanged||!RangeSet.eq(o.startState.facet(gutterLineClass),o.state.facet(gutterLineClass),o.view.viewport.from,o.view.viewport.to);if(e==n)for(let s of this.gutters)s.update(o)&&(r=!0);else{r=!0;let s=[];for(let l of n){let a=e.indexOf(l);a<0?s.push(new SingleGutterView(this.view,l)):(this.gutters[a].update(o),s.push(this.gutters[a]))}for(let l of this.gutters)l.dom.remove(),s.indexOf(l)<0&&l.destroy();for(let l of s)this.dom.appendChild(l.dom);this.gutters=s}return r}destroy(){for(let o of this.gutters)o.destroy();this.dom.remove()}},{provide:o=>EditorView.scrollMargins.of(e=>{let n=e.plugin(o);return!n||n.gutters.length==0||!n.fixed?null:e.textDirection==Direction.LTR?{left:n.dom.offsetWidth}:{right:n.dom.offsetWidth}})});function asArray(o){return Array.isArray(o)?o:[o]}function advanceCursor(o,e,n){for(;o.value&&o.from<=n;)o.from==n&&e.push(o.value),o.next()}class UpdateContext{constructor(e,n,r){this.gutter=e,this.height=r,this.localMarkers=[],this.i=0,this.cursor=RangeSet.iter(e.markers,n.from)}line(e,n,r){this.localMarkers.length&&(this.localMarkers=[]),advanceCursor(this.cursor,this.localMarkers,n.from);let s=r.length?this.localMarkers.concat(r):this.localMarkers,l=this.gutter.config.lineMarker(e,n,s);l&&s.unshift(l);let a=this.gutter;if(s.length==0&&!a.config.renderEmptyElements)return;let h=n.top-this.height;if(this.i==a.elements.length){let c=new GutterElement(e,n.height,h,s);a.elements.push(c),a.dom.appendChild(c.dom)}else a.elements[this.i].update(e,n.height,h,s);this.height=n.bottom,this.i++}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let n=e.elements.pop();e.dom.removeChild(n.dom),n.destroy()}}}class SingleGutterView{constructor(e,n){this.view=e,this.config=n,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in n.domEventHandlers)this.dom.addEventListener(r,s=>{let l=e.lineBlockAtHeight(s.clientY-e.documentTop);n.domEventHandlers[r](e,l,s)&&s.preventDefault()});this.markers=asArray(n.markers(e)),n.initialSpacer&&(this.spacer=new GutterElement(e,0,0,[n.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let n=this.markers;if(this.markers=asArray(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let r=e.view.viewport;return!RangeSet.eq(this.markers,n,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class GutterElement{constructor(e,n,r,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,n,r,s)}update(e,n,r,s){this.height!=n&&(this.dom.style.height=(this.height=n)+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),sameMarkers(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,n){let r="cm-gutterElement",s=this.dom.firstChild;for(let l=0,a=0;;){let h=a,c=l<n.length?n[l++]:null,u=!1;if(c){let f=c.elementClass;f&&(r+=" "+f);for(let d=a;d<this.markers.length;d++)if(this.markers[d].compare(c)){h=d,u=!0;break}}else h=this.markers.length;for(;a<h;){let f=this.markers[a++];if(f.toDOM){f.destroy(s);let d=s.nextSibling;s.remove(),s=d}}if(!c)break;c.toDOM&&(u?s=s.nextSibling:this.dom.insertBefore(c.toDOM(e),s)),u&&a++}this.dom.className=r,this.markers=n}destroy(){this.setMarkers(null,[])}}function sameMarkers(o,e){if(o.length!=e.length)return!1;for(let n=0;n<o.length;n++)if(!o[n].compare(e[n]))return!1;return!0}const lineNumberMarkers=Facet.define(),lineNumberConfig=Facet.define({combine(o){return combineConfig(o,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,n){let r=Object.assign({},e);for(let s in n){let l=r[s],a=n[s];r[s]=l?(h,c,u)=>l(h,c,u)||a(h,c,u):a}return r}})}});class NumberMarker extends GutterMarker{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function formatNumber(o,e){return o.state.facet(lineNumberConfig).formatNumber(e,o.state)}const lineNumberGutter=activeGutters.compute([lineNumberConfig],o=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(lineNumberMarkers)},lineMarker(e,n,r){return r.some(s=>s.toDOM)?null:new NumberMarker(formatNumber(e,e.state.doc.lineAt(n.from).number))},lineMarkerChange:e=>e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig),initialSpacer(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer(e,n){let r=formatNumber(n.view,maxLineNumber(n.view.state.doc.lines));return r==e.number?e:new NumberMarker(r)},domEventHandlers:o.facet(lineNumberConfig).domEventHandlers}));function lineNumbers(o={}){return[lineNumberConfig.of(o),gutters(),lineNumberGutter]}function maxLineNumber(o){let e=9;for(;e<o;)e=e*10+9;return e}const DefaultBufferLength=1024;let nextPropID=0;class Range{constructor(e,n){this.from=e,this.to=n}}class NodeProp{constructor(e={}){this.id=nextPropID++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=NodeType.match(e)),n=>{let r=e(n);return r===void 0?null:[this,r]}}}NodeProp.closedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.openedBy=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.group=new NodeProp({deserialize:o=>o.split(" ")});NodeProp.contextHash=new NodeProp({perNode:!0});NodeProp.lookAhead=new NodeProp({perNode:!0});NodeProp.mounted=new NodeProp({perNode:!0});const noProps=Object.create(null);class NodeType{constructor(e,n,r,s=0){this.name=e,this.props=n,this.id=r,this.flags=s}static define(e){let n=e.props&&e.props.length?Object.create(null):noProps,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new NodeType(e.name||"",n,e.id,r);if(e.props){for(let l of e.props)if(Array.isArray(l)||(l=l(s)),l){if(l[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");n[l[0].id]=l[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let n=this.prop(NodeProp.group);return n?n.indexOf(e)>-1:!1}return this.id==e}static match(e){let n=Object.create(null);for(let r in e)for(let s of r.split(" "))n[s]=e[r];return r=>{for(let s=r.prop(NodeProp.group),l=-1;l<(s?s.length:0);l++){let a=n[l<0?r.name:s[l]];if(a)return a}}}}NodeType.none=new NodeType("",Object.create(null),0,8);const CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var IterMode;(function(o){o[o.ExcludeBuffers=1]="ExcludeBuffers",o[o.IncludeAnonymous=2]="IncludeAnonymous",o[o.IgnoreMounts=4]="IgnoreMounts",o[o.IgnoreOverlays=8]="IgnoreOverlays"})(IterMode||(IterMode={}));class Tree{constructor(e,n,r,s,l){if(this.type=e,this.children=n,this.positions=r,this.length=s,this.props=null,l&&l.length){this.props=Object.create(null);for(let[a,h]of l)this.props[typeof a=="number"?a:a.id]=h}}toString(){let e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();let n="";for(let r of this.children){let s=r.toString();s&&(n&&(n+=","),n+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(n.length?"("+n+")":""):n}cursor(e=0){return new TreeCursor(this.topNode,e)}cursorAt(e,n=0,r=0){let s=CachedNode.get(this)||this.topNode,l=new TreeCursor(s);return l.moveTo(e,n),CachedNode.set(this,l._tree),l}get topNode(){return new TreeNode(this,0,0,null)}resolve(e,n=0){let r=resolveNode(CachedNode.get(this)||this.topNode,e,n,!1);return CachedNode.set(this,r),r}resolveInner(e,n=0){let r=resolveNode(CachedInnerNode.get(this)||this.topNode,e,n,!0);return CachedInnerNode.set(this,r),r}iterate(e){let{enter:n,leave:r,from:s=0,to:l=this.length}=e;for(let a=this.cursor((e.mode||0)|IterMode.IncludeAnonymous);;){let h=!1;if(a.from<=l&&a.to>=s&&(a.type.isAnonymous||n(a)!==!1)){if(a.firstChild())continue;h=!0}for(;h&&r&&!a.type.isAnonymous&&r(a),!a.nextSibling();){if(!a.parent())return;h=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let n in this.props)e.push([+n,this.props[n]]);return e}balance(e={}){return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(n,r,s)=>new Tree(this.type,n,r,s,this.propValues),e.makeTree||((n,r,s)=>new Tree(NodeType.none,n,r,s)))}static build(e){return buildTree(e)}}Tree.empty=new Tree(NodeType.none,[],[],0);class FlatBufferCursor{constructor(e,n){this.buffer=e,this.index=n}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new FlatBufferCursor(this.buffer,this.index)}}class TreeBuffer{constructor(e,n,r){this.buffer=e,this.length=n,this.set=r}get type(){return NodeType.none}toString(){let e=[];for(let n=0;n<this.buffer.length;)e.push(this.childString(n)),n=this.buffer[n+3];return e.join(",")}childString(e){let n=this.buffer[e],r=this.buffer[e+3],s=this.set.types[n],l=s.name;if(/\W/.test(l)&&!s.isError&&(l=JSON.stringify(l)),e+=4,r==e)return l;let a=[];for(;e<r;)a.push(this.childString(e)),e=this.buffer[e+3];return l+"("+a.join(",")+")"}findChild(e,n,r,s,l){let{buffer:a}=this,h=-1;for(let c=e;c!=n&&!(checkSide(l,s,a[c+1],a[c+2])&&(h=c,r>0));c=a[c+3]);return h}slice(e,n,r,s){let l=this.buffer,a=new Uint16Array(n-e);for(let h=e,c=0;h<n;)a[c++]=l[h++],a[c++]=l[h++]-r,a[c++]=l[h++]-r,a[c++]=l[h++]-e;return new TreeBuffer(a,s-r,this.set)}}function checkSide(o,e,n,r){switch(o){case-2:return n<e;case-1:return r>=e&&n<e;case 0:return n<e&&r>e;case 1:return n<=e&&r>e;case 2:return r>e;case 4:return!0}}function enterUnfinishedNodesBefore(o,e){let n=o.childBefore(e);for(;n;){let r=n.lastChild;if(!r||r.to!=n.to)break;r.type.isError&&r.from==r.to?(o=n,n=r.prevSibling):n=r}return o}function resolveNode(o,e,n,r){for(var s;o.from==o.to||(n<1?o.from>=e:o.from>e)||(n>-1?o.to<=e:o.to<e);){let a=!r&&o instanceof TreeNode&&o.index<0?null:o.parent;if(!a)return o;o=a}let l=r?0:IterMode.IgnoreOverlays;if(r)for(let a=o,h=a.parent;h;a=h,h=a.parent)a instanceof TreeNode&&a.index<0&&((s=h.enter(e,n,l))===null||s===void 0?void 0:s.from)!=a.from&&(o=h);for(;;){let a=o.enter(e,n,l);if(!a)return o;o=a}}class TreeNode{constructor(e,n,r,s){this._tree=e,this.from=n,this.index=r,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,n,r,s,l=0){for(let a=this;;){for(let{children:h,positions:c}=a._tree,u=n>0?h.length:-1;e!=u;e+=n){let f=h[e],d=c[e]+a.from;if(!!checkSide(s,r,d,d+f.length)){if(f instanceof TreeBuffer){if(l&IterMode.ExcludeBuffers)continue;let g=f.findChild(0,f.buffer.length,n,r-d,s);if(g>-1)return new BufferNode(new BufferContext(a,f,e,d),null,g)}else if(l&IterMode.IncludeAnonymous||!f.type.isAnonymous||hasChild(f)){let g;if(!(l&IterMode.IgnoreMounts)&&f.props&&(g=f.prop(NodeProp.mounted))&&!g.overlay)return new TreeNode(g.tree,d,e,a);let p=new TreeNode(f,d,e,a);return l&IterMode.IncludeAnonymous||!p.type.isAnonymous?p:p.nextChild(n<0?f.children.length-1:0,n,r,s)}}}if(l&IterMode.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+n:e=n<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,n,r=0){let s;if(!(r&IterMode.IgnoreOverlays)&&(s=this._tree.prop(NodeProp.mounted))&&s.overlay){let l=e-this.from;for(let{from:a,to:h}of s.overlay)if((n>0?a<=l:a<l)&&(n<0?h>=l:h>l))return new TreeNode(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,n,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}cursor(e=0){return new TreeCursor(this,e)}get tree(){return this._tree}toTree(){return this._tree}resolve(e,n=0){return resolveNode(this,e,n,!1)}resolveInner(e,n=0){return resolveNode(this,e,n,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}getChild(e,n=null,r=null){let s=getChildren(this,e,n,r);return s.length?s[0]:null}getChildren(e,n=null,r=null){return getChildren(this,e,n,r)}toString(){return this._tree.toString()}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}function getChildren(o,e,n,r){let s=o.cursor(),l=[];if(!s.firstChild())return l;if(n!=null){for(;!s.type.is(n);)if(!s.nextSibling())return l}for(;;){if(r!=null&&s.type.is(r))return l;if(s.type.is(e)&&l.push(s.node),!s.nextSibling())return r==null?l:[]}}function matchNodeContext(o,e,n=e.length-1){for(let r=o.parent;n>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[n]&&e[n]!=r.name)return!1;n--}}return!0}class BufferContext{constructor(e,n,r,s){this.parent=e,this.buffer=n,this.index=r,this.start=s}}class BufferNode{constructor(e,n,r){this.context=e,this._parent=n,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}child(e,n,r){let{buffer:s}=this.context,l=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.context.start,r);return l<0?null:new BufferNode(this.context,this,l)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,n,r=0){if(r&IterMode.ExcludeBuffers)return null;let{buffer:s}=this.context,l=s.findChild(this.index+4,s.buffer[this.index+3],n>0?1:-1,e-this.context.start,n);return l<0?null:new BufferNode(this.context,this,l)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,n=e.buffer[this.index+3];return n<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new BufferNode(this.context,this._parent,n):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,n=this._parent?this._parent.index+4:0;return this.index==n?this.externalSibling(-1):new BufferNode(this.context,this._parent,e.findChild(n,this.index,-1,0,4))}cursor(e=0){return new TreeCursor(this,e)}get tree(){return null}toTree(){let e=[],n=[],{buffer:r}=this.context,s=this.index+4,l=r.buffer[this.index+3];if(l>s){let a=r.buffer[this.index+1],h=r.buffer[this.index+2];e.push(r.slice(s,l,a,h)),n.push(0)}return new Tree(this.type,e,n,this.to-this.from)}resolve(e,n=0){return resolveNode(this,e,n,!1)}resolveInner(e,n=0){return resolveNode(this,e,n,!0)}enterUnfinishedNodesBefore(e){return enterUnfinishedNodesBefore(this,e)}toString(){return this.context.buffer.childString(this.index)}getChild(e,n=null,r=null){let s=getChildren(this,e,n,r);return s.length?s[0]:null}getChildren(e,n=null,r=null){return getChildren(this,e,n,r)}get node(){return this}matchContext(e){return matchNodeContext(this,e)}}class TreeCursor{constructor(e,n=0){if(this.mode=n,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof TreeNode)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}get name(){return this.type.name}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,n){this.index=e;let{start:r,buffer:s}=this.buffer;return this.type=n||s.set.types[s.buffer[e]],this.from=r+s.buffer[e+1],this.to=r+s.buffer[e+2],!0}yield(e){return e?e instanceof TreeNode?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,n,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,n,r,this.mode));let{buffer:s}=this.buffer,l=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.buffer.start,r);return l<0?!1:(this.stack.push(this.index),this.yieldBuf(l))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,n,r=this.mode){return this.buffer?r&IterMode.ExcludeBuffers?!1:this.enterChild(1,e,n):this.yield(this._tree.enter(e,n,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&IterMode.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&IterMode.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:n}=this.buffer,r=this.stack.length-1;if(e<0){let s=r<0?0:this.stack[r]+4;if(this.index!=s)return this.yieldBuf(n.findChild(s,this.index,-1,0,4))}else{let s=n.buffer[this.index+3];if(s<(r<0?n.buffer.length:n.buffer[this.stack[r]+3]))return this.yieldBuf(s)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let n,r,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let l=0;l<this.index;l++)if(s.buffer.buffer[l+3]<this.index)return!1;({index:n,parent:r}=s)}else({index:n,_parent:r}=this._tree);for(;r;{index:n,_parent:r}=r)if(n>-1)for(let l=n+e,a=e<0?-1:r._tree.children.length;l!=a;l+=e){let h=r._tree.children[l];if(this.mode&IterMode.IncludeAnonymous||h instanceof TreeBuffer||!h.type.isAnonymous||hasChild(h))return!1}return!0}move(e,n){if(n&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,n=0){for(;(this.from==this.to||(n<1?this.from>=e:this.from>e)||(n>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,n););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,n=null,r=0;if(e&&e.context==this.buffer){e:for(let s=this.index,l=this.stack.length;l>=0;){for(let a=e;a;a=a._parent)if(a.index==s){if(s==this.index)return a;n=a,r=l+1;break e}s=this.stack[--l]}}for(let s=r;s<this.stack.length;s++)n=new BufferNode(this.buffer,n,this.stack[s]);return this.bufferNode=new BufferNode(this.buffer,n,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,n){for(let r=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(s=!0)}for(;s&&n&&n(this),s=this.type.isAnonymous,!this.nextSibling();){if(!r)return;this.parent(),r--,s=!0}}}matchContext(e){if(!this.buffer)return matchNodeContext(this.node,e);let{buffer:n}=this.buffer,{types:r}=n.set;for(let s=e.length-1,l=this.stack.length-1;s>=0;l--){if(l<0)return matchNodeContext(this.node,e,s);let a=r[n.buffer[this.stack[l]]];if(!a.isAnonymous){if(e[s]&&e[s]!=a.name)return!1;s--}}return!0}}function hasChild(o){return o.children.some(e=>e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e))}function buildTree(o){var e;let{buffer:n,nodeSet:r,maxBufferLength:s=DefaultBufferLength,reused:l=[],minRepeatType:a=r.types.length}=o,h=Array.isArray(n)?new FlatBufferCursor(n,n.length):n,c=r.types,u=0,f=0;function d(A,B,x,M,E){let{id:T,start:b,end:D,size:P}=h,L=f;for(;P<0;)if(h.next(),P==-1){let V=l[T];x.push(V),M.push(b-A);return}else if(P==-3){u=T;return}else if(P==-4){f=T;return}else throw new RangeError(`Unrecognized record size: ${P}`);let H=c[T],I,R,G=b-A;if(D-b<=s&&(R=w(h.pos-B,E))){let V=new Uint16Array(R.size-R.skip),O=h.pos-R.size,N=V.length;for(;h.pos>O;)N=y(R.start,V,N);I=new TreeBuffer(V,D-R.start,r),G=R.start-A}else{let V=h.pos-P;h.next();let O=[],N=[],F=T>=a?T:-1,W=0,z=D;for(;h.pos>V;)F>=0&&h.id==F&&h.size>=0?(h.end<=z-s&&(p(O,N,b,W,h.end,z,F,L),W=O.length,z=h.end),h.next()):d(b,V,O,N,F);if(F>=0&&W>0&&W<O.length&&p(O,N,b,W,b,z,F,L),O.reverse(),N.reverse(),F>-1&&W>0){let _=g(H);I=balanceRange(H,O,N,0,O.length,0,D-b,_,_)}else I=m(H,O,N,D-b,L-D)}x.push(I),M.push(G)}function g(A){return(B,x,M)=>{let E=0,T=B.length-1,b,D;if(T>=0&&(b=B[T])instanceof Tree){if(!T&&b.type==A&&b.length==M)return b;(D=b.prop(NodeProp.lookAhead))&&(E=x[T]+b.length+D)}return m(A,B,x,M,E)}}function p(A,B,x,M,E,T,b,D){let P=[],L=[];for(;A.length>M;)P.push(A.pop()),L.push(B.pop()+x-E);A.push(m(r.types[b],P,L,T-E,D-T)),B.push(E-x)}function m(A,B,x,M,E=0,T){if(u){let b=[NodeProp.contextHash,u];T=T?[b].concat(T):[b]}if(E>25){let b=[NodeProp.lookAhead,E];T=T?[b].concat(T):[b]}return new Tree(A,B,x,M,T)}function w(A,B){let x=h.fork(),M=0,E=0,T=0,b=x.end-s,D={size:0,start:0,skip:0};e:for(let P=x.pos-A;x.pos>P;){let L=x.size;if(x.id==B&&L>=0){D.size=M,D.start=E,D.skip=T,T+=4,M+=4,x.next();continue}let H=x.pos-L;if(L<0||H<P||x.start<b)break;let I=x.id>=a?4:0,R=x.start;for(x.next();x.pos>H;){if(x.size<0)if(x.size==-3)I+=4;else break e;else x.id>=a&&(I+=4);x.next()}E=R,M+=L,T+=I}return(B<0||M==A)&&(D.size=M,D.start=E,D.skip=T),D.size>4?D:void 0}function y(A,B,x){let{id:M,start:E,end:T,size:b}=h;if(h.next(),b>=0&&M<a){let D=x;if(b>4){let P=h.pos-(b-4);for(;h.pos>P;)x=y(A,B,x)}B[--x]=D,B[--x]=T-A,B[--x]=E-A,B[--x]=M}else b==-3?u=M:b==-4&&(f=M);return x}let S=[],v=[];for(;h.pos>0;)d(o.start||0,o.bufferStart||0,S,v,-1);let k=(e=o.length)!==null&&e!==void 0?e:S.length?v[0]+S[0].length:0;return new Tree(c[o.topID],S.reverse(),v.reverse(),k)}const nodeSizeCache=new WeakMap;function nodeSize(o,e){if(!o.isAnonymous||e instanceof TreeBuffer||e.type!=o)return 1;let n=nodeSizeCache.get(e);if(n==null){n=1;for(let r of e.children){if(r.type!=o||!(r instanceof Tree)){n=1;break}n+=nodeSize(o,r)}nodeSizeCache.set(e,n)}return n}function balanceRange(o,e,n,r,s,l,a,h,c){let u=0;for(let m=r;m<s;m++)u+=nodeSize(o,e[m]);let f=Math.ceil(u*1.5/8),d=[],g=[];function p(m,w,y,S,v){for(let k=y;k<S;){let A=k,B=w[k],x=nodeSize(o,m[k]);for(k++;k<S;k++){let M=nodeSize(o,m[k]);if(x+M>=f)break;x+=M}if(k==A+1){if(x>f){let M=m[A];p(M.children,M.positions,0,M.children.length,w[A]+v);continue}d.push(m[A])}else{let M=w[k-1]+m[k-1].length-B;d.push(balanceRange(o,m,w,A,k,B,M,null,c))}g.push(B+v-l)}}return p(e,n,r,s,0),(h||c)(d,g,a)}class TreeFragment{constructor(e,n,r,s,l=!1,a=!1){this.from=e,this.to=n,this.tree=r,this.offset=s,this.open=(l?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,n=[],r=!1){let s=[new TreeFragment(0,e.length,e,0,!1,r)];for(let l of n)l.to>e.length&&s.push(l);return s}static applyChanges(e,n,r=128){if(!n.length)return e;let s=[],l=1,a=e.length?e[0]:null;for(let h=0,c=0,u=0;;h++){let f=h<n.length?n[h]:null,d=f?f.fromA:1e9;if(d-c>=r)for(;a&&a.from<d;){let g=a;if(c>=g.from||d<=g.to||u){let p=Math.max(g.from,c)-u,m=Math.min(g.to,d)-u;g=p>=m?null:new TreeFragment(p,m,g.tree,g.offset+u,h>0,!!f)}if(g&&s.push(g),a.to>d)break;a=l<e.length?e[l++]:null}if(!f)break;c=f.toA,u=f.toA-f.toB}return s}}class Parser{startParse(e,n,r){return typeof e=="string"&&(e=new StringInput(e)),r=r?r.length?r.map(s=>new Range(s.from,s.to)):[new Range(0,0)]:[new Range(0,e.length)],this.createParse(e,n||[],r)}parse(e,n,r){let s=this.startParse(e,n,r);for(;;){let l=s.advance();if(l)return l}}}class StringInput{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,n){return this.string.slice(e,n)}}new NodeProp({perNode:!0});let nextTagID=0;class Tag{constructor(e,n,r){this.set=e,this.base=n,this.modified=r,this.id=nextTagID++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let n=new Tag([],null,[]);if(n.set.push(n),e)for(let r of e.set)n.set.push(r);return n}static defineModifier(){let e=new Modifier;return n=>n.modified.indexOf(e)>-1?n:Modifier.get(n.base||n,n.modified.concat(e).sort((r,s)=>r.id-s.id))}}let nextModifierID=0;class Modifier{constructor(){this.instances=[],this.id=nextModifierID++}static get(e,n){if(!n.length)return e;let r=n[0].instances.find(h=>h.base==e&&sameArray(n,h.modified));if(r)return r;let s=[],l=new Tag(s,e,n);for(let h of n)h.instances.push(l);let a=powerSet(n);for(let h of e.set)if(!h.modified.length)for(let c of a)s.push(Modifier.get(h,c));return l}}function sameArray(o,e){return o.length==e.length&&o.every((n,r)=>n==e[r])}function powerSet(o){let e=[[]];for(let n=0;n<o.length;n++)for(let r=0,s=e.length;r<s;r++)e.push(e[r].concat(o[n]));return e.sort((n,r)=>r.length-n.length)}function styleTags(o){let e=Object.create(null);for(let n in o){let r=o[n];Array.isArray(r)||(r=[r]);for(let s of n.split(" "))if(s){let l=[],a=2,h=s;for(let d=0;;){if(h=="..."&&d>0&&d+3==s.length){a=1;break}let g=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(h);if(!g)throw new RangeError("Invalid path: "+s);if(l.push(g[0]=="*"?"":g[0][0]=='"'?JSON.parse(g[0]):g[0]),d+=g[0].length,d==s.length)break;let p=s[d++];if(d==s.length&&p=="!"){a=0;break}if(p!="/")throw new RangeError("Invalid path: "+s);h=s.slice(d)}let c=l.length-1,u=l[c];if(!u)throw new RangeError("Invalid path: "+s);let f=new Rule(r,a,c>0?l.slice(0,c):null);e[u]=f.sort(e[u])}}return ruleNodeProp.add(e)}const ruleNodeProp=new NodeProp;class Rule{constructor(e,n,r,s){this.tags=e,this.mode=n,this.context=r,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Rule.empty=new Rule([],2,null);function tagHighlighter(o,e){let n=Object.create(null);for(let l of o)if(!Array.isArray(l.tag))n[l.tag.id]=l.class;else for(let a of l.tag)n[a.id]=l.class;let{scope:r,all:s=null}=e||{};return{style:l=>{let a=s;for(let h of l)for(let c of h.set){let u=n[c.id];if(u){a=a?a+" "+u:u;break}}return a},scope:r}}const t=Tag.define,comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t(),tags={comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name,variableName:t(name),typeName,tagName:t(typeName),propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal,string,docString:t(string),character:t(string),attributeValue:t(string),number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation,separator:t(punctuation),bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content,heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};tagHighlighter([{tag:tags.link,class:"tok-link"},{tag:tags.heading,class:"tok-heading"},{tag:tags.emphasis,class:"tok-emphasis"},{tag:tags.strong,class:"tok-strong"},{tag:tags.keyword,class:"tok-keyword"},{tag:tags.atom,class:"tok-atom"},{tag:tags.bool,class:"tok-bool"},{tag:tags.url,class:"tok-url"},{tag:tags.labelName,class:"tok-labelName"},{tag:tags.inserted,class:"tok-inserted"},{tag:tags.deleted,class:"tok-deleted"},{tag:tags.literal,class:"tok-literal"},{tag:tags.string,class:"tok-string"},{tag:tags.number,class:"tok-number"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],class:"tok-string2"},{tag:tags.variableName,class:"tok-variableName"},{tag:tags.local(tags.variableName),class:"tok-variableName tok-local"},{tag:tags.definition(tags.variableName),class:"tok-variableName tok-definition"},{tag:tags.special(tags.variableName),class:"tok-variableName2"},{tag:tags.definition(tags.propertyName),class:"tok-propertyName tok-definition"},{tag:tags.typeName,class:"tok-typeName"},{tag:tags.namespace,class:"tok-namespace"},{tag:tags.className,class:"tok-className"},{tag:tags.macroName,class:"tok-macroName"},{tag:tags.propertyName,class:"tok-propertyName"},{tag:tags.operator,class:"tok-operator"},{tag:tags.comment,class:"tok-comment"},{tag:tags.meta,class:"tok-meta"},{tag:tags.invalid,class:"tok-invalid"},{tag:tags.punctuation,class:"tok-punctuation"}]);var _a;const languageDataProp=new NodeProp;class Language{constructor(e,n,r=[],s=""){this.data=e,this.name=s,EditorState.prototype.hasOwnProperty("tree")||Object.defineProperty(EditorState.prototype,"tree",{get(){return syntaxTree(this)}}),this.parser=n,this.extension=[language.of(this),EditorState.languageData.of((l,a,h)=>l.facet(languageDataFacetAt(l,a,h)))].concat(r)}isActiveAt(e,n,r=-1){return languageDataFacetAt(e,n,r)==this.data}findRegions(e){let n=e.facet(language);if((n==null?void 0:n.data)==this.data)return[{from:0,to:e.doc.length}];if(!n||!n.allowsNesting)return[];let r=[],s=(l,a)=>{if(l.prop(languageDataProp)==this.data){r.push({from:a,to:a+l.length});return}let h=l.prop(NodeProp.mounted);if(h){if(h.tree.prop(languageDataProp)==this.data){if(h.overlay)for(let c of h.overlay)r.push({from:c.from+a,to:c.to+a});else r.push({from:a,to:a+l.length});return}else if(h.overlay){let c=r.length;if(s(h.tree,h.overlay[0].from+a),r.length>c)return}}for(let c=0;c<l.children.length;c++){let u=l.children[c];u instanceof Tree&&s(u,l.positions[c]+a)}};return s(syntaxTree(e),0),r}get allowsNesting(){return!0}}Language.setState=StateEffect.define();function languageDataFacetAt(o,e,n){let r=o.facet(language);if(!r)return null;let s=r.data;if(r.allowsNesting)for(let l=syntaxTree(o).topNode;l;l=l.enter(e,n,IterMode.ExcludeBuffers))s=l.type.prop(languageDataProp)||s;return s}function syntaxTree(o){let e=o.field(Language.state,!1);return e?e.tree:Tree.empty}class DocInput{constructor(e,n=e.length){this.doc=e,this.length=n,this.cursorPos=0,this.string="",this.cursor=e.iter()}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,n){let r=this.cursorPos-this.string.length;return e<r||n>=this.cursorPos?this.doc.sliceString(e,n):this.string.slice(e-r,n-r)}}let currentContext=null;class ParseContext{constructor(e,n,r=[],s,l,a,h,c){this.parser=e,this.state=n,this.fragments=r,this.tree=s,this.treeLen=l,this.viewport=a,this.skipped=h,this.scheduleOn=c,this.parse=null,this.tempSkipped=[]}static create(e,n,r){return new ParseContext(e,n,[],Tree.empty,0,r,[],null)}startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)}work(e,n){return n!=null&&n>=this.state.doc.length&&(n=void 0),this.tree!=Tree.empty&&this.isDone(n!=null?n:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),n!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>n)&&n<this.state.doc.length&&this.parse.stopAt(n);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(TreeFragment.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(n!=null?n:this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,n;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(n=this.parse.advance()););}),this.treeLen=e,this.tree=n,this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let n=currentContext;currentContext=this;try{return e()}finally{currentContext=n}}withoutTempSkipped(e){for(let n;n=this.tempSkipped.pop();)e=cutFragments(e,n.from,n.to);return e}changes(e,n){let{fragments:r,tree:s,treeLen:l,viewport:a,skipped:h}=this;if(this.takeTree(),!e.empty){let c=[];if(e.iterChangedRanges((u,f,d,g)=>c.push({fromA:u,toA:f,fromB:d,toB:g})),r=TreeFragment.applyChanges(r,c),s=Tree.empty,l=0,a={from:e.mapPos(a.from,-1),to:e.mapPos(a.to,1)},this.skipped.length){h=[];for(let u of this.skipped){let f=e.mapPos(u.from,1),d=e.mapPos(u.to,-1);f<d&&h.push({from:f,to:d})}}}return new ParseContext(this.parser,n,r,s,l,a,h,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let n=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:s,to:l}=this.skipped[r];s<e.to&&l>e.from&&(this.fragments=cutFragments(this.fragments,s,l),this.skipped.splice(r--,1))}return this.skipped.length>=n?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,n){this.skipped.push({from:e,to:n})}static getSkippingParser(e){return new class extends Parser{createParse(n,r,s){let l=s[0].from,a=s[s.length-1].to;return{parsedPos:l,advance(){let c=currentContext;if(c){for(let u of s)c.tempSkipped.push(u);e&&(c.scheduleOn=c.scheduleOn?Promise.all([c.scheduleOn,e]):e)}return this.parsedPos=a,new Tree(NodeType.none,[],[],a-l)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let n=this.fragments;return this.treeLen>=e&&n.length&&n[0].from==0&&n[0].to>=e}static get(){return currentContext}}function cutFragments(o,e,n){return TreeFragment.applyChanges(o,[{fromA:e,toA:n,fromB:e,toB:n}])}class LanguageState{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let n=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),n.viewport.to);return n.work(20,r)||n.takeTree(),new LanguageState(n)}static init(e){let n=Math.min(3e3,e.doc.length),r=ParseContext.create(e.facet(language).parser,e,{from:0,to:n});return r.work(20,n)||r.takeTree(),new LanguageState(r)}}Language.state=StateField.define({create:LanguageState.init,update(o,e){for(let n of e.effects)if(n.is(Language.setState))return n.value;return e.startState.facet(language)!=e.state.facet(language)?LanguageState.init(e.state):o.apply(e)}});let requestIdle=o=>{let e=setTimeout(()=>o(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(requestIdle=o=>{let e=-1,n=setTimeout(()=>{e=requestIdleCallback(o,{timeout:500-100})},100);return()=>e<0?clearTimeout(n):cancelIdleCallback(e)});const isInputPending=typeof navigator<"u"&&((_a=navigator.scheduling)===null||_a===void 0?void 0:_a.isInputPending)?()=>navigator.scheduling.isInputPending():null,parseWorker=ViewPlugin.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let n=this.view.state.field(Language.state).context;(n.updateViewport(e.view.viewport)||this.view.viewport.to>n.treeLen)&&this.scheduleWork(),e.docChanged&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(n)}scheduleWork(){if(this.working)return;let{state:e}=this.view,n=e.field(Language.state);(n.tree!=n.context.tree||!n.context.isDone(e.doc.length))&&(this.working=requestIdle(this.work))}work(e){this.working=null;let n=Date.now();if(this.chunkEnd<n&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=n+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:s}}=this.view,l=r.field(Language.state);if(l.tree==l.context.tree&&l.context.isDone(s+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,e&&!isInputPending?Math.max(25,e.timeRemaining()-5):1e9),h=l.context.treeLen<s&&r.doc.length>s+1e3,c=l.context.work(()=>isInputPending&&isInputPending()||Date.now()>a,s+(h?0:1e5));this.chunkBudget-=Date.now()-n,(c||this.chunkBudget<=0)&&(l.context.takeTree(),this.view.dispatch({effects:Language.setState.of(new LanguageState(l.context))})),this.chunkBudget>0&&!(c&&!h)&&this.scheduleWork(),this.checkAsyncSchedule(l.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(n=>logException(this.view.state,n)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),language=Facet.define({combine(o){return o.length?o[0]:null},enables:o=>[Language.state,parseWorker,EditorView.contentAttributes.compute([o],e=>{let n=e.facet(o);return n&&n.name?{"data-language":n.name}:{}})]}),indentService=Facet.define(),indentUnit=Facet.define({combine:o=>{if(!o.length)return"  ";if(!/^(?: +|\t+)$/.test(o[0]))throw new Error("Invalid indent unit: "+JSON.stringify(o[0]));return o[0]}});function getIndentUnit(o){let e=o.facet(indentUnit);return e.charCodeAt(0)==9?o.tabSize*e.length:e.length}function indentString(o,e){let n="",r=o.tabSize;if(o.facet(indentUnit).charCodeAt(0)==9)for(;e>=r;)n+="	",e-=r;for(let s=0;s<e;s++)n+=" ";return n}function getIndentation(o,e){o instanceof EditorState&&(o=new IndentContext(o));for(let r of o.state.facet(indentService)){let s=r(o,e);if(s!==void 0)return s}let n=syntaxTree(o.state);return n?syntaxIndentation(o,n,e):null}class IndentContext{constructor(e,n={}){this.state=e,this.options=n,this.unit=getIndentUnit(e)}lineAt(e,n=1){let r=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:l}=this.options;return s!=null&&s>=r.from&&s<=r.to?l&&s==e?{text:"",from:e}:(n<0?s<e:s<=e)?{text:r.text.slice(s-r.from),from:s}:{text:r.text.slice(0,s-r.from),from:r.from}:r}textAfterPos(e,n=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:s}=this.lineAt(e,n);return r.slice(e-s,Math.min(r.length,e+100-s))}column(e,n=1){let{text:r,from:s}=this.lineAt(e,n),l=this.countColumn(r,e-s),a=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return a>-1&&(l+=a-this.countColumn(r,r.search(/\S|$/))),l}countColumn(e,n=e.length){return countColumn(e,this.state.tabSize,n)}lineIndent(e,n=1){let{text:r,from:s}=this.lineAt(e,n),l=this.options.overrideIndentation;if(l){let a=l(s);if(a>-1)return a}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const indentNodeProp=new NodeProp;function syntaxIndentation(o,e,n){return indentFrom(e.resolveInner(n).enterUnfinishedNodesBefore(n),n,o)}function ignoreClosed(o){return o.pos==o.options.simulateBreak&&o.options.simulateDoubleBreak}function indentStrategy(o){let e=o.type.prop(indentNodeProp);if(e)return e;let n=o.firstChild,r;if(n&&(r=n.type.prop(NodeProp.closedBy))){let s=o.lastChild,l=s&&r.indexOf(s.name)>-1;return a=>delimitedStrategy(a,!0,1,void 0,l&&!ignoreClosed(a)?s.from:void 0)}return o.parent==null?topIndent:null}function indentFrom(o,e,n){for(;o;o=o.parent){let r=indentStrategy(o);if(r)return r(TreeIndentContext.create(n,e,o))}return null}function topIndent(){return 0}class TreeIndentContext extends IndentContext{constructor(e,n,r){super(e.state,e.options),this.base=e,this.pos=n,this.node=r}static create(e,n,r){return new TreeIndentContext(e,n,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){let e=this.state.doc.lineAt(this.node.from);for(;;){let n=this.node.resolve(e.from);for(;n.parent&&n.parent.from==n.from;)n=n.parent;if(isParent(n,this.node))break;e=this.state.doc.lineAt(n.from)}return this.lineIndent(e.from)}continue(){let e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0}}function isParent(o,e){for(let n=e;n;n=n.parent)if(o==n)return!0;return!1}function bracketedAligned(o){let e=o.node,n=e.childAfter(e.from),r=e.lastChild;if(!n)return null;let s=o.options.simulateBreak,l=o.state.doc.lineAt(n.from),a=s==null||s<=l.from?l.to:Math.min(l.to,s);for(let h=n.to;;){let c=e.childAfter(h);if(!c||c==r)return null;if(!c.type.isSkipped)return c.from<a?n:null;h=c.to}}function delimitedStrategy(o,e,n,r,s){let l=o.textAfter,a=l.match(/^\s*/)[0].length,h=r&&l.slice(a,a+r.length)==r||s==o.pos+a,c=e?bracketedAligned(o):null;return c?h?o.column(c.from):o.column(c.to):o.baseIndent+(h?0:o.unit*n)}const DefaultScanDist=1e4,DefaultBrackets="()[]{}";function matchingNodes(o,e,n){let r=o.prop(e<0?NodeProp.openedBy:NodeProp.closedBy);if(r)return r;if(o.name.length==1){let s=n.indexOf(o.name);if(s>-1&&s%2==(e<0?1:0))return[n[s+e]]}return null}function matchBrackets(o,e,n,r={}){let s=r.maxScanDistance||DefaultScanDist,l=r.brackets||DefaultBrackets,a=syntaxTree(o),h=a.resolveInner(e,n);for(let c=h;c;c=c.parent){let u=matchingNodes(c.type,n,l);if(u&&c.from<c.to)return matchMarkedBrackets(o,e,n,c,u,l)}return matchPlainBrackets(o,e,n,a,h.type,s,l)}function matchMarkedBrackets(o,e,n,r,s,l){let a=r.parent,h={from:r.from,to:r.to},c=0,u=a==null?void 0:a.cursor();if(u&&(n<0?u.childBefore(r.from):u.childAfter(r.to)))do if(n<0?u.to<=r.from:u.from>=r.to){if(c==0&&s.indexOf(u.type.name)>-1&&u.from<u.to)return{start:h,end:{from:u.from,to:u.to},matched:!0};if(matchingNodes(u.type,n,l))c++;else if(matchingNodes(u.type,-n,l)){if(c==0)return{start:h,end:u.from==u.to?void 0:{from:u.from,to:u.to},matched:!1};c--}}while(n<0?u.prevSibling():u.nextSibling());return{start:h,matched:!1}}function matchPlainBrackets(o,e,n,r,s,l,a){let h=n<0?o.sliceDoc(e-1,e):o.sliceDoc(e,e+1),c=a.indexOf(h);if(c<0||c%2==0!=n>0)return null;let u={from:n<0?e-1:e,to:n>0?e+1:e},f=o.doc.iterRange(e,n>0?o.doc.length:0),d=0;for(let g=0;!f.next().done&&g<=l;){let p=f.value;n<0&&(g+=p.length);let m=e+g*n;for(let w=n>0?0:p.length-1,y=n>0?p.length:-1;w!=y;w+=n){let S=a.indexOf(p[w]);if(!(S<0||r.resolveInner(m+w,1).type!=s))if(S%2==0==n>0)d++;else{if(d==1)return{start:u,end:{from:m+w,to:m+w+1},matched:S>>1==c>>1};d--}}n>0&&(g+=p.length)}return f.done?{start:u,matched:!1}:null}const noTokens=Object.create(null),typeArray=[NodeType.none],warned=[],defaultTable=Object.create(null);for(let[o,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])defaultTable[o]=createTokenType(noTokens,e);function warnForPart(o,e){warned.indexOf(o)>-1||(warned.push(o),console.warn(e))}function createTokenType(o,e){let n=null;for(let l of e.split(".")){let a=o[l]||tags[l];a?typeof a=="function"?n?n=a(n):warnForPart(l,`Modifier ${l} used at start of tag`):n?warnForPart(l,`Tag ${l} used as modifier`):n=a:warnForPart(l,`Unknown highlighting tag ${l}`)}if(!n)return 0;let r=e.replace(/ /g,"_"),s=NodeType.define({id:typeArray.length,name:r,props:[styleTags({[r]:n})]});return typeArray.push(s),s.id}const toggleComment=o=>{let e=getConfig(o.state);return e.line?toggleLineComment(o):e.block?toggleBlockCommentByLine(o):!1};function command(o,e){return({state:n,dispatch:r})=>{if(n.readOnly)return!1;let s=o(e,n);return s?(r(n.update(s)),!0):!1}}const toggleLineComment=command(changeLineComment,0),toggleBlockComment=command(changeBlockComment,0),toggleBlockCommentByLine=command((o,e)=>changeBlockComment(o,e,selectedLineRanges(e)),0);function getConfig(o,e=o.selection.main.head){let n=o.languageDataAt("commentTokens",e);return n.length?n[0]:{}}const SearchMargin=50;function findBlockComment(o,{open:e,close:n},r,s){let l=o.sliceDoc(r-SearchMargin,r),a=o.sliceDoc(s,s+SearchMargin),h=/\s*$/.exec(l)[0].length,c=/^\s*/.exec(a)[0].length,u=l.length-h;if(l.slice(u-e.length,u)==e&&a.slice(c,c+n.length)==n)return{open:{pos:r-h,margin:h&&1},close:{pos:s+c,margin:c&&1}};let f,d;s-r<=2*SearchMargin?f=d=o.sliceDoc(r,s):(f=o.sliceDoc(r,r+SearchMargin),d=o.sliceDoc(s-SearchMargin,s));let g=/^\s*/.exec(f)[0].length,p=/\s*$/.exec(d)[0].length,m=d.length-p-n.length;return f.slice(g,g+e.length)==e&&d.slice(m,m+n.length)==n?{open:{pos:r+g+e.length,margin:/\s/.test(f.charAt(g+e.length))?1:0},close:{pos:s-p-n.length,margin:/\s/.test(d.charAt(m-1))?1:0}}:null}function selectedLineRanges(o){let e=[];for(let n of o.selection.ranges){let r=o.doc.lineAt(n.from),s=n.to<=r.to?r:o.doc.lineAt(n.to),l=e.length-1;l>=0&&e[l].to>r.from?e[l].to=s.to:e.push({from:r.from,to:s.to})}return e}function changeBlockComment(o,e,n=e.selection.ranges){let r=n.map(l=>getConfig(e,l.from).block);if(!r.every(l=>l))return null;let s=n.map((l,a)=>findBlockComment(e,r[a],l.from,l.to));if(o!=2&&!s.every(l=>l))return{changes:e.changes(n.map((l,a)=>s[a]?[]:[{from:l.from,insert:r[a].open+" "},{from:l.to,insert:" "+r[a].close}]))};if(o!=1&&s.some(l=>l)){let l=[];for(let a=0,h;a<s.length;a++)if(h=s[a]){let c=r[a],{open:u,close:f}=h;l.push({from:u.pos-c.open.length,to:u.pos+u.margin},{from:f.pos-f.margin,to:f.pos+c.close.length})}return{changes:l}}return null}function changeLineComment(o,e,n=e.selection.ranges){let r=[],s=-1;for(let{from:l,to:a}of n){let h=r.length,c=1e9;for(let u=l;u<=a;){let f=e.doc.lineAt(u);if(f.from>s&&(l==a||a>f.from)){s=f.from;let d=getConfig(e,u).line;if(!d)continue;let g=/^\s*/.exec(f.text)[0].length,p=g==f.length,m=f.text.slice(g,g+d.length)==d?g:-1;g<f.text.length&&g<c&&(c=g),r.push({line:f,comment:m,token:d,indent:g,empty:p,single:!1})}u=f.to+1}if(c<1e9)for(let u=h;u<r.length;u++)r[u].indent<r[u].line.text.length&&(r[u].indent=c);r.length==h+1&&(r[h].single=!0)}if(o!=2&&r.some(l=>l.comment<0&&(!l.empty||l.single))){let l=[];for(let{line:h,token:c,indent:u,empty:f,single:d}of r)(d||!f)&&l.push({from:h.from+u,insert:c+" "});let a=e.changes(l);return{changes:a,selection:e.selection.map(a,1)}}else if(o!=1&&r.some(l=>l.comment>=0)){let l=[];for(let{line:a,comment:h,token:c}of r)if(h>=0){let u=a.from+h,f=u+c.length;a.text[f-a.from]==" "&&f++,l.push({from:u,to:f})}return{changes:l}}return null}function updateSel(o,e){return EditorSelection.create(o.ranges.map(e),o.mainIndex)}function setSel(o,e){return o.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function moveSel({state:o,dispatch:e},n){let r=updateSel(o.selection,n);return r.eq(o.selection)?!1:(e(setSel(o,r)),!0)}function rangeEnd(o,e){return EditorSelection.cursor(e?o.to:o.from)}function cursorByChar(o,e){return moveSel(o,n=>n.empty?o.moveByChar(n,e):rangeEnd(n,e))}function ltrAtCursor(o){return o.textDirectionAt(o.state.selection.main.head)==Direction.LTR}const cursorCharLeft=o=>cursorByChar(o,!ltrAtCursor(o)),cursorCharRight=o=>cursorByChar(o,ltrAtCursor(o));function cursorByGroup(o,e){return moveSel(o,n=>n.empty?o.moveByGroup(n,e):rangeEnd(n,e))}const cursorGroupLeft=o=>cursorByGroup(o,!ltrAtCursor(o)),cursorGroupRight=o=>cursorByGroup(o,ltrAtCursor(o));function interestingNode(o,e,n){if(e.type.prop(n))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(o.sliceDoc(e.from,e.to)))||e.firstChild}function moveBySyntax(o,e,n){let r=syntaxTree(o).resolveInner(e.head),s=n?NodeProp.closedBy:NodeProp.openedBy;for(let c=e.head;;){let u=n?r.childAfter(c):r.childBefore(c);if(!u)break;interestingNode(o,u,s)?r=u:c=n?u.to:u.from}let l=r.type.prop(s),a,h;return l&&(a=n?matchBrackets(o,r.from,1):matchBrackets(o,r.to,-1))&&a.matched?h=n?a.end.to:a.end.from:h=n?r.to:r.from,EditorSelection.cursor(h,n?-1:1)}const cursorSyntaxLeft=o=>moveSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),cursorSyntaxRight=o=>moveSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function cursorByLine(o,e){return moveSel(o,n=>{if(!n.empty)return rangeEnd(n,e);let r=o.moveVertically(n,e);return r.head!=n.head?r:o.moveToLineBoundary(n,e)})}const cursorLineUp=o=>cursorByLine(o,!1),cursorLineDown=o=>cursorByLine(o,!0);function pageHeight(o){return Math.max(o.defaultLineHeight,Math.min(o.dom.clientHeight,innerHeight)-5)}function cursorByPage(o,e){let{state:n}=o,r=updateSel(n.selection,h=>h.empty?o.moveVertically(h,e,pageHeight(o)):rangeEnd(h,e));if(r.eq(n.selection))return!1;let s=o.coordsAtPos(n.selection.main.head),l=o.scrollDOM.getBoundingClientRect(),a;return s&&s.top>l.top&&s.bottom<l.bottom&&s.top-l.top<=o.scrollDOM.scrollHeight-o.scrollDOM.scrollTop-o.scrollDOM.clientHeight&&(a=EditorView.scrollIntoView(r.main.head,{y:"start",yMargin:s.top-l.top})),o.dispatch(setSel(n,r),{effects:a}),!0}const cursorPageUp=o=>cursorByPage(o,!1),cursorPageDown=o=>cursorByPage(o,!0);function moveByLineBoundary(o,e,n){let r=o.lineBlockAt(e.head),s=o.moveToLineBoundary(e,n);if(s.head==e.head&&s.head!=(n?r.to:r.from)&&(s=o.moveToLineBoundary(e,n,!1)),!n&&s.head==r.from&&r.length){let l=/^\s*/.exec(o.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;l&&e.head!=r.from+l&&(s=EditorSelection.cursor(r.from+l))}return s}const cursorLineBoundaryForward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!0)),cursorLineBoundaryBackward=o=>moveSel(o,e=>moveByLineBoundary(o,e,!1)),cursorLineBoundaryLeft=o=>moveSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),cursorLineBoundaryRight=o=>moveSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),cursorLineStart=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from,1)),cursorLineEnd=o=>moveSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to,-1));function toMatchingBracket(o,e,n){let r=!1,s=updateSel(o.selection,l=>{let a=matchBrackets(o,l.head,-1)||matchBrackets(o,l.head,1)||l.head>0&&matchBrackets(o,l.head-1,1)||l.head<o.doc.length&&matchBrackets(o,l.head+1,-1);if(!a||!a.end)return l;r=!0;let h=a.start.from==l.head?a.end.to:a.end.from;return n?EditorSelection.range(l.anchor,h):EditorSelection.cursor(h)});return r?(e(setSel(o,s)),!0):!1}const cursorMatchingBracket=({state:o,dispatch:e})=>toMatchingBracket(o,e,!1);function extendSel(o,e){let n=updateSel(o.state.selection,r=>{let s=e(r);return EditorSelection.range(r.anchor,s.head,s.goalColumn)});return n.eq(o.state.selection)?!1:(o.dispatch(setSel(o.state,n)),!0)}function selectByChar(o,e){return extendSel(o,n=>o.moveByChar(n,e))}const selectCharLeft=o=>selectByChar(o,!ltrAtCursor(o)),selectCharRight=o=>selectByChar(o,ltrAtCursor(o));function selectByGroup(o,e){return extendSel(o,n=>o.moveByGroup(n,e))}const selectGroupLeft=o=>selectByGroup(o,!ltrAtCursor(o)),selectGroupRight=o=>selectByGroup(o,ltrAtCursor(o)),selectSyntaxLeft=o=>extendSel(o,e=>moveBySyntax(o.state,e,!ltrAtCursor(o))),selectSyntaxRight=o=>extendSel(o,e=>moveBySyntax(o.state,e,ltrAtCursor(o)));function selectByLine(o,e){return extendSel(o,n=>o.moveVertically(n,e))}const selectLineUp=o=>selectByLine(o,!1),selectLineDown=o=>selectByLine(o,!0);function selectByPage(o,e){return extendSel(o,n=>o.moveVertically(n,e,pageHeight(o)))}const selectPageUp=o=>selectByPage(o,!1),selectPageDown=o=>selectByPage(o,!0),selectLineBoundaryForward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!0)),selectLineBoundaryBackward=o=>extendSel(o,e=>moveByLineBoundary(o,e,!1)),selectLineBoundaryLeft=o=>extendSel(o,e=>moveByLineBoundary(o,e,!ltrAtCursor(o))),selectLineBoundaryRight=o=>extendSel(o,e=>moveByLineBoundary(o,e,ltrAtCursor(o))),selectLineStart=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).from)),selectLineEnd=o=>extendSel(o,e=>EditorSelection.cursor(o.lineBlockAt(e.head).to)),cursorDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:0})),!0),cursorDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.doc.length})),!0),selectDocStart=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:0})),!0),selectDocEnd=({state:o,dispatch:e})=>(e(setSel(o,{anchor:o.selection.main.anchor,head:o.doc.length})),!0),selectAll=({state:o,dispatch:e})=>(e(o.update({selection:{anchor:0,head:o.doc.length},userEvent:"select"})),!0),selectLine=({state:o,dispatch:e})=>{let n=selectedLineBlocks(o).map(({from:r,to:s})=>EditorSelection.range(r,Math.min(s+1,o.doc.length)));return e(o.update({selection:EditorSelection.create(n),userEvent:"select"})),!0},selectParentSyntax=({state:o,dispatch:e})=>{let n=updateSel(o.selection,r=>{var s;let l=syntaxTree(o).resolveInner(r.head,1);for(;!(l.from<r.from&&l.to>=r.to||l.to>r.to&&l.from<=r.from||!(!((s=l.parent)===null||s===void 0)&&s.parent));)l=l.parent;return EditorSelection.range(l.to,l.from)});return e(setSel(o,n)),!0},simplifySelection=({state:o,dispatch:e})=>{let n=o.selection,r=null;return n.ranges.length>1?r=EditorSelection.create([n.main]):n.main.empty||(r=EditorSelection.create([EditorSelection.cursor(n.main.head)])),r?(e(setSel(o,r)),!0):!1};function deleteBy(o,e){if(o.state.readOnly)return!1;let n="delete.selection",{state:r}=o,s=r.changeByRange(l=>{let{from:a,to:h}=l;if(a==h){let c=e(a);c<a?(n="delete.backward",c=skipAtomic(o,c,!1)):c>a&&(n="delete.forward",c=skipAtomic(o,c,!0)),a=Math.min(a,c),h=Math.max(h,c)}else a=skipAtomic(o,a,!1),h=skipAtomic(o,h,!0);return a==h?{range:l}:{changes:{from:a,to:h},range:EditorSelection.cursor(a)}});return s.changes.empty?!1:(o.dispatch(r.update(s,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?EditorView.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function skipAtomic(o,e,n){if(o instanceof EditorView)for(let r of o.state.facet(EditorView.atomicRanges).map(s=>s(o)))r.between(e,e,(s,l)=>{s<e&&l>e&&(e=n?l:s)});return e}const deleteByChar=(o,e)=>deleteBy(o,n=>{let{state:r}=o,s=r.doc.lineAt(n),l,a;if(!e&&n>s.from&&n<s.from+200&&!/[^ \t]/.test(l=s.text.slice(0,n-s.from))){if(l[l.length-1]=="	")return n-1;let h=countColumn(l,r.tabSize),c=h%getIndentUnit(r)||getIndentUnit(r);for(let u=0;u<c&&l[l.length-1-u]==" ";u++)n--;a=n}else a=findClusterBreak(s.text,n-s.from,e,e)+s.from,a==n&&s.number!=(e?r.doc.lines:1)&&(a+=e?1:-1);return a}),deleteCharBackward=o=>deleteByChar(o,!1),deleteCharForward=o=>deleteByChar(o,!0),deleteByGroup=(o,e)=>deleteBy(o,n=>{let r=n,{state:s}=o,l=s.doc.lineAt(r),a=s.charCategorizer(r);for(let h=null;;){if(r==(e?l.to:l.from)){r==n&&l.number!=(e?s.doc.lines:1)&&(r+=e?1:-1);break}let c=findClusterBreak(l.text,r-l.from,e)+l.from,u=l.text.slice(Math.min(r,c)-l.from,Math.max(r,c)-l.from),f=a(u);if(h!=null&&f!=h)break;(u!=" "||r!=n)&&(h=f),r=c}return r}),deleteGroupBackward=o=>deleteByGroup(o,!1),deleteGroupForward=o=>deleteByGroup(o,!0),deleteToLineEnd=o=>deleteBy(o,e=>{let n=o.lineBlockAt(e).to;return e<n?n:Math.min(o.state.doc.length,e+1)}),deleteToLineStart=o=>deleteBy(o,e=>{let n=o.lineBlockAt(e).from;return e>n?n:Math.max(0,e-1)}),splitLine=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let n=o.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Text.of(["",""])},range:EditorSelection.cursor(r.from)}));return e(o.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},transposeChars=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let n=o.changeByRange(r=>{if(!r.empty||r.from==0||r.from==o.doc.length)return{range:r};let s=r.from,l=o.doc.lineAt(s),a=s==l.from?s-1:findClusterBreak(l.text,s-l.from,!1)+l.from,h=s==l.to?s+1:findClusterBreak(l.text,s-l.from,!0)+l.from;return{changes:{from:a,to:h,insert:o.doc.slice(s,h).append(o.doc.slice(a,s))},range:EditorSelection.cursor(h)}});return n.changes.empty?!1:(e(o.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function selectedLineBlocks(o){let e=[],n=-1;for(let r of o.selection.ranges){let s=o.doc.lineAt(r.from),l=o.doc.lineAt(r.to);if(!r.empty&&r.to==l.from&&(l=o.doc.lineAt(r.to-1)),n>=s.number){let a=e[e.length-1];a.to=l.to,a.ranges.push(r)}else e.push({from:s.from,to:l.to,ranges:[r]});n=l.number+1}return e}function moveLine(o,e,n){if(o.readOnly)return!1;let r=[],s=[];for(let l of selectedLineBlocks(o)){if(n?l.to==o.doc.length:l.from==0)continue;let a=o.doc.lineAt(n?l.to+1:l.from-1),h=a.length+1;if(n){r.push({from:l.to,to:a.to},{from:l.from,insert:a.text+o.lineBreak});for(let c of l.ranges)s.push(EditorSelection.range(Math.min(o.doc.length,c.anchor+h),Math.min(o.doc.length,c.head+h)))}else{r.push({from:a.from,to:l.from},{from:l.to,insert:o.lineBreak+a.text});for(let c of l.ranges)s.push(EditorSelection.range(c.anchor-h,c.head-h))}}return r.length?(e(o.update({changes:r,scrollIntoView:!0,selection:EditorSelection.create(s,o.selection.mainIndex),userEvent:"move.line"})),!0):!1}const moveLineUp=({state:o,dispatch:e})=>moveLine(o,e,!1),moveLineDown=({state:o,dispatch:e})=>moveLine(o,e,!0);function copyLine(o,e,n){if(o.readOnly)return!1;let r=[];for(let s of selectedLineBlocks(o))n?r.push({from:s.from,insert:o.doc.slice(s.from,s.to)+o.lineBreak}):r.push({from:s.to,insert:o.lineBreak+o.doc.slice(s.from,s.to)});return e(o.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const copyLineUp=({state:o,dispatch:e})=>copyLine(o,e,!1),copyLineDown=({state:o,dispatch:e})=>copyLine(o,e,!0),deleteLine=o=>{if(o.state.readOnly)return!1;let{state:e}=o,n=e.changes(selectedLineBlocks(e).map(({from:s,to:l})=>(s>0?s--:l<e.doc.length&&l++,{from:s,to:l}))),r=updateSel(e.selection,s=>o.moveVertically(s,!0)).map(n);return o.dispatch({changes:n,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function isBetweenBrackets(o,e){if(/\(\)|\[\]|\{\}/.test(o.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=syntaxTree(o).resolveInner(e),r=n.childBefore(e),s=n.childAfter(e),l;return r&&s&&r.to<=e&&s.from>=e&&(l=r.type.prop(NodeProp.closedBy))&&l.indexOf(s.name)>-1&&o.doc.lineAt(r.to).from==o.doc.lineAt(s.from).from?{from:r.to,to:s.from}:null}const insertNewlineAndIndent=newlineAndIndent(!1),insertBlankLine=newlineAndIndent(!0);function newlineAndIndent(o){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let r=e.changeByRange(s=>{let{from:l,to:a}=s,h=e.doc.lineAt(l),c=!o&&l==a&&isBetweenBrackets(e,l);o&&(l=a=(a<=h.to?h:e.doc.lineAt(a)).to);let u=new IndentContext(e,{simulateBreak:l,simulateDoubleBreak:!!c}),f=getIndentation(u,l);for(f==null&&(f=/^\s*/.exec(e.doc.lineAt(l).text)[0].length);a<h.to&&/\s/.test(h.text[a-h.from]);)a++;c?{from:l,to:a}=c:l>h.from&&l<h.from+100&&!/\S/.test(h.text.slice(0,l))&&(l=h.from);let d=["",indentString(e,f)];return c&&d.push(indentString(e,u.lineIndent(h.from,-1))),{changes:{from:l,to:a,insert:Text.of(d)},range:EditorSelection.cursor(l+1+d[1].length)}});return n(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function changeBySelectedLine(o,e){let n=-1;return o.changeByRange(r=>{let s=[];for(let a=r.from;a<=r.to;){let h=o.doc.lineAt(a);h.number>n&&(r.empty||r.to>h.from)&&(e(h,s,r),n=h.number),a=h.to+1}let l=o.changes(s);return{changes:s,range:EditorSelection.range(l.mapPos(r.anchor,1),l.mapPos(r.head,1))}})}const indentSelection=({state:o,dispatch:e})=>{if(o.readOnly)return!1;let n=Object.create(null),r=new IndentContext(o,{overrideIndentation:l=>{let a=n[l];return a==null?-1:a}}),s=changeBySelectedLine(o,(l,a,h)=>{let c=getIndentation(r,l.from);if(c==null)return;/\S/.test(l.text)||(c=0);let u=/^\s*/.exec(l.text)[0],f=indentString(o,c);(u!=f||h.from<l.from+u.length)&&(n[l.from]=c,a.push({from:l.from,to:l.from+u.length,insert:f}))});return s.changes.empty||e(o.update(s,{userEvent:"indent"})),!0},indentMore=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(n,r)=>{r.push({from:n.from,insert:o.facet(indentUnit)})}),{userEvent:"input.indent"})),!0),indentLess=({state:o,dispatch:e})=>o.readOnly?!1:(e(o.update(changeBySelectedLine(o,(n,r)=>{let s=/^\s*/.exec(n.text)[0];if(!s)return;let l=countColumn(s,o.tabSize),a=0,h=indentString(o,Math.max(0,l-getIndentUnit(o)));for(;a<s.length&&a<h.length&&s.charCodeAt(a)==h.charCodeAt(a);)a++;r.push({from:n.from+a,to:n.from+s.length,insert:h.slice(a)})}),{userEvent:"delete.dedent"})),!0),emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}],standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryLeft,shift:selectLineBoundaryLeft,preventDefault:!0},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight,preventDefault:!0},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryRight,shift:selectLineBoundaryRight,preventDefault:!0},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:!0},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:!0},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward,preventDefault:!0},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward,preventDefault:!0},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map(o=>({mac:o.key,run:o.run,shift:o.shift}))),defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:!0},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket},{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}].concat(standardKeymap),CodeMirror_vue_vue_type_style_index_0_lang="",_hoisted_1$1={class:"w-full flex flex-col"},_hoisted_2=["id"],_hoisted_3={class:"mt-4 border p-4"},_sfc_main$1={__name:"CodeMirror",props:{example:Object},setup(__props){const props=__props;let currentCode=props.example.code;const resultRef=ref("");let running=null,startState=EditorState.create({doc:currentCode,extensions:[keymap.of(defaultKeymap),lineNumbers(),gutter({class:"cm-mygutter"}),EditorView.updateListener.of(o=>{currentCode=o.state.doc.toString(),running&&clearTimeout(running),running=setTimeout(()=>{run()},1e3)})]});onMounted(()=>{currentCode=props.example,setTimeout(initCodeMirror,200)});const initCodeMirror=()=>{const o=document.getElementById(props.example.id);new EditorView({state:startState,parent:o}),run()},run=()=>{try{let result;eval(currentCode),resultRef.value=result}catch(o){resultRef.value=o.message}};return(o,e)=>(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",{id:__props.example.id,class:"bg-gray-300 dark:bg-gray-600"},null,8,_hoisted_2),createBaseVNode("div",_hoisted_3,[createBaseVNode("pre",null,toDisplayString(resultRef.value),1)])]))}},arrays=`
// The result var is available inside this scope
const books = [
  { id: '1', title: 'Clean Code', category: 'Programming' },
  { id: '2', title: 'Clean Archtecture', category: 'Programming' },
  { id: '3', title: 'How to become bilionaire writting js libraries', category: 'Self help' },
]

const fruits = ['strawberry', 'watermelon', 'pineapple']
`,findString={id:"array_find_string",title:"ArrayHelpers.find -> string",code:`
${arrays}

result = ArrayHelpers.find(fruits, 'watermelon')
  `},findAllObject={id:"array_find_all_object",title:"ArrayHelpers.findAll -> object",code:`
${arrays}

result = ArrayHelpers.findAll(books, { id: [1, '2'] })
  `},arrayFindExamples=[findString,findAllObject],index_md_vue_type_style_index_0_lang="",_hoisted_1=createStaticVNode('<h1 id="lazyfy" tabindex="-1">Lazyfy <a class="header-anchor" href="#lazyfy" aria-hidden="true">#</a></h1><h3 id="i-choose-a-lazy-person-to-do-a-hard-job-because-a-lazy-person-will-find-an-easy-way-to-do-it-bill-gates" tabindex="-1">\u201CI choose a lazy person to do a hard job. Because a lazy person will find an easy way to do it.\u201D - Bill Gates <a class="header-anchor" href="#i-choose-a-lazy-person-to-do-a-hard-job-because-a-lazy-person-will-find-an-easy-way-to-do-it-bill-gates" aria-hidden="true">#</a></h3><h2 id="live-examples" tabindex="-1">Live examples <a class="header-anchor" href="#live-examples" aria-hidden="true">#</a></h2>',3),__pageData=JSON.parse('{"title":"Lazyfy","description":"","frontmatter":{},"headers":[{"level":3,"title":"\u201CI choose a lazy person to do a hard job. Because a lazy person will find an easy way to do it.\u201D - Bill Gates","slug":"i-choose-a-lazy-person-to-do-a-hard-job-because-a-lazy-person-will-find-an-easy-way-to-do-it-bill-gates","link":"#i-choose-a-lazy-person-to-do-a-hard-job-because-a-lazy-person-will-find-an-easy-way-to-do-it-bill-gates","children":[]},{"level":2,"title":"Live examples","slug":"live-examples","link":"#live-examples","children":[]}],"relativePath":"index.md"}'),__default__={name:"index.md"},_sfc_main=Object.assign(__default__,{setup(o){const e=computed(()=>arrayFindExamples);return(n,r)=>(openBlock(),createElementBlock("div",null,[_hoisted_1,(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(e),s=>(openBlock(),createElementBlock("div",{class:"w-full mb-4",key:s.id},[createTextVNode(" ## "+toDisplayString(s.title)+" ",1),createVNode(_sfc_main$1,{example:s},null,8,["example"])]))),128))]))}});export{__pageData,_sfc_main as default};
